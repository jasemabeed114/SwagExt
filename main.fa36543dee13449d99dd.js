(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(t,e){},1:function(t,e,n){t.exports=n("zUnb")},RnhZ:function(t,e,n){var r={"./af":"K/tc","./af.js":"K/tc","./ar":"jnO4","./ar-dz":"o1bE","./ar-dz.js":"o1bE","./ar-kw":"Qj4J","./ar-kw.js":"Qj4J","./ar-ly":"HP3h","./ar-ly.js":"HP3h","./ar-ma":"CoRJ","./ar-ma.js":"CoRJ","./ar-sa":"gjCT","./ar-sa.js":"gjCT","./ar-tn":"bYM6","./ar-tn.js":"bYM6","./ar.js":"jnO4","./az":"SFxW","./az.js":"SFxW","./be":"H8ED","./be.js":"H8ED","./bg":"hKrs","./bg.js":"hKrs","./bm":"p/rL","./bm.js":"p/rL","./bn":"kEOa","./bn-bd":"loYQ","./bn-bd.js":"loYQ","./bn.js":"kEOa","./bo":"0mo+","./bo.js":"0mo+","./br":"aIdf","./br.js":"aIdf","./bs":"JVSJ","./bs.js":"JVSJ","./ca":"1xZ4","./ca.js":"1xZ4","./cs":"PA2r","./cs.js":"PA2r","./cv":"A+xa","./cv.js":"A+xa","./cy":"l5ep","./cy.js":"l5ep","./da":"DxQv","./da.js":"DxQv","./de":"tGlX","./de-at":"s+uk","./de-at.js":"s+uk","./de-ch":"u3GI","./de-ch.js":"u3GI","./de.js":"tGlX","./dv":"WYrj","./dv.js":"WYrj","./el":"jUeY","./el.js":"jUeY","./en-au":"Dmvi","./en-au.js":"Dmvi","./en-ca":"OIYi","./en-ca.js":"OIYi","./en-gb":"Oaa7","./en-gb.js":"Oaa7","./en-ie":"4dOw","./en-ie.js":"4dOw","./en-il":"czMo","./en-il.js":"czMo","./en-in":"7C5Q","./en-in.js":"7C5Q","./en-nz":"b1Dy","./en-nz.js":"b1Dy","./en-sg":"t+mt","./en-sg.js":"t+mt","./eo":"Zduo","./eo.js":"Zduo","./es":"iYuL","./es-do":"CjzT","./es-do.js":"CjzT","./es-mx":"tbfe","./es-mx.js":"tbfe","./es-us":"Vclq","./es-us.js":"Vclq","./es.js":"iYuL","./et":"7BjC","./et.js":"7BjC","./eu":"D/JM","./eu.js":"D/JM","./fa":"jfSC","./fa.js":"jfSC","./fi":"gekB","./fi.js":"gekB","./fil":"1ppg","./fil.js":"1ppg","./fo":"ByF4","./fo.js":"ByF4","./fr":"nyYc","./fr-ca":"2fjn","./fr-ca.js":"2fjn","./fr-ch":"Dkky","./fr-ch.js":"Dkky","./fr.js":"nyYc","./fy":"cRix","./fy.js":"cRix","./ga":"USCx","./ga.js":"USCx","./gd":"9rRi","./gd.js":"9rRi","./gl":"iEDd","./gl.js":"iEDd","./gom-deva":"qvJo","./gom-deva.js":"qvJo","./gom-latn":"DKr+","./gom-latn.js":"DKr+","./gu":"4MV3","./gu.js":"4MV3","./he":"x6pH","./he.js":"x6pH","./hi":"3E1r","./hi.js":"3E1r","./hr":"S6ln","./hr.js":"S6ln","./hu":"WxRl","./hu.js":"WxRl","./hy-am":"1rYy","./hy-am.js":"1rYy","./id":"UDhR","./id.js":"UDhR","./is":"BVg3","./is.js":"BVg3","./it":"bpih","./it-ch":"bxKX","./it-ch.js":"bxKX","./it.js":"bpih","./ja":"B55N","./ja.js":"B55N","./jv":"tUCv","./jv.js":"tUCv","./ka":"IBtZ","./ka.js":"IBtZ","./kk":"bXm7","./kk.js":"bXm7","./km":"6B0Y","./km.js":"6B0Y","./kn":"PpIw","./kn.js":"PpIw","./ko":"Ivi+","./ko.js":"Ivi+","./ku":"JCF/","./ku.js":"JCF/","./ky":"lgnt","./ky.js":"lgnt","./lb":"RAwQ","./lb.js":"RAwQ","./lo":"sp3z","./lo.js":"sp3z","./lt":"JvlW","./lt.js":"JvlW","./lv":"uXwI","./lv.js":"uXwI","./me":"KTz0","./me.js":"KTz0","./mi":"aIsn","./mi.js":"aIsn","./mk":"aQkU","./mk.js":"aQkU","./ml":"AvvY","./ml.js":"AvvY","./mn":"lYtQ","./mn.js":"lYtQ","./mr":"Ob0Z","./mr.js":"Ob0Z","./ms":"6+QB","./ms-my":"ZAMP","./ms-my.js":"ZAMP","./ms.js":"6+QB","./mt":"G0Uy","./mt.js":"G0Uy","./my":"honF","./my.js":"honF","./nb":"bOMt","./nb.js":"bOMt","./ne":"OjkT","./ne.js":"OjkT","./nl":"+s0g","./nl-be":"2ykv","./nl-be.js":"2ykv","./nl.js":"+s0g","./nn":"uEye","./nn.js":"uEye","./oc-lnc":"Fnuy","./oc-lnc.js":"Fnuy","./pa-in":"8/+R","./pa-in.js":"8/+R","./pl":"jVdC","./pl.js":"jVdC","./pt":"8mBD","./pt-br":"0tRk","./pt-br.js":"0tRk","./pt.js":"8mBD","./ro":"lyxo","./ro.js":"lyxo","./ru":"lXzo","./ru.js":"lXzo","./sd":"Z4QM","./sd.js":"Z4QM","./se":"//9w","./se.js":"//9w","./si":"7aV9","./si.js":"7aV9","./sk":"e+ae","./sk.js":"e+ae","./sl":"gVVK","./sl.js":"gVVK","./sq":"yPMs","./sq.js":"yPMs","./sr":"zx6S","./sr-cyrl":"E+lV","./sr-cyrl.js":"E+lV","./sr.js":"zx6S","./ss":"Ur1D","./ss.js":"Ur1D","./sv":"X709","./sv.js":"X709","./sw":"dNwA","./sw.js":"dNwA","./ta":"PeUW","./ta.js":"PeUW","./te":"XLvN","./te.js":"XLvN","./tet":"V2x9","./tet.js":"V2x9","./tg":"Oxv6","./tg.js":"Oxv6","./th":"EOgW","./th.js":"EOgW","./tk":"Wv91","./tk.js":"Wv91","./tl-ph":"Dzi0","./tl-ph.js":"Dzi0","./tlh":"z3Vd","./tlh.js":"z3Vd","./tr":"DoHr","./tr.js":"DoHr","./tzl":"z1FC","./tzl.js":"z1FC","./tzm":"wQk9","./tzm-latn":"tT3J","./tzm-latn.js":"tT3J","./tzm.js":"wQk9","./ug-cn":"YRex","./ug-cn.js":"YRex","./uk":"raLr","./uk.js":"raLr","./ur":"UpQW","./ur.js":"UpQW","./uz":"Loxo","./uz-latn":"AQ68","./uz-latn.js":"AQ68","./uz.js":"Loxo","./vi":"KSF8","./vi.js":"KSF8","./x-pseudo":"/X5v","./x-pseudo.js":"/X5v","./yo":"fzPg","./yo.js":"fzPg","./zh-cn":"XDpg","./zh-cn.js":"XDpg","./zh-hk":"SatO","./zh-hk.js":"SatO","./zh-mo":"OmwH","./zh-mo.js":"OmwH","./zh-tw":"kOpN","./zh-tw.js":"kOpN"};function i(t){var e=o(t);return n(e)}function o(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}i.keys=function(){return Object.keys(r)},i.resolve=o,t.exports=i,i.id="RnhZ"},crnd:function(t,e){function n(t){return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="crnd"},zUnb:function(t,e,n){"use strict";n.r(e);var r=n("TYT/"),i=n("E1rE"),o=n("QJY3"),s=n("cUzu"),c=n("rDsv"),a=n("DUip"),u=function(){function t(){}return t.prototype.ngOnInit=function(){},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.Qb({type:t,selectors:[["app-root"]],decls:2,vars:0,consts:[[1,"body"]],template:function(t,e){1&t&&(r.cc(0,"div",0),r.Xb(1,"router-outlet"),r.bc())},directives:[a.c],styles:[""]}),t}(),h=n("Valr"),l=n("mrSG"),d=n("wd/R"),p=n.n(d),b=n("K9Ia"),f=n("yQm5"),g=function(){function t(){}return t.\u0275mod=Object(r.Ub)({type:t}),t.\u0275inj=Object(r.Tb)({factory:function(e){return new(e||t)},imports:[[]]}),t}(),v=function(t){return t[t.dataInsightsResults=0]="dataInsightsResults",t[t.log=1]="log",t[t.login=2]="login",t[t.activate=3]="activate",t[t.register=4]="register",t[t.getCdnHost=5]="getCdnHost",t[t.getFilePath=6]="getFilePath",t[t.showTutorial=7]="showTutorial",t[t.getPopupData=8]="getPopupData",t[t.logImpression=9]="logImpression",t[t.executeReflect=10]="executeReflect",t[t.getAllReflects=11]="getAllReflects",t[t.getStorageItem=12]="getStorageItem",t[t.setStorageItem=13]="setStorageItem",t[t.executeCallback=14]="executeCallback",t[t.logCouponResults=15]="logCouponResults",t[t.dismissActivation=16]="dismissActivation",t[t.executeReflectCmd=17]="executeReflectCmd",t[t.getLocalizedString=18]="getLocalizedString",t[t.notificationClicked=19]="notificationClicked",t[t.resetCouponCoolDown=20]="resetCouponCoolDown",t[t.getFeaturedMerchants=21]="getFeaturedMerchants",t[t.sendPasswordReminder=22]="sendPasswordReminder",t[t.refreshAccountBalance=23]="refreshAccountBalance",t[t.sendDataFromHostToExt=24]="sendDataFromHostToExt",t[t.setActivationInjected=25]="setActivationInjected",t[t.constructRewardString=26]="constructRewardString",t[t.getSERPMerchantMetasByUrls=27]="getSERPMerchantMetasByUrls",t[t.setActivationConfirmed=28]="setActivationConfirmed",t[t.constructActivateString=29]="constructActivateString",t[t.notificationRemoveClicked=30]="notificationRemoveClicked",t[t.navigateToFeaturedMerchant=31]="navigateToFeaturedMerchant",t[t.userClickedInPage=32]="userClickedInPage",t[t.getCurrencySymbol=33]="getCurrencySymbol",t[t.constructRewardStringInCurrency=34]="constructRewardStringInCurrency",t[t.updateMemberPrefs=35]="updateMemberPrefs",t[t.callBrandServiceFunction=36]="callBrandServiceFunction",t[t.setTabShopperMarketingInjected=37]="setTabShopperMarketingInjected",t[t.openSiteTab=38]="openSiteTab",t[t.openSettings=39]="openSettings",t[t.closeSettings=40]="closeSettings",t[t.openGoTab=41]="openGoTab",t}({}),m=function(t){return t[t.off=0]="off",t[t.error=1]="error",t[t.warn=2]="warn",t[t.info=3]="info",t[t.debug=4]="debug",t[t.trace=5]="trace",t[t.all=6]="all",t}({}),O=function(t){return t[t.unsupported=0]="unsupported",t[t.popupOnly=1]="popupOnly",t[t.standard=2]="standard",t[t.discover=3]="discover",t[t.autoRedirect=7]="autoRedirect",t}({}),j=function(t){return t[t.OK=0]="OK",t[t.INVALID_HASH=1001]="INVALID_HASH",t[t.REQUIRES_LOGIN=1002]="REQUIRES_LOGIN",t[t.REQUIRES_POST=1003]="REQUIRES_POST",t[t.MEMBER_MISMATCH=1004]="MEMBER_MISMATCH",t[t.FAILED_TO_GENERATE_ID=2001]="FAILED_TO_GENERATE_ID",t[t.FAILED_TO_RECORD_UPDATE=2002]="FAILED_TO_RECORD_UPDATE",t[t.LOGIN_FAILURE=3001]="LOGIN_FAILURE",t[t.REGISTRATION_FAILURE=3002]="REGISTRATION_FAILURE",t[t.REGISTRATION_BLOCKED_IP=3003]="REGISTRATION_BLOCKED_IP",t[t.REGISTRATION_INVALID_MODEL=3004]="REGISTRATION_INVALID_MODEL",t[t.DATABASE_ERROR=4001]="DATABASE_ERROR",t}({}),y=function(t){return t.chrome="chrome",t.firefox="firefox",t.edge="edge",t}({}),S=function(t){return t.Merchant="MERCHANT",t.Checkout="CHECKOUT",t.PostPurchase="POSTPURCHASE",t.Serp="SERP",t}({}),w=function(t){return t[t.sb=22]="sb",t[t.mp=257]="mp",t[t.tada=258]="tada",t[t.ibd=260]="ibd",t[t.upm=263]="upm",t}({}),C=function(t){return t.sb="SwagButton",t.mp="MyPoints Score!",t.tada="Tada Extension",t.ibd="Billy Button",t.upm="Upromise Extension",t}({}),_=function(t){return t[t.SHOP=1]="SHOP",t[t.ANSWER=2]="ANSWER",t[t.ANSWER_LOGGING=4]="ANSWER_LOGGING",t[t.DATA_INSIGHTS=8]="DATA_INSIGHTS",t[t.SHOP_APPLY_COUPONS=16]="SHOP_APPLY_COUPONS",t[t.SHOP_SERP_INJECT=32]="SHOP_SERP_INJECT",t[t.ANSWER_DASHBOARD=64]="ANSWER_DASHBOARD",t[t.MKT_PROMO_CODES=128]="MKT_PROMO_CODES",t[t.MKT_REFERRALS=256]="MKT_REFERRALS",t[t.UX_POPUP_SEARCH=512]="UX_POPUP_SEARCH",t}({}),x=function(t){return t[t.chrome=3]="chrome",t[t.firefox=2]="firefox",t[t.edge=4]="edge",t}({}),M=function(){return function(){this.surveys=[],this.preferences=0,this.isTester=!1}}(),P=function(){return function(t,e){this.type=t,this.value=e}}(),I=function(t){return t[t.Default=274]="Default",t[t.AutoRedirect=280]="AutoRedirect",t[t.ActivationSliderClick=281]="ActivationSliderClick",t[t.CouponSliderClick=282]="CouponSliderClick",t[t.PopupMerchantClick=283]="PopupMerchantClick",t[t.PopupFeaturedMerchantClick=284]="PopupFeaturedMerchantClick",t}({}),k=function(t){return t[t.default=0]="default",t[t.background=1]="background",t[t.currentTab=2]="currentTab",t[t.silentTab=3]="silentTab",t}({}),A=function(){return function(t,e,n,r,i,o,s,c,a,u,h,l,d,p){void 0===l&&(l=!1),void 0===d&&(d=m.error),void 0===p&&(p=null),this.tabId=t,this.memberId=e,this.merchant=n,this.merchantSessionId=r,this.activated=i,this.activationConfirmed=o,this.urlType=s,this.extensionId=c,this.shopBonusUrl=a,this.shopBonusAmount=u,this.client=h,this.memberIsTester=l,this.consoleLogLevel=d,this.alert=p}}(),R=function(){function t(t){this.key=t}return t.prototype.get=function(){var t=localStorage.getItem(this.key),e="undefined"===t?null:JSON.parse(t);return Promise.resolve(e)},t.prototype.set=function(t){return localStorage.setItem(this.key,JSON.stringify(t)),Promise.resolve()},t.prototype.remove=function(){return localStorage.removeItem(this.key),Promise.resolve()},t}(),T=function(){function t(){}return Object.defineProperty(t.prototype,"expired",{get:function(){return!this.expiration||p()().unix()>=this.expiration},enumerable:!0,configurable:!0}),t.prototype.deserialize=function(t){for(var e in t)this[e]=t[e];return this},t}(),E=function(){function t(t,e){this.key=null,this.expirationHours=e,this.internalStorageProvider=t}return t.prototype.get=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.internalStorageProvider.get()];case 1:return t=e.sent(),[2,(new T).deserialize(t)]}}))}))},t.prototype.set=function(t){throw"Not implemented. Use setValue instead."},t.prototype.setValue=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.get()];case 1:return(e=n.sent()).value=t,e.expiration=p()().add(this.expirationHours,"hours").unix(),[4,this.internalStorageProvider.set(e)];case 2:return n.sent(),[2]}}))}))},t.prototype.remove=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.internalStorageProvider.remove()];case 1:return t.sent(),[2]}}))}))},t}(),L=function(){function t(t){this.key=t.key,this.internalStorageProvider=t}return t.prototype.get=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.internalStorageProvider.get()];case 1:return[2,(t=e.sent())?new Map(t):null]}}))}))},t.prototype.set=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return t?(e=Array.from(t),[4,this.internalStorageProvider.set(e)]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.internalStorageProvider.remove()];case 1:return t.sent(),[2]}}))}))},t}(),D=function(){function t(t,e){var n=this;this.overridden=!1,this.key=t.key,this.internalStorageProvider=t,e&&e.subscribe((function(t){return n.onStorageChanged(t)}))}return t.prototype.onStorageChanged=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return!(e=t[this.key])||this.overridden||void 0===e.oldValue?[3,2]:(console.log("Attempt made to change sticky storage item ["+this.key+"] from ["+e.oldValue+"] to ["+e.newValue+"]. Resetting."),[4,this.set(e.oldValue,!0)]);case 1:n.sent(),this.overridden&&(this.overridden=!1),n.label=2;case 2:return[2]}}))}))},t.prototype.get=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.internalStorageProvider.get()];case 1:return[2,t.sent()]}}))}))},t.prototype.set=function(t,e){return void 0===e&&(e=!1),Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.get()];case 1:return null===(n=r.sent())||e?(e&&(this.overridden=!0),[4,this.internalStorageProvider.set(t)]):[3,3];case 2:return r.sent(),this.overridden=!1,[3,4];case 3:throw"Attempt made to change sticky storage item ["+this.key+"] from ["+n+"] to ["+t+"]";case 4:return[2]}}))}))},t.prototype.remove=function(t){return void 0===t&&(t=!1),Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return t?(this.overridden=!0,[4,this.internalStorageProvider.remove()]):[3,2];case 1:return e.sent(),[3,3];case 2:throw"Attempt made to remove sticky storage item ["+this.key+"]";case 3:return[2]}}))}))},t}(),N=function(){function t(t,e){this.key=t,this.browserApi=e}return t.prototype.get=function(){var t=this;return new Promise((function(e){t.browserApi.storage.local.get(t.key,(function(n){e(n[t.key]||null)}))}))},t.prototype.set=function(t){var e=this;return new Promise((function(n){var r={};r[e.key]=t,e.browserApi.storage.local.set(r,(function(){n()}))}))},t.prototype.remove=function(){var t=this;return new Promise((function(e){t.browserApi.storage.local.remove(t.key,(function(){e()}))}))},t}(),U=function(){return function(t,e){void 0===e&&(e=!0),this.command=t,this.requiresHash=e}}(),H=function(){return function(t,e){this.isAffiliateRedirect=t,this.isOwnRedirect=e}}(),F=function(){return function(){}}(),z=function(){return function(){}}(),W=function(t){function e(e,n){var r=t.call(this)||this;return r.coupons=[],Object.assign(r,JSON.parse(e)),r.id=n.id,r.loc=n.loc,r.type=n.type,r.reward=n.reward||new z,r.coupons=r.coupons||[],r.isZeroPayout=!r.reward.amount||0===r.reward.amount,r}return Object(l.c)(e,t),e}(function(){return function(){}}()),B=function(){return function(t,e){this.RequestsFromServerAndClient={client:{},server:{}},this.stack=[],this.userClicked=!1,this.requestId=t,this.initiator=e}}(),J=function(t){return t[t.NotActive=0]="NotActive",t[t.Activating=1]="Activating",t[t.Activated=2]="Activated",t[t.StandingDown=3]="StandingDown",t}({}),q=function(){return function(){this.activationDismissed=!1,this.activationInjected=!1,this.activationConfirmed=!1,this.shopperMarketingInjected=!1}}(),G=function(){return function(t,e){this.redirectStack=null,this.redirectDetails=null,this.merchantState=null,this.previousMerchantState=null,this.tabId=e,this.windowId=t}}(),K=function(){return function(){}}(),X=function(t){return t[t.surveyAlertOptOut=1]="surveyAlertOptOut",t[t.accountAlertOptIn=2]="accountAlertOptIn",t[t.dataCollectionOptOut=4]="dataCollectionOptOut",t}({}),V=function(){function t(){}return t.isValid=function(t){return t.hasOwnProperty("msg")&&t.hasOwnProperty("type")},t}(),Q=function(){return function(t,e,n){this.name=t,this.alarmInfo=e,this.subscription=n}}(),Y=function(){function t(){}return t.getCashBack=function(t,e){t/=100;var n=Number.isInteger(t)?t:t.toFixed(2);return e?n+"%":"$"+n},t.copyTextToClipboard=function(t){if(navigator.clipboard)navigator.clipboard.writeText(t);else{var e=document.createElement("textarea");e.value=t,e.style.opacity="0",e.style.position="fixed",e.style.width="0",e.style.height="0",e.style.margin="0",e.style.padding="0",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}},t}(),Z=function(){function t(){}return t.ONE_HOUR_MS=36e5,t.LOCATION_USA=1,t.HTTP_RETRIES=2,t.ACTIVATION_STATE=7,t.TOKEN_COOKIE="__urqm",t.TUTORIAL_KEY="tutorial-viewed",t.DEFAULT_REDIRECT_ENDPOINT="/g/shopredir",t.DISCOVER_CLICK_COMMAND="oh-offer-click",t.FLAGS_STORAGE_KEY="flags",t.LEGACY_ID_NAMES={SBMP:"SSE_TBUID",TADA:"guid"},t.EMAIL_REGEX=new RegExp('^(([^<>()\\[\\]\\\\.,;:\\s@"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@"]+)*)|(".+"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$'),t}(),$=function(){function t(){}return t.SEARCH_PAGE_INJECTION_SETTINGS=[{id:0,domain:"swagbucks.com",rx:new RegExp("swagbucks[.]com/[?](q=|.=.*&q=)"),pattern:"#main div.algo a",matchURL:"ru=",matchTOP:"true"},{id:1,domain:"mypoints.com",rx:new RegExp("mypoints[.]com/search-and-earn[?](q=|.=.*&q=)"),pattern:"#main div.algo a",matchURL:"ru=",matchTOP:"true"},{id:2,domain:"search.yahoo.com",rx:new RegExp("/search.*(fr=|hspart=prodege|hspart=mozilla).*"),pattern:"#main div.algo a",matchURL:"RU="},{id:3,domain:"search.yahoo.com",rx:new RegExp("search.yahoo.com/search;"),pattern:"#main div.algo a",matchURL:"RU="},{id:4,domain:"www.bing.com",rx:new RegExp("/?search"),patternBig:'#b_results li.b_algo, #b_results li, #b_results h2 a, div[class="sb_tlst"] a'},{id:5,domain:"google.com",rx:new RegExp("^https?://(?:www.|encrypted.)?google.com/.*(?:(?:[&?#]q=)|(?:(?:search|webhp|sclient|hl|output|newwindow|[?]gws_rd=ssl).*[&?#]q=))"),pattern:"h3.r a"}],t}(),tt=function(){return function(t,e){this.value=e,this.configuration=t}}(),et=function(t){return t[t.flags=0]="flags",t[t.merchantHash=1]="merchantHash",t[t.affiliateHash=2]="affiliateHash",t[t.featuredMerchants=3]="featuredMerchants",t[t.siteMapHash=4]="siteMapHash",t}({}),nt=function(){return function(){this.merchantActivationHistory=[]}}(),rt=d,it=function(){function t(t,e,n,r){var i=rt();this.sessionStart=i.valueOf(),this.logData=new nt,this.logData.merchantID=n.id,this.logData.merchantActivationType=n.type,this.logData.merchantActivationHistory=[],this.logData.parentSessionID=r||"",this.logData.merchantSessionID=this.generateSessionId(t,e,n.id,i.unix())}return t.prototype.generateSessionId=function(t,e,n,r){return t+"~"+e+"~"+n+"~"+r},t.prototype.finalize=function(){this.logData.sessionDuration=rt().valueOf()-this.sessionStart},t.prototype.tryAddActivationState=function(t){var e=this.logData.merchantActivationHistory;(0===e.length||e.length&&e[e.length-1]!==t)&&e.push(t)},t}(),ot=function(){return function(t,e){this.memberID=t,this.timestamp=e}}(),st=function(t){return t.BadHashDetected="BAD_HASH_DETECTED",t.FalsyIdOrHashOnUpdate="FALSY_ID_OR_HASH_ON_UPDATE",t.FalsyIdOrHashOnStartup="FALSY_ID_OR_HASH_ON_STARTUP",t.FalsyIdOrHashBeforeCallback="FALSY_ID_OR_HASH_BEFORE_CALLBACK",t}({}),ct=function(){return function(t){this.merchant=null,this.expiry=null,this.injectionState=new q,this.couponCoolDownExpiry=null,this.merchant=t,this.expiry=p()().add(15,"minutes").unix()}}(),at=function(){return function(t,e,n,r,i,o,s,c,a,u,h){void 0===u&&(u=!1),void 0===h&&(h="assets/icons/128.png"),this.id=t,this.ts=n,this.url=c,this.type=e,this.text=s,this.data=i,this.icon=h,this.title=o,this.expires=r,this.linkText=a,this.shouldNotifyVisibly=u}}(),ut=function(t){return t[t.Survey=0]="Survey",t[t.PromoCode=1]="PromoCode",t}({}),ht=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.placement=r,i}return Object(l.c)(e,t),e}(W),lt=function(){return function(t,e){void 0===e&&(e=null),this.message=t,this.originalError=e}}(),dt=function(){function t(t){this.identifier=t}return t.prototype.check=function(t){return t.id!==this.identifier},t}(),pt=function(){return function(t){this.peerInfo=JSON.stringify(t)}}(),bt=function(t){return t[t.Activation=0]="Activation",t[t.Coupons=1]="Coupons",t[t.SHM=2]="SHM",t}({}),ft=function(){return function(t,e,n){this.name=e,this.callback=n,this.domainIncludes=t}}(),gt=function(t){return t[t.sb=42]="sb",t[t.mp=43]="mp",t[t.tada=44]="tada",t[t.ibd=51]="ibd",t}({}),vt=function(){return function(){}}(),mt=function(t){return t[t.Root=0]="Root",t[t.Exact=1]="Exact",t[t.StartsWith=2]="StartsWith",t[t.EndsWith=3]="EndsWith",t[t.StartsWithEndsWith=4]="StartsWithEndsWith",t[t.Contains=5]="Contains",t}({}),Ot=function(t){return t.Root="/",t.Wildcard="*",t.WildcardStart="/*/",t.WildcardEnd="/*",t.WildcardSandwich="/*/",t}({}),jt=function(){return function(t){this.type=t,this.patterns=[]}}(),yt=function(){function t(){this._onChanged=new b.b,this.onChanged=this._onChanged.asObservable(),this._initialized=!1}return Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialized",{get:function(){return this._initialized},enumerable:!0,configurable:!0}),t.prototype.deserialize=function(t){var e,n,r,i,o=new Map;try{for(var s=Object(l.g)(Object.keys(t)),c=s.next();!c.done;c=s.next()){var a=c.value,u=t[a],h=new Map;try{for(var d=(r=void 0,Object(l.g)(Object.keys(u))),p=d.next();!p.done;p=d.next()){var b=p.value,f=Object.assign(new vt,u[b]);h[b]=f}}catch(g){r={error:g}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}o[a]=h}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return o},t.prototype.get=function(t){var e,n;if(!this._initialized||this.isEmpty()||!t)return null;var r=null,i=new f(t);try{for(var o=Object(l.g)([i.hostname(),i.domain()]),s=o.next();!s.done;s=o.next()){var c=s.value;if(this.keys.includes(c)&&(r=this.matchSiteByHost(c,i)))break}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r},t.prototype.getMatchSets=function(t){var e,n,r=new jt(mt.Root),i=new jt(mt.Exact),o=new jt(mt.StartsWith),s=new jt(mt.EndsWith),c=new jt(mt.StartsWithEndsWith),a=new jt(mt.Contains);try{for(var u=Object(l.g)(t),h=u.next();!h.done;h=u.next()){var d=h.value;d.includes(Ot.Wildcard)?d.startsWith("/")&&!d.startsWith(Ot.WildcardStart)&&d.endsWith(Ot.WildcardEnd)?o.patterns.push(d):d.startsWith(Ot.WildcardStart)&&!d.endsWith(Ot.Wildcard)?s.patterns.push(d):d.includes(Ot.WildcardSandwich)&&d.indexOf(Ot.WildcardSandwich)>0&&d.indexOf(Ot.WildcardSandwich)==d.lastIndexOf(Ot.WildcardSandwich)?c.patterns.push(d):d.startsWith(Ot.WildcardStart)&&d.endsWith(Ot.WildcardEnd)&&a.patterns.push(d):d==Ot.Root?r.patterns.push(d):i.patterns.push(d)}}catch(p){e={error:p}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}return[i,o,s,c,a,r]},t.prototype.getPathMatch=function(t,e){var n,r,i=null;try{for(var o=Object(l.g)(e),s=o.next();!s.done;s=o.next()){var c=s.value;if(c.patterns.length>0){switch(c.type){case mt.Exact:i=c.patterns.find((function(e){return e==t}));break;case mt.StartsWith:i=c.patterns.find((function(e){var n=e.replace(Ot.Wildcard,"");return t.startsWith(n)}));break;case mt.EndsWith:i=c.patterns.find((function(e){var n=e.replace(Ot.Wildcard,"").replace("//","/");return t.endsWith(n)}));break;case mt.StartsWithEndsWith:i=c.patterns.find((function(e){var n=e.split(Ot.Wildcard),r=n[1];return t.startsWith(n[0])&&t.endsWith(r)}));break;case mt.Contains:i=c.patterns.find((function(e){var n=e.split(Ot.Wildcard).join("").replace("//","/");return t.includes(n)}));break;case mt.Root:i=c.patterns[0]}if(i)break}}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},t.prototype.isEmpty=function(){return!this.keys||!this.keys.length},t.prototype.load=function(t,e){t&&e&&e!==this._version&&(this.map=this.deserialize(t),this.keys=Array.from(Object.keys(this.map)),this._version=e,this._initialized=!0,this._onChanged.next())},t.prototype.matchSiteByHost=function(t,e){var n=this.map[t],r=new vt;if(n){var i=e.pathname(),o=Array.from(Object.keys(n)),s=this.getMatchSets(o),c=this.getPathMatch(i,s);if(c&&(Object.assign(r,n[c]),r.pages)){var a=Array.from(Object.keys(r.pages)),u=this.getMatchSets(a),h=this.getPathMatch(i,u);if(!h){var l=i.endsWith("/")?i.substring(0,i.length-1):i+"/";h=this.getPathMatch(l,u)}h&&(r.pageMatch=h)}}return r},t}(),St=function(t){return t[t.logUrls=1]="logUrls",t[t.logPrePurchase=2]="logPrePurchase",t[t.logPostPurchase=4]="logPostPurchase",t[t.logOrderHistory=8]="logOrderHistory",t[t.stripQueryParams=16]="stripQueryParams",t}({}),wt=function(){function t(t,e){this.guid=this.generateGuid(),this.created=p()().valueOf(),this.datamap=e,this.datatype=t}return t.prototype.generateGuid=function(){for(var t="",e=1;e<=30;e++)t+=(Math.ceil(8*Math.random())+1).toString();return t.length>38?this.generateGuid():t},t}(),Ct=function(){return function(t,e,n,r,i){this.data=t,this.memberID=r,this.extensionID=n,this.extensionVersion=e,this.clientID=i}}(),_t=function(){function t(t){this.ts=t.tab.timeStamp,this.url=this.getUrl(t),this.tabID=t.tab.tabId,this.siteID=t.id}return t.prototype.getUrl=function(t){var e=new f(t.tab.url);return t&&t.settings&&(t.settings&St.stripQueryParams)==St.stripQueryParams&&e.query(""),e.toString()},t}(),xt=function(t){return t[t.Urls=0]="Urls",t[t.PrePurchaseProducts=1]="PrePurchaseProducts",t[t.PostPurchaseProducts=2]="PostPurchaseProducts",t[t.OrderHistoryProducts=3]="OrderHistoryProducts",t}({}),Mt=function(t){return t[t.WebSearch=0]="WebSearch",t[t.ShopSearch=1]="ShopSearch",t[t.Stores=2]="Stores",t[t.AccountSummary=3]="AccountSummary",t[t.RewardsStore=4]="RewardsStore",t[t.Ledger=5]="Ledger",t[t.Referrals=6]="Referrals",t[t.ForgotPassword=7]="ForgotPassword",t[t.Tutorial=8]="Tutorial",t[t.Answer=9]="Answer",t}({}),Pt=function(t){return t[t.US=1]="US",t[t.CA=2]="CA",t[t.UK=4]="UK",t[t.AU=8]="AU",t[t.IE=16]="IE",t[t.IN=32]="IN",t[t.DE=64]="DE",t[t.FR=128]="FR",t[t.ES=256]="ES",t[t.OT=512]="OT",t}({}),It=n("xXU7"),kt=n("5tAl"),At=n("N2xl"),Rt=n("D2hM"),Tt=n("Nc6g"),Et=n.n(Tt),Lt=n("yrbL"),Dt=n("BkRI"),Nt=n.n(Dt),Ut=n("Sp1i"),Ht=n.n(Ut),Ft=function(){function t(){}return t.\u0275mod=Object(r.Ub)({type:t}),t.\u0275inj=Object(r.Tb)({factory:function(e){return new(e||t)},imports:[[]]}),t}(),zt=function(){function t(){this._couponsEnabled=!0,this._couponInjectionEnabled=!0,this._onConfigurationChanged=new b.b,this.onConfigurationChanged=this._onConfigurationChanged.asObservable(),this.flags=0}return Object.defineProperty(t.prototype,"couponsEnabled",{get:function(){return this._couponsEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"couponInjectionEnabled",{get:function(){return this._couponInjectionEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"client",{get:function(){return this.clientId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"brand",{get:function(){return w[this.clientId]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceId",{get:function(){return gt[this.brand]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensionName",{get:function(){return C[this.brand]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPseudoCurrency",{get:function(){return[w.sb,w.mp].includes(this.clientId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"installTutorialUrl",{get:function(){return this.clientId==w.sb?this.hostDomain+"/swagbutton-tutorial":null},enumerable:!0,configurable:!0}),t.prototype.getGlobal=function(t){return window[t]},Object.defineProperty(t.prototype,"clientId",{get:function(){return this.getGlobal("__clientId")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootDomain",{get:function(){return this.getGlobal("__rootDomain")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hostDomain",{get:function(){return this.getGlobal("__hostDomain")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootHost",{get:function(){return this.getGlobal("__rootHost")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"apiHost",{get:function(){return this.getGlobal("__apiHost")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cdnHost",{get:function(){return this.getGlobal("__cdnHost")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"profileUrl",{get:function(){return this.getGlobal("__profileUrl")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"goferHost",{get:function(){return this.getGlobal("__goferHost")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hostGoDomain",{get:function(){return this.getGlobal("__hostGoDomain")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isProd",{get:function(){return this.getGlobal("__isProd")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"browser",{get:function(){var t=this.getGlobal("__browserName");return y[t]},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=this;this.subscribeConfigChange(et.flags,(function(e){t.configure(e)}))},t.prototype.configure=function(t){this.flags=t},t.prototype.updateConfiguration=function(t,e){this._onConfigurationChanged.next(new tt(t,e))},t.prototype.subscribeConfigChange=function(t,e){this.onConfigurationChanged.subscribe((function(n){n.configuration===t&&e(n.value)}))},t.prototype.getClientCurrency=function(t){var e;switch(this.client){case w.mp:e="Point"+(t?"s":"");break;case w.sb:e="SB"}return e},t.prototype.formatAccountBalance=function(t){var e=this.getClientCurrency(t>1);if(this.hasPseudoCurrency)return(n=(new Intl.NumberFormat).format(t))+" "+e;var n=t/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n)},t.prototype.isFlagEnabled=function(t){return(this.flags&t)===t},t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Wt=function(t){function e(e){var n=t.call(this,["info"])||this;return n.configSvc=e,n.cachedLogPile=[],n.shouldCacheLogs=!1,n.defaultLevel=m.debug,n}return Object(l.c)(e,t),e.prototype.error=function(t,e){this.log(t,m.error,e)},e.prototype.warn=function(t,e){this.log(t,m.warn,e)},e.prototype.info=function(t,e){this.log(t,m.info,e)},e.prototype.debug=function(t,e){this.log(t,m.debug,e)},e.prototype.trace=function(t,e){this.log(t,m.trace,e)},e.prototype.table=function(t){this.logTable(t,m.debug)},e.prototype.setLevel=function(t){this.logLevel=t},e.prototype.getLevel=function(){return this.logLevel},e.prototype.initializeLogLevel=function(){if(!this.logLevel){var t=this.configSvc.isProd?e.LOG_LEVEL_PROD:e.LOG_LEVEL_DEV;t<Object.keys(m).length&&this.setLevel(t)}},e.prototype.logTable=function(t,e){this.initializeLogLevel(),e<=(this.logLevel||this.defaultLevel)&&console.table(t)},e.prototype.log=function(t,e,n){if(this.initializeLogLevel(),e<=(this.logLevel||this.defaultLevel)){var r=(new Error).stack.split("at "),i="";r.length>3&&r[3].lastIndexOf(" (")>-1&&(i=r[3].substring(0,r[3].lastIndexOf(" (")));var o="eval"!==i&&""!==i;switch(o&&console.group(i),n=n||"",e){case m.error:console.error(t,n);break;case m.warn:console.warn(t,n);break;case m.info:console.info(t,n);break;case m.debug:console.log(t,n);break;case m.trace:console.log(t,n),console.trace()}o&&console.groupEnd(),this.shouldCacheLogs&&this.cachedLogPile.push({level:m[e],message:t,extraInfo:n})}},e.LOG_LEVEL_PROD=m.error,e.LOG_LEVEL_DEV=m.trace,e.\u0275fac=function(t){return new(t||e)(Object(r.gc)(zt))},e.\u0275prov=Object(r.Sb)({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(function(){return function(t){var e=this;t.forEach((function(t){e[t]=e[t].bind(e)}))}}()),Bt=function(){function t(){this._api=null}return t.prototype._noop=function(){},t.prototype.buildEvent=function(t,e){return{addListener:t||this._noop,removeListener:e||this._noop}},t.prototype.constructApi=function(){this._api=window.chrome,this._api.management={},this._api.management.onInstalled=this.buildEvent(this.onInstalled,this._noop),this._api.management.onEnabled=this.buildEvent(this._noop,this._noop),this._api.management.onDisabled=this.buildEvent(this._noop,this._noop),this._api.management.onUninstalled=this.buildEvent(this._noop,this._noop),this._api.management.get=this.getExtension,this._api.management.getAll=this.getAllExtensions,this._api.management.getSelf=this.getSelf,this._api.runtime.onSuspendCanceled=this.buildEvent(this._noop,this._noop),this._api.tabs.reload=this.reloadTab,this._api.tabs.onReplaced=this.buildEvent(this._noop,this._noop),this._api.runtime.onSuspend=this.buildEvent(this._noop,this._noop)},t.prototype.onInstalled=function(t){this._api.runtime.onInstalled.addListener((function(e){if("install"===e.reason||"update"===e.reason){var n={id:this.api.runtime.id,name:this.api.runtime.getManifest().name,version:this.api.runtime.getManifest().version,installType:"normal",enabled:!0};t(n)}}))},t.prototype.constructExtension=function(){return{id:this._api.runtime.id,name:this._api.runtime.getManifest().name,version:this._api.runtime.getManifest().version,installType:"normal",enabled:!0}},t.prototype.getSelf=function(t){t(this.constructExtension())},t.prototype.getExtension=function(t,e){this.getSelf(e)},t.prototype.getAllExtensions=function(t){t([this.constructExtension()])},t.prototype.reloadTab=function(t,e){this._api.tabs.get(t,(function(t){t&&this.api.tabs.update(t.id,{url:t.url})}))},t}(),Jt=function(t){function e(){return t.call(this)||this}return Object(l.c)(e,t),Object.defineProperty(e.prototype,"api",{get:function(){return this._api||this.constructApi(),this._api},enumerable:!0,configurable:!0}),e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Object(r.Sb)({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(Bt),qt=function(t){function e(){return t.call(this)||this}return Object(l.c)(e,t),Object.defineProperty(e.prototype,"api",{get:function(){return this._api||this.constructApi(),this._api},enumerable:!0,configurable:!0}),e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Object(r.Sb)({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(Bt),Gt=function(){function t(t,e,n,r){var i=this;this.edge=t,this.firefox=e,this.sanitizer=n,this.consoleSvc=r,this._api=null,this.callbackDecorator=function(t,e,n,r){var o=n;return new Promise((function(s,c){e.apply(void 0,Object(l.f)(n,[function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var a=i.api.runtime.lastError;a?(i.consoleSvc.error("Browser api error: "+t+"("+o.join(", ")+"):",a.message),c(a)):r?s(r.apply(void 0,Object(l.f)(e))):s()}]))}))}}return Object.defineProperty(t.prototype,"api",{get:function(){if(!this._api)switch(this.browser){case y.chrome:this._api=chrome;break;case y.firefox:this._api=this.firefox.api;break;case y.edge:this._api=this.edge.api}return this._api},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return window.__browserName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"browser",{get:function(){return y[this.name]},enumerable:!0,configurable:!0}),t.prototype.getSanitizedLocalizedMessage=function(t,e){var n=this.getLocalizedMessage(t,e);return this.sanitizer.bypassSecurityTrustHtml(n)},t.prototype.getLocalizedMessage=function(t,e){var n;try{n=this.api.i18n.getMessage(t,e)}catch(r){this.consoleSvc.error("getLocalizedMessage failed for "+t+" with "+e)}return n},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(qt),Object(r.gc)(Jt),Object(r.gc)(i.b),Object(r.gc)(Wt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Kt=function(){function t(t){this.consoleSvc=t}return t.prototype.handleError=function(t,e){void 0===e&&(e=!0),At.a&&!e?At.a.track(t.originalError||t):this.consoleSvc.error(t.message,t)},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Wt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Xt=function(){function t(t,e,n,r){this.http=t,this.consoleSvc=e,this.configSvc=n,this.exceptionHandler=r}return t.prototype.executeRequest=function(t){var e=this;return new Promise((function(n,r){t.pipe(Object(kt.a)(Z.HTTP_RETRIES)).subscribe((function(t){n(t)}),(function(t){200===t.status?(e.exceptionHandler.handleError(new Error("HTTP request responded with error, but status = 200: "+t),!1),n()):(e.exceptionHandler.handleError(new Error("HTTP request retried and failed: "+JSON.stringify(t)+": "+console.trace()),!1),r(t))}))}))},t.prototype.getText=function(t){var e=this;return new Promise((function(n,r){e.http.get(t,{responseType:"text"}).pipe(Object(kt.a)(Z.HTTP_RETRIES)).subscribe((function(t){return n(t)}),(function(t){e.exceptionHandler.handleError(t,!1),r(t)}))}))},t.prototype.get=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executeRequest(this.http.get(t))];case 1:return[2,e.sent()]}}))}))},t.prototype.post=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.executeRequest(this.http.post(t,e,{responseType:"json",headers:(new s.c).set("Content-Type","application/x-www-form-urlencoded")}))];case 1:return[2,n.sent()]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(s.a),Object(r.gc)(Wt),Object(r.gc)(zt),Object(r.gc)(Kt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Vt=function(){function t(t,e){this.browser=t,this.configSvc=e,this.HTTP_URLS="http://*/*",this.HTTPS_URLS="https://*/*",this._onRuntimeInstalled=new b.b,this.onRuntimeInstalled=this._onRuntimeInstalled.asObservable(),this._onRuntimeStartup=new b.b,this.onRuntimeStartup=this._onRuntimeStartup.asObservable(),this._onRuntimeSuspend=new b.b,this.onRuntimeSuspend=this._onRuntimeSuspend.asObservable(),this._onRuntimeSuspendCanceled=new b.b,this.onRuntimeSuspendCanceled=this._onRuntimeSuspendCanceled.asObservable(),this._onRuntimeMessage=new b.b,this.onRuntimeMessage=this._onRuntimeMessage.asObservable(),this._onTabCreated=new b.b,this.onTabCreated=this._onTabCreated.asObservable(),this._onTabRemoved=new b.b,this.onTabRemoved=this._onTabRemoved.asObservable(),this._onBeforeWebRedirect=new b.b,this.onBeforeWebRedirect=this._onBeforeWebRedirect.asObservable(),this._onBeforeWebRequest=new b.b,this.onBeforeWebRequest=this._onBeforeWebRequest.asObservable(),this._onWebRequestCompleted=new b.b,this.onWebRequestCompleted=this._onWebRequestCompleted.asObservable(),this._onWebNavigationCommitted=new b.b,this.onWebNavigationCommitted=this._onWebNavigationCommitted.asObservable(),this._onWebNavigationDOMContentLoaded=new b.b,this.onWebNavigationDOMContentLoaded=this._onWebNavigationDOMContentLoaded.asObservable(),this._onStorageChanged=new b.b,this.onStorageChanged=this._onStorageChanged.asObservable(),this._onCookiesChanged=new b.b,this.onCookiesChanged=this._onCookiesChanged.asObservable(),this._onStartSurveyLogging=new b.b,this.onStartSurveyLogging=this._onStartSurveyLogging.asObservable(),this._onEndSurveyLogging=new b.b,this.onEndSurveyLogging=this._onEndSurveyLogging.asObservable(),this._onUpdateSurveyLogging=new b.b,this.onUpdateSurveyLogging=this._onUpdateSurveyLogging.asObservable(),this._onInstallTutorialLoaded=new b.b,this.onInstallTutorialLoaded=this._onInstallTutorialLoaded.asObservable(),this._onNotificationClicked=new b.b,this.onNotificationClicked=this._onNotificationClicked.asObservable()}return t.prototype.init=function(){var t=this,e=function(e){t._onRuntimeInstalled.next(e)};this.browser.api.runtime.onInstalled.removeListener(e),this.browser.api.runtime.onInstalled.addListener(e);var n=function(){t._onRuntimeStartup.next()};this.browser.api.runtime.onStartup.removeListener(n),this.browser.api.runtime.onStartup.addListener(n);var r=function(){t._onRuntimeSuspend.next()};this.browser.api.runtime.onSuspend.removeListener(r),this.browser.api.runtime.onSuspend.addListener(r);var i=function(){t._onRuntimeSuspendCanceled.next()};this.browser.api.runtime.onSuspendCanceled.removeListener(i),this.browser.api.runtime.onSuspendCanceled.addListener(i);var o=function(e,n,r){return t._onRuntimeMessage.next([e,n,r]),!0};this.browser.api.runtime.onMessage.removeListener(o),this.browser.api.runtime.onMessage.addListener(o);var s=function(e){t._onTabCreated.next(e)};this.browser.api.tabs.onCreated.removeListener(s),this.browser.api.tabs.onCreated.addListener(s);var c=function(e){t._onTabRemoved.next(e)};this.browser.api.tabs.onRemoved.removeListener(c),this.browser.api.tabs.onRemoved.addListener(c);var a=function(e){t._onBeforeWebRequest.next(e),t._onUpdateSurveyLogging.next({event:"onBeforeRequest",details:e})};this.browser.api.webRequest.onBeforeRequest.removeListener(a),this.browser.api.webRequest.onBeforeRequest.addListener(a,{urls:[this.HTTP_URLS,this.HTTPS_URLS],types:["main_frame"]});var u=function(e,n){t._onStorageChanged.next([e,n])};this.browser.api.storage.onChanged.removeListener(u),this.browser.api.storage.onChanged.addListener(u);var h=function(e){t._onCookiesChanged.next(e)};this.browser.api.cookies.onChanged.removeListener(h),this.browser.api.cookies.onChanged.addListener(h);var l=function(e){t._onBeforeWebRedirect.next(e),t._onUpdateSurveyLogging.next({event:"onBeforeRedirect",details:e})};this.browser.api.webRequest.onBeforeRedirect.removeListener(l),this.browser.api.webRequest.onBeforeRedirect.addListener(l,{urls:[this.HTTP_URLS,this.HTTPS_URLS],types:["main_frame"]});var d=function(e){t._onUpdateSurveyLogging.next({event:"onCompleted",details:e}),t._onWebRequestCompleted.next(e)};this.browser.api.webRequest.onCompleted.removeListener(d),this.browser.api.webRequest.onCompleted.addListener(d,{urls:[this.HTTP_URLS,this.HTTPS_URLS],types:["main_frame"]});var p=function(e){t._onUpdateSurveyLogging.next({event:"onErrorOccurred",details:e})};this.browser.api.webRequest.onErrorOccurred.removeListener(p),this.browser.api.webRequest.onErrorOccurred.addListener(p,{urls:[this.HTTP_URLS,this.HTTPS_URLS],types:["main_frame"]});var b=function(e){t._onWebNavigationCommitted.next(e)};this.browser.api.webNavigation.onCommitted.removeListener(b),this.browser.api.webNavigation.onCommitted.addListener(b,{url:[{schemes:["https","http"]}]});var f=function(e){t._onWebNavigationDOMContentLoaded.next(e)};this.browser.api.webNavigation.onDOMContentLoaded.removeListener(f),this.browser.api.webNavigation.onDOMContentLoaded.addListener(f,{url:[{schemes:["https","http"]}]});var g=["main_frame"],v={urls:[this.configSvc.hostDomain+"/g/survey-click?*"],types:g},m={urls:[this.configSvc.hostDomain+"/surveys?*"],types:g},O=function(e){t._onStartSurveyLogging.next(e)};this.browser.api.webRequest.onBeforeRequest.removeListener(O),this.browser.api.webRequest.onBeforeRequest.addListener(O,v);var j=function(e){t._onEndSurveyLogging.next(e)};if(this.browser.api.webRequest.onCompleted.removeListener(j),this.browser.api.webRequest.onCompleted.addListener(j,m),this.configSvc.installTutorialUrl){var y={url:[{urlPrefix:""+this.configSvc.installTutorialUrl,queryContains:"isNew=1"}]},S=function(e){t._onInstallTutorialLoaded.next(e)};this.browser.api.webNavigation.onCompleted.removeListener(S),this.browser.api.webNavigation.onCompleted.addListener(S,y)}if(this.browser.api.notifications){var w=function(e){t._onNotificationClicked.next(e)};this.browser.api.notifications.onClicked.removeListener(w),this.browser.api.notifications.onClicked.addListener(w),this.browser.api.notifications.onButtonClicked.removeListener(w),this.browser.api.notifications.onButtonClicked.addListener(w)}},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Gt),Object(r.gc)(zt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Qt=function(){function t(t,e){this.browser=t,this.browserEvents=e,this.TIMED_EXPIRATION=6,this.STORAGE_AREA_LOCAL="local",this._browserStorageLocalChanged=new b.b,this.browserStorageLocalChanged=this._browserStorageLocalChanged.asObservable(),this._extId=null,this._extHash=null,this.prefs=new R("prefs"),this.flags=new R(Z.FLAGS_STORAGE_KEY),this.config=new R("config"),this.campaign=new D(new N("campaign",this.browser.api),this.browserStorageLocalChanged),this.referral=new R("referral"),this.merchants=new L(new R("merchants")),this.identifier=new R("identifier"),this.lastPeerLog=new R("last-peer-log"),this.dataInsights=new E(new R("data-insights"),this.TIMED_EXPIRATION),this.lastCallback=new R("last-callback"),this.lastCallbackTry=new R("last-callback-try"),this.siteMapHash=new R("site-map-hash"),this.merchantHash=new R("merchant-hash"),this.affiliateHash=new R("affiliate-hash"),this.tutorialViewed=new R(Z.TUTORIAL_KEY),this.featuredMerchants=new R("featured-merchants"),this.shopBonusLastShown=new R("shop-bonus-last-shown"),this.couponMerchantScripts=new E(new R("coupon-scripts"),this.TIMED_EXPIRATION),this.jsonCouponMerchantScripts=new E(new R("json-coupon-scripts"),this.TIMED_EXPIRATION),this.extensionAlert=new R("extension-alert"),this.token=new R("token"),this.member=new R("member")}return Object.defineProperty(t.prototype,"extId",{get:function(){return this._extId||(this._extId=new D(new N("ext-id",this.browser.api),this.browserStorageLocalChanged)),this._extId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extHash",{get:function(){return this._extHash||(this._extHash=new D(new N("ext-hash",this.browser.api),this.browserStorageLocalChanged)),this._extHash},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=this;this.browserEvents.onStorageChanged.subscribe((function(e){t.onBrowserStorageChanged.apply(t,e)}))},t.prototype.getLocal=function(t){var e=localStorage.getItem(t);try{return JSON.parse(e)}catch(n){return e}},t.prototype.setLocal=function(t,e){localStorage.setItem(t,JSON.stringify(e))},t.prototype.removeLocal=function(t){localStorage.removeItem(t)},t.prototype.onBrowserStorageChanged=function(t,e){e===this.STORAGE_AREA_LOCAL&&this._browserStorageLocalChanged.next(t)},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Gt),Object(r.gc)(Vt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Yt=function(){function t(t,e,n,r,i,o){this.browser=t,this.consoleSvc=e,this.configSvc=n,this.networkSvc=r,this.storage=i,this.exceptions=o,this.API_COMMANDS={PONG:new U("ext-pong"),LOGIN:new U("ext-login"),UPDATE:new U("ext-update"),INSTALL:new U("ext-install",!1),CALLBACK:new U("ext-callback"),REGISTER:new U("ext-register"),UNINSTALL:new U("ext-uninstall"),RECONNECT:new U("ext-reconnect"),REISSUE_ID:new U("ext-reissue",!1),CAMPAIGN_DATA:new U("ext-cmp-data"),LOG_COUPONS:new U("ext-log-coupon"),LOG_MERCHANT_SESSION:new U("ext-log-merchant"),LOG_SURVEY_REDIRECTS:new U("ext-log-survey-redirect"),SEND_PASSWORD_REMINDER:new U("sb-pswd-reminder",!1),CHECK_PROMO_CODE:new U("ext-check-code"),REDEEM_PROMO_CODE:new U("sb-gimme-jx"),GET_BALANCE:new U("ext-account-balance"),REFERRAL:new U("ext-referral"),CHECK_OFFER_PLACEMENT:new U("oh-ext-placement-available"),CHECK_SHOPPER_MARKETING_OFFER:new U("ext-get-shm-merchant-offers"),LOG_PEER:new U("ext-log-peer"),UPDATE_MEMBER_PREFS:new U("ext-update-member-prefs"),GET_TOKEN:new U("ext-get-token")},this.SUPPRESS_DEFAULT_ARGS=!0,this.legacyHashes=new F,this._badHashDetected=new b.b,this.badHashDetected=this._badHashDetected.asObservable()}return Object.defineProperty(t.prototype,"version",{get:function(){return this.browser.api.runtime.getManifest().version},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cacheBuster",{get:function(){var t=p()().unix();return t-t%300},enumerable:!0,configurable:!0}),t.prototype.generateApiCommandUrl=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i,o;return Object(l.d)(this,(function(s){switch(s.label){case 0:return r=new f(this.configSvc.apiHost+"?cmd="+t.command),n?(o={},[3,3]):[3,1];case 1:return[4,this.getDefaultArgs()];case 2:o=s.sent(),s.label=3;case 3:if((i=o)&&r.addQuery(i),e&&r.addQuery(e),t.requiresHash&&(!r.hasQuery("extid")||!r.hasQuery("hash"))&&!n)throw this._badHashDetected.next(),new Error("ApiCommand "+t.command+" missing required args for hash validation.");return[2,r.toString()]}}))}))},t.prototype.getDefaultArgs=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o;return Object(l.d)(this,(function(s){switch(s.label){case 0:return t={},[4,this.storage.extId.get()];case 1:return e=s.sent(),[4,this.storage.extHash.get()];case 2:return n=s.sent(),[4,this.storage.token.get()];case 3:return r=s.sent(),[4,this.getMemberId()];case 4:return i=s.sent(),o=this.version,e&&(t.extid=e),n&&(t.hash=n),r&&(t.secTkn=r),(i||0===i)&&(t.mid=i),o&&(t.v=o),[2,t]}}))}))},t.prototype.getFormData=function(t){return Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&")},t.prototype.checkIfResponseHasBadStatus=function(t,e){return!e&&1001===t&&(this._badHashDetected.next(),this.consoleSvc.debug("Bad Hash 1001 in response"),!0)},t.prototype.executeApiCommand=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i,o;return Object(l.d)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,this.generateApiCommandUrl(t,e,n)];case 1:return r=s.sent(),[4,this.networkSvc.get(r)];case 2:if((i=s.sent())&&!this.checkIfResponseHasBadStatus(i.status,n))return[2,i];throw new Error("No valid response for the command "+t.command+", url: "+r);case 3:return o=s.sent(),this.exceptions.handleError(o),[2,null];case 4:return[2]}}))}))},t.prototype.executeTextApiCommand=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i;return Object(l.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,this.generateApiCommandUrl(t,e,n)];case 1:return r=o.sent(),[4,this.networkSvc.getText(r)];case 2:return[2,o.sent()];case 3:return i=o.sent(),this.exceptions.handleError(i),[2,null];case 4:return[2]}}))}))},t.prototype.executePostApiCommand=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i,o,s,c,a;return Object(l.d)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,6,,7]),[4,this.generateApiCommandUrl(t,{},this.SUPPRESS_DEFAULT_ARGS)];case 1:return r=u.sent(),n?(o={},[3,4]):[3,2];case 2:return[4,this.getDefaultArgs()];case 3:o=u.sent(),u.label=4;case 4:if(i=o,t.requiresHash&&!(i&&i.extid&&i.hash))throw this._badHashDetected.next(),new Error("ApiCommand "+t.command+" missing required args for hash validation.");return Object.assign(i,e),s=this.getFormData(i),[4,this.networkSvc.post(r,s)];case 5:if((c=u.sent())&&!this.checkIfResponseHasBadStatus(c.status,n))return[2,c];throw new Error("No valid response for the command "+t.command+", url: "+r);case 6:return a=u.sent(),this.exceptions.handleError(a),[2,null];case 7:return[2]}}))}))},t.prototype.getMemberId=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.storage.member.get()];case 1:return[2,(t=e.sent())?t.id:null]}}))}))},t.prototype.sanitize=function(t){var e,n,r={};try{for(var i=Object(l.g)(Object.keys(t)),o=i.next();!o.done;o=i.next()){var s=o.value;null!=t[s]&&(r[s]=t[s])}}catch(c){e={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},t.prototype.executeCallback=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.CALLBACK)];case 1:return[2,t.sent()]}}))}))},t.prototype.executeInstall=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return t={v:this.version},[4,this.storage.token.get()];case 1:return(e=n.sent())&&(t.secTkn=e),[4,this.executeApiCommand(this.API_COMMANDS.INSTALL,t,this.SUPPRESS_DEFAULT_ARGS)];case 2:return[2,n.sent()]}}))}))},t.prototype.executeLogin=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.executePostApiCommand(this.API_COMMANDS.LOGIN,{emailAddress:t,pswd:e})];case 1:return[2,n.sent()]}}))}))},t.prototype.executePong=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.PONG,{msgValue:t.value})];case 1:return[2,e.sent()]}}))}))},t.prototype.executeReconnect=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.RECONNECT)];case 1:return[2,t.sent()]}}))}))},t.prototype.executeRegister=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executePostApiCommand(this.API_COMMANDS.REGISTER,{emailAddress:t})];case 1:return[2,e.sent()]}}))}))},t.prototype.executeReissueId=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,i;return Object(l.d)(this,(function(o){switch(o.label){case 0:return[4,this.getMemberId()];case 1:return e=o.sent(),[4,this.storage.token.get()];case 2:return n=o.sent(),r={v:this.version},n&&(r.secTkn=n),e&&(r.mid=e),t&&(r.tbid=t),[4,this.executeApiCommand(this.API_COMMANDS.REISSUE_ID,r,this.SUPPRESS_DEFAULT_ARGS)];case 3:return i=o.sent(),[4,this.storage.extId.set(i.data.extension.id,!0)];case 4:return o.sent(),[4,this.storage.extHash.set(i.data.extension.hashes.extension,!0)];case 5:return o.sent(),[2,i]}}))}))},t.prototype.executeUpdate=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.UPDATE)];case 1:return[2,t.sent()]}}))}))},t.prototype.executeSurveyLog=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executePostApiCommand(this.API_COMMANDS.LOG_SURVEY_REDIRECTS,t)];case 1:return[2,e.sent()]}}))}))},t.prototype.constructCdnUrl=function(t){return this.configSvc.cdnHost+"/json/extension/"+t+".json?v="+this.cacheBuster},t.prototype.fetchFromCdn=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return e=this.constructCdnUrl(t),[4,this.networkSvc.get(e)];case 1:return[2,n.sent()]}}))}))},t.prototype.fetchMerchants=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return[4,this.fetchFromCdn("merchant-map/"+this.configSvc.client+"-"+e+"-"+t)];case 1:return n=i.sent(),r=Object.entries(n),[2,new Map(r)]}}))}))},t.prototype.fetchCdnJson=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return e=this.constructCdnUrl(t),[4,this.networkSvc.getText(e)];case 1:return[2,n.sent()]}}))}))},t.prototype.fetchMerchantJson=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.fetchCdnJson("merchant/"+t)];case 1:return[2,e.sent()]}}))}))},t.prototype.fetchDiscoverPlacementJson=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.fetchCdnJson("offer-placement/"+t)];case 1:return[2,e.sent()]}}))}))},t.prototype.fetchSiteMapJson=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.fetchFromCdn("site-map/"+t)];case 1:return[2,e.sent()]}}))}))},t.prototype.getUninstallUrl=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.generateApiCommandUrl(this.API_COMMANDS.UNINSTALL)];case 1:return[2,t.sent()]}}))}))},t.prototype.sendPasswordReminder=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executePostApiCommand(this.API_COMMANDS.SEND_PASSWORD_REMINDER,{email:t},this.SUPPRESS_DEFAULT_ARGS)];case 1:return e.sent(),[2]}}))}))},t.prototype.fetchAffiliateNetworks=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.fetchFromCdn("affiliate-list/"+t)];case 1:return[2,e.sent()]}}))}))},t.prototype.postCampaignData=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executePostApiCommand(this.API_COMMANDS.CAMPAIGN_DATA,this.sanitize(t))];case 1:return e.sent(),[2]}}))}))},t.prototype.postReferralData=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return e=t,n="referredID",[4,this.getMemberId()];case 1:return e[n]=r.sent(),[4,this.executePostApiCommand(this.API_COMMANDS.REFERRAL,t)];case 2:return[2,r.sent().status]}}))}))},t.prototype.postCouponLog=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.consoleSvc.debug("Posting Coupon Log. CouponApplyResults:",t),t.couponDetails=JSON.stringify(t.couponDetails),[4,this.executePostApiCommand(this.API_COMMANDS.LOG_COUPONS,t)];case 1:return 0!==(e=n.sent()).status&&this.consoleSvc.debug("Problem with postCouponLog. Code:"+e.status+" , couponApplyResults:",t),[2]}}))}))},t.prototype.postMerchantSessionLog=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.consoleSvc.debug("Posting Merchant Session Log. MerchantSessionLog:",t),t.merchantActivationHistory=JSON.stringify(t.merchantActivationHistory),[4,this.executePostApiCommand(this.API_COMMANDS.LOG_MERCHANT_SESSION,t)];case 1:return 0!==(e=n.sent()).status&&this.consoleSvc.debug("Problem with postMerchantSessionLog. Code:"+e.status+" , merchantSessionLog:",t),[2]}}))}))},t.prototype.postPeerLog=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.executePostApiCommand(this.API_COMMANDS.LOG_PEER,t)];case 1:return(e=n.sent())&&e.status===j.OK||this.exceptions.handleError(new Error("Failed to post peer log: "+JSON.stringify({log:t,response:e}))),[2]}}))}))},t.prototype.updateMemberPrefs=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.UPDATE_MEMBER_PREFS,{prefs:t})];case 1:return[2,e.sent()]}}))}))},t.prototype.checkPromoCode=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.CHECK_PROMO_CODE)];case 1:return[2,t.sent()]}}))}))},t.prototype.redeemPromoCode=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executePostApiCommand(this.API_COMMANDS.REDEEM_PROMO_CODE,{hdnCmd:"sb-gimme",pcode:t,sid:x[this.browser.browser]})];case 1:return[2,e.sent()]}}))}))},t.prototype.checkOfferPlacement=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.CHECK_OFFER_PLACEMENT,{placementID:t})];case 1:return[2,e.sent()]}}))}))},t.prototype.checkShopperMarketingPlacement=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.CHECK_SHOPPER_MARKETING_OFFER,{merchantID:t})];case 1:return[2,e.sent()]}}))}))},t.prototype.getAccountBalance=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.GET_BALANCE)];case 1:return[2,t.sent()]}}))}))},t.prototype.getToken=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.executeApiCommand(this.API_COMMANDS.GET_TOKEN)];case 1:return[2,t.sent()]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Gt),Object(r.gc)(Wt),Object(r.gc)(zt),Object(r.gc)(Xt),Object(r.gc)(Qt),Object(r.gc)(Kt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Zt=function(){function t(t,e){this.browser=t,this.consoleSvc=e,this.registeredAlarms=new Map,this._beepingAlarmName=new b.b,this.beepingAlarmName=this._beepingAlarmName.asObservable()}return t.prototype.init=function(){return Object(l.b)(this,void 0,void 0,(function(){var t=this;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.clearAllAlarms()];case 1:return e.sent(),this.browser.api.alarms.onAlarm.addListener((function(e){var n=t.registeredAlarms.get(e.name);n&&(t.consoleSvc.debug(n.name+" beeping!"),t._beepingAlarmName.next(n.name))})),[2]}}))}))},t.prototype.registerAlarm=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i,o=this;return Object(l.d)(this,(function(s){switch(s.label){case 0:return[4,this.clearAlarm(t)];case 1:return s.sent(),r=this.beepingAlarmName.subscribe((function(e){return Object(l.b)(o,void 0,void 0,(function(){return Object(l.d)(this,(function(r){switch(r.label){case 0:return t!==e?[3,2]:[4,n()];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))})),i=new Q(t,e,r),this.registeredAlarms.set(i.name,i),this.browser.api.alarms.create(i.name,e),[2]}}))}))},t.prototype.clearAlarm=function(t){var e=this;return this.browser.callbackDecorator("alarms.clear",this.browser.api.alarms.clear,[t],(function(){e.registeredAlarms.has(t)&&(e.registeredAlarms.get(t).subscription.unsubscribe(),e.registeredAlarms.delete(t))}))},t.prototype.clearAllAlarms=function(){var t=this;return this.browser.callbackDecorator("alarms.clearAll",this.browser.api.alarms.clearAll,[],(function(){t.registeredAlarms.forEach((function(t){t.subscription.unsubscribe()})),t.registeredAlarms.clear()}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Gt),Object(r.gc)(Wt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),$t=function(){function t(t,e,n,r){this.alarmSvc=t,this.apiSvc=e,this.configSvc=n,this.consoleSvc=r,this.isConnected=!1,this._survey=new b.b,this._promoCode=new b.b,this._onReflect=new b.b,this.survey=this._survey.asObservable(),this.promoCode=this._promoCode.asObservable(),this.onReflect=this._onReflect.asObservable(),this.goferConfig={url:this.configSvc.goferHost,topics:[]},this.lastMessageInterval=12e4,this.minReconnectInterval=500,this.maxReconnectInterval=72e5,this.backoffRate=2,this.currentMinReconnectInterval=this.minReconnectInterval,this.currentMaxReconnectInterval=this.minReconnectInterval*this.backoffRate}return t.prototype.routeMessage=function(t){switch(t.type){case"FLAGS":this.configSvc.updateConfiguration(et.flags,t.msg);break;case"SURVEY":this._survey.next(t);break;case"REFLECT":this._onReflect.next(t.msg);break;case"PING_PONG":this.apiSvc.executePong(t);break;case"PROMO_CODE":this._promoCode.next(t);break;case"SITE_MAP":this.configSvc.updateConfiguration(et.siteMapHash,t.msg);break;case"MERCHANT_LIST":this.configSvc.updateConfiguration(et.merchantHash,t.msg);break;case"AFFILIATE_LIST":this.configSvc.updateConfiguration(et.affiliateHash,t.msg);break;case"FEATURED_MERCHANTS":this.configSvc.updateConfiguration(et.featuredMerchants,t.msg);break;default:this.consoleSvc.debug("Invalid Gofer message type:",t.type)}},t.prototype.close=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){return!this.socket||this.socket.closed?this.isConnected=!1:this.socket.complete(),[2]}))}))},t.prototype.connect=function(){return Object(l.b)(this,void 0,void 0,(function(){var t=this;return Object(l.d)(this,(function(e){return this.lastConnectionAttempt=p()(),this.socket=Object(Rt.a)(this.goferConfig.url),this.socket.subscribe((function(e){return t.publishMessage(e)}),(function(e){return t.onSocketError(e)}),(function(){return t.onSocketComplete()})),[2]}))}))},t.prototype.hasOpenConnection=function(){return this.isConnected&&this.socket&&!this.socket.closed&&this.lastMessageReceived&&Date.now()-this.lastMessageReceived<=this.lastMessageInterval},t.prototype.hasValidGoferConfig=function(){return this.goferConfig&&this.goferConfig.url&&this.goferConfig.topics&&this.goferConfig.topics.length>0},t.prototype.onSocketComplete=function(){this.consoleSvc.debug("connection closed"),this.isConnected=!1},t.prototype.onSocketError=function(t){this.consoleSvc.debug("socket error"+JSON.stringify(t)),this.isConnected=!1,this.retryConnection()},t.prototype.publishMessage=function(t){this.consoleSvc.debug("received a message:"+JSON.stringify(t)),this.lastMessageReceived=p()(),this.isConnected||(this.isConnected=!0,this.updateSubscriptions(),this.resetRetryIntervals()),V.isValid(t)&&this.routeMessage(t)},t.prototype.refreshConnection=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.consoleSvc.debug("refresh connection"),[4,this.close()];case 1:return t.sent(),[4,this.connect()];case 2:return[2,t.sent()]}}))}))},t.prototype.resetRetryIntervals=function(){this.currentMinReconnectInterval=this.minReconnectInterval,this.currentMaxReconnectInterval=this.minReconnectInterval*this.backoffRate},t.prototype.retryConnection=function(){var t=this;if(this.isConnected)this.consoleSvc.debug("already connected, aborting retry connection");else if(this.lastConnectionAttempt+this.currentMinReconnectInterval<Date.now())this.consoleSvc.debug("retrying connection..."),this.currentMinReconnectInterval=this.currentMinReconnectInterval*this.backoffRate,this.currentMaxReconnectInterval=this.currentMaxReconnectInterval*this.backoffRate,this.connect();else{var e=Math.floor(Math.random()*(this.currentMaxReconnectInterval-this.currentMinReconnectInterval))+this.currentMinReconnectInterval;this.consoleSvc.debug("will attempt retry between "+this.currentMinReconnectInterval+" and "+this.currentMaxReconnectInterval+" ("+(e=e>this.maxReconnectInterval?this.maxReconnectInterval:e)+")..."),setTimeout((function(){t.retryConnection()}),e)}},t.prototype.updateGoferConfig=function(t){t.url&&t.url!=this.goferConfig.url?(this.goferConfig=t,this.refreshConnection()):t.topics!=this.goferConfig.topics&&(this.goferConfig=t,this.updateSubscriptions())},t.prototype.updateSubscriptions=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){return this.hasOpenConnection()&&this.socket.next(JSON.parse('{"command": "replace", "topics": '+JSON.stringify(this.goferConfig.topics)+"}")),[2]}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Zt),Object(r.gc)(Yt),Object(r.gc)(zt),Object(r.gc)(Wt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),te=function(){function t(t,e){this.storageSvc=t,this.configurationSvc=e,this.legacyIdStorageName="legacyId",this.legacyMemberPreferenceNewStorageName="legacyMemberSettings",this.legacyMemberPreferenceOldStorageName="SE_Settings"}return Object.defineProperty(t.prototype,"legacyExtensionStorageName",{get:function(){return this.configurationSvc.client===w.tada?Z.LEGACY_ID_NAMES.TADA:Z.LEGACY_ID_NAMES.SBMP},enumerable:!0,configurable:!0}),t.prototype.getLegacyMemberPreference=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.storageSvc.getLocal(this.legacyMemberPreferenceOldStorageName)];case 1:return(t=e.sent())&&(t=JSON.parse(t.replace("obj_",""))),[2,t]}}))}))},t.prototype.getLegacyId=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.storageSvc.getLocal(this.legacyExtensionStorageName)];case 1:return[2,t.sent()]}}))}))},t.prototype.renameLegacyId=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.storageSvc.getLocal(this.legacyExtensionStorageName)];case 1:return t=e.sent(),[4,this.storageSvc.setLocal(this.legacyIdStorageName,t)];case 2:return e.sent(),[4,this.storageSvc.removeLocal(this.legacyExtensionStorageName)];case 3:return e.sent(),[2]}}))}))},t.prototype.renameLegacyMemberPreferences=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.storageSvc.getLocal(this.legacyMemberPreferenceOldStorageName)];case 1:return t=e.sent(),[4,this.storageSvc.setLocal(this.legacyMemberPreferenceNewStorageName,t)];case 2:return e.sent(),[4,this.storageSvc.removeLocal(this.legacyMemberPreferenceOldStorageName)];case 3:return e.sent(),[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Qt),Object(r.gc)(zt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),ee=function(){function t(t,e,n){this.console=t,this.browser=e,this.browserEvents=n,this.subscriptions=[]}return t.prototype.init=function(){var t=this;this.browserEvents.onCookiesChanged.subscribe((function(e){t.subscriptions.filter((function(t){return e.cookie.domain.includes(t.domainIncludes)&&e.cookie.name===t.name})).forEach((function(t){t.callback(e)}))}))},t.prototype.subscribe=function(t){this.subscriptions.push(t)},t.prototype.get=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n=this;return Object(l.d)(this,(function(r){return[2,new Promise((function(r,i){n.browser.api.cookies.getAll({name:t,domain:e},(function(t){var e=n.browser.api.runtime.lastError;e?(n.console.error("cookies.getAll error:",e),i(e)):r(t)}))}))]}))}))},t.prototype.remove=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n=this;return Object(l.d)(this,(function(r){return[2,new Promise((function(r,i){chrome.cookies.remove({name:t,url:e},(function(){var t=n.browser.api.runtime.lastError;t?(n.console.error("cookies.remove error:",t),i(t)):r()}))}))]}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Wt),Object(r.gc)(Gt),Object(r.gc)(Vt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),ne=function(){function t(t,e,n,r,i,o,s,c,a,u,h){this.alarmSvc=t,this.apiSvc=e,this.browser=n,this.exceptionHandler=r,this.goferSvc=i,this.consoleSvc=o,this.storage=s,this.legacyExtensionSvc=c,this.config=a,this.browserEvents=u,this.cookies=h,this.isUserAuthenticating=!1,this._onAccountInfoChanged=new b.b,this.onAccountInfoChanged=this._onAccountInfoChanged.asObservable(),this._onInstalled=new b.b,this.onInstalled=this._onInstalled.asObservable(),this._onTokenCookieChanged=new b.b,this.onTokenCookieChanged=this._onTokenCookieChanged.asObservable(),this.isInstallOrStartup=!1,this.getConfigsOnStartAlarmName="getFreshConfigsOnStart",this.getConfigsOnStartDelay=1,this.goferCheckAlarmName="GoferStatusCheck",this.goferCheckIntervalInMinutes=5,this.dailyCallbacksLimit=5,this.dailyCallbackCount=0,this.isReissuing=!1,this.isExecutingCallback=!1,this.onStartUpDelay=4e3}return t.prototype.init=function(){var t=this;this.browserEvents.onRuntimeStartup.pipe(Object(Lt.delay)(this.onStartUpDelay)).subscribe((function(){t.onStartup()})),this.browserEvents.onRuntimeInstalled.subscribe((function(e){t.onInstall(e)})),this.cookies.subscribe(new ft(this.config.rootDomain,Z.TOKEN_COOKIE,(function(e){t.onCookiesChanged(e)}))),this.apiSvc.badHashDetected.subscribe((function(){t.reissue(st.BadHashDetected)})),this.alarmSvc.registerAlarm(this.getConfigsOnStartAlarmName,{delayInMinutes:this.getConfigsOnStartDelay},(function(){return Object(l.b)(t,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.isInstallOrStartup?[3,4]:[4,this.loadAndStoreTokenCookie()];case 1:return t.sent(),[4,this.getFreshConfigs()];case 2:return t.sent(),[4,this.goferSvc.refreshConnection()];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))})),this.alarmSvc.registerAlarm(this.goferCheckAlarmName,{periodInMinutes:this.goferCheckIntervalInMinutes},(function(){return Object(l.b)(t,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.checkGoferConnection()];case 1:return t.sent(),[2]}}))}))}))},t.prototype.checkGoferConnection=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.consoleSvc.debug("checking gofer connection..."),this.goferSvc.hasValidGoferConfig()?[3,2]:(this.consoleSvc.debug("invalid configs, get some freshies"),[4,this.getFreshConfigs()]);case 1:t.sent(),t.label=2;case 2:return this.goferSvc.hasOpenConnection()?[3,4]:(this.consoleSvc.debug("no open connection, refresh it"),[4,this.goferSvc.refreshConnection()]);case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},t.prototype.getFreshConfigs=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.apiSvc.executeReconnect()];case 1:return t=e.sent(),[4,this.processResponse(t)];case 2:return e.sent(),[2]}}))}))},t.prototype.loadTokenCookieFromSite=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.cookies.get(Z.TOKEN_COOKIE,this.config.rootDomain)];case 1:return[2,(t=e.sent()).length?t[0]:null]}}))}))},t.prototype.loadAndStoreTokenCookie=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.loadTokenCookieFromSite()];case 1:return(t=e.sent())&&t.domain.includes(this.config.rootDomain)&&t.name===Z.TOKEN_COOKIE&&t.value?[4,this.storage.token.set(t.value)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},t.prototype.onCookiesChanged=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return t.removed||!t.cookie.value?[3,3]:[4,this.storage.token.set(t.cookie.value)];case 1:return e.sent(),this._onTokenCookieChanged.next(),this.isUserAuthenticating?[3,3]:[4,this.getFreshConfigs()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},t.prototype.onInstall=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,i,o,s;return Object(l.d)(this,(function(c){switch(c.label){case 0:return this.isInstallOrStartup=!0,[4,this.loadAndStoreTokenCookie()];case 1:switch(c.sent(),this.consoleSvc.debug("onInstall "+(e=t.reason)),e){case"install":return[3,2];case"update":return[3,9]}return[3,16];case 2:return this.isReissuing=!0,[4,this.apiSvc.executeInstall()];case 3:return n=c.sent(),[4,this.processResponse(n)];case 4:return c.sent(),[4,this.storage.campaign.get()];case 5:return(r=c.sent())?[4,this.apiSvc.postCampaignData(r)]:[3,7];case 6:c.sent(),c.label=7;case 7:return[4,this.setUninstallUrl()];case 8:return c.sent(),this._onInstalled.next(n),this.isReissuing=!1,[3,16];case 9:return[4,this.storage.extId.get()];case 10:return i=c.sent(),[4,this.storage.extHash.get()];case 11:return o=c.sent(),i&&o?[3,13]:[4,this.reissue(st.FalsyIdOrHashOnUpdate)];case 12:c.sent(),c.label=13;case 13:return[4,this.apiSvc.executeUpdate()];case 14:return s=c.sent(),[4,this.processResponse(s)];case 15:return c.sent(),[3,16];case 16:return this.goferSvc.hasOpenConnection()?[3,18]:[4,this.goferSvc.refreshConnection()];case 17:c.sent(),c.label=18;case 18:return[2]}}))}))},t.prototype.onStartup=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.isInstallOrStartup=!0,this.consoleSvc.debug("onStartup"),[4,this.storage.extId.get()];case 1:return t=n.sent(),[4,this.storage.extHash.get()];case 2:return e=n.sent(),[4,this.loadAndStoreTokenCookie()];case 3:return n.sent(),t&&e?[3,5]:[4,this.reissue(st.FalsyIdOrHashOnStartup)];case 4:return n.sent(),[3,7];case 5:return[4,this.getFreshConfigs()];case 6:n.sent(),n.label=7;case 7:return this.goferSvc.hasOpenConnection()?[3,9]:[4,this.goferSvc.refreshConnection()];case 8:n.sent(),n.label=9;case 9:return[2]}}))}))},t.prototype.onSuspend=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.consoleSvc.debug("onSuspend"),[4,this.goferSvc.close()];case 1:return t.sent(),[2]}}))}))},t.prototype.onSuspendCanceled=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.consoleSvc.debug("onSuspendCanceled"),[4,this.goferSvc.refreshConnection()];case 1:return t.sent(),[2]}}))}))},t.prototype.executeCallback=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s;return Object(l.d)(this,(function(c){switch(c.label){case 0:return[4,this.storage.extId.get()];case 1:return t=c.sent(),[4,this.storage.extHash.get()];case 2:return e=c.sent(),t&&e?[3,4]:[4,this.reissue(st.FalsyIdOrHashBeforeCallback)];case 3:return c.sent(),[2];case 4:return this.isExecutingCallback?[3,15]:(this.isExecutingCallback=!0,n=Et()().tz("America/Los_Angeles"),[4,this.storage.member.get()]);case 5:return r=c.sent(),[4,this.storage.lastCallback.get()];case 6:return i=c.sent(),[4,this.storage.lastCallbackTry.get()];case 7:return o=c.sent(),r?[3,9]:(this.consoleSvc.error("member object not found in executeCallback"),[4,this.onStartup()]);case 8:return c.sent(),[2];case 9:return!i||i.memberID!==r.id||i.timestamp<n.startOf("day").unix()?((!o||o.memberID!==r.id||o.timestamp<n.startOf("day").unix())&&(this.dailyCallbackCount=0),this.dailyCallbackCount>this.dailyCallbacksLimit?(this.exceptionHandler.handleError(new Error("executeCallback hits limit")),this.isExecutingCallback=!1,[2]):[4,this.storage.lastCallbackTry.set(new ot(r.id,n.unix()))]):[3,14];case 10:return c.sent(),this.dailyCallbackCount++,[4,this.apiSvc.executeCallback()];case 11:return(s=c.sent())&&0==s.status?[4,this.storage.lastCallback.set(new ot(r.id,n.unix()))]:[3,13];case 12:return c.sent(),this.consoleSvc.debug("executeCallback ok ",s),[3,14];case 13:this.exceptionHandler.handleError(new Error("executeCallback failed: "+JSON.stringify(s))),this.consoleSvc.debug("executeCallback failed ",s),c.label=14;case 14:this.isExecutingCallback=!1,c.label=15;case 15:return[2]}}))}))},t.prototype.verifyConfigs=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n=this;return Object(l.d)(this,(function(r){switch(r.label){case 0:return t.data&&t.data.extension?[4,(e=function(t,e){return Object(l.b)(n,void 0,void 0,(function(){var n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return[4,this.storage[t].get()];case 1:return n=i.sent(),(r=n!==e)&&void 0!==e?[4,this.storage[t].set(e)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2,r]}}))}))})("extId",t.data.extension.id)]:[3,7];case 1:return r.sent(),[4,e("flags",t.data.extension.configs.flags)];case 2:return r.sent(),[4,e("extHash",t.data.extension.hashes.extension)];case 3:return r.sent(),[4,e("siteMapHash",t.data.extension.hashes.sitemap)];case 4:return r.sent(),[4,e("merchantHash",t.data.extension.hashes.merchant)];case 5:return r.sent(),[4,e("affiliateHash",t.data.extension.hashes.affiliate)];case 6:r.sent(),this.config.updateConfiguration(et.flags,t.data.extension.configs.flags),t.data.extension.featuredMerchants&&this.config.updateConfiguration(et.featuredMerchants,t.data.extension.featuredMerchants),this.config.updateConfiguration(et.siteMapHash,t.data.extension.hashes.sitemap),this.config.updateConfiguration(et.merchantHash,t.data.extension.hashes.merchant),this.config.updateConfiguration(et.affiliateHash,t.data.extension.hashes.affiliate),At.a.configure({sessionId:String(t.data.extension.id)}),r.label=7;case 7:return[2]}}))}))},t.prototype.verifyMember=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(l.d)(this,(function(s){switch(s.label){case 0:return e=t.data.member,[4,this.updateLegacyMemberPreferences()];case 1:return(n=s.sent())&&(e.preferences=n),e?[4,this.storage.member.get()]:[3,11];case 2:if(r=s.sent(),i=!r,r)for(o in e)if(e[o]!==r[o]){i=!0;break}return i?(this._onAccountInfoChanged.next(e),[4,this.storage.extHash.get()]):[3,6];case 3:return s.sent()?[4,this.setUninstallUrl()]:[3,5];case 4:s.sent(),s.label=5;case 5:At.a.configure({userId:String(e.id)}),s.label=6;case 6:return[4,this.goferSvc.updateGoferConfig(e.gofer)];case 7:return s.sent(),e.alert?[4,this.storage.extensionAlert.set(e.alert)]:[3,9];case 8:return s.sent(),[3,11];case 9:return[4,this.storage.extensionAlert.remove()];case 10:s.sent(),s.label=11;case 11:return[2]}}))}))},t.prototype.updateLegacyMemberPreferences=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return t=0,[4,this.legacyExtensionSvc.getLegacyMemberPreference()];case 1:return null===(e=n.sent())?[3,5]:0==(t=(e&&e.isBalanceAlert?2:0)|(e&&e.isSurveyAlert?0:1))?[3,3]:[4,this.apiSvc.updateMemberPrefs(t)];case 2:n.sent(),n.label=3;case 3:return[4,this.legacyExtensionSvc.renameLegacyMemberPreferences()];case 4:n.sent(),n.label=5;case 5:return[2,t]}}))}))},t.prototype.processResponse=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return this.consoleSvc.debug("API Response:",t),t&&void 0!==t.status?t.status>0?(this.consoleSvc.error("Error processing response:"+t.status),[2]):[4,this.verifyMember(t)]:[2];case 1:return e.sent(),[4,this.verifyConfigs(t)];case 2:return e.sent(),[2]}}))}))},t.prototype.reissue=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return this.isReissuing?[3,11]:(this.isReissuing=!0,[4,this.legacyExtensionSvc.getLegacyId()]);case 1:return null!==(e=i.sent())?[3,4]:[4,this.apiSvc.executeReissueId()];case 2:return n=i.sent(),[4,this.processResponse(n)];case 3:return i.sent(),[3,10];case 4:return[4,this.apiSvc.executeReissueId(e)];case 5:return(r=i.sent())&&0==r.status?[4,this.legacyExtensionSvc.renameLegacyId()]:[3,7];case 6:return i.sent(),[3,8];case 7:this.exceptionHandler.handleError(new Error("executeReissueId failed when "+t+": "+JSON.stringify(r))),this.consoleSvc.debug("executeReissueId failed ",r),i.label=8;case 8:return[4,this.processResponse(r)];case 9:i.sent(),i.label=10;case 10:this.isReissuing=!1,i.label=11;case 11:return[2]}}))}))},t.prototype.setUninstallUrl=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,3,4]),[4,this.apiSvc.getUninstallUrl()];case 1:return t=n.sent(),this.browser.api.runtime.setUninstallURL(t),[3,4];case 2:return e=n.sent(),this.exceptionHandler.handleError(e),[3,4];case 3:case 4:return[2]}}))}))},t.prototype.showTutorial=function(t){var e=screen.width/2-368,n=screen.height/2-285,r=""+this.config.installTutorialUrl;r+="?btnId="+(this.config.browser===y.firefox?"":this.browser.api.runtime.id),t&&(r+="&isNew=1"),this.browser.api.windows.create({url:r,left:e,top:n,width:736,height:570,type:"popup"})},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Zt),Object(r.gc)(Yt),Object(r.gc)(Gt),Object(r.gc)(Kt),Object(r.gc)($t),Object(r.gc)(Wt),Object(r.gc)(Qt),Object(r.gc)(te),Object(r.gc)(zt),Object(r.gc)(Vt),Object(r.gc)(ee))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),re=function(){function t(t,e,n,r,i){this.consoleSvc=t,this.apiSvc=e,this.storage=n,this.configSvc=r,this.lifecycle=i,this._onAffiliateNetworksChanged=new b.b,this._hash=null,this._initialized=!1,this.onAffiliateNetworksChanged=this._onAffiliateNetworksChanged.asObservable()}return t.prototype.getHash=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return this._hash?[3,2]:(t=this,[4,this.storage.affiliateHash.get()]);case 1:t._hash=e.sent(),e.label=2;case 2:return[2,this._hash]}}))}))},Object.defineProperty(t.prototype,"initialized",{get:function(){return this._initialized},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=this;this.configSvc.onConfigurationChanged.subscribe((function(e){e.configuration===et.affiliateHash&&t.tryUpdateHash(e.value)})),this.fetch()},t.prototype.tryUpdateHash=function(t){this._hash!==t&&(this._hash=t,this.fetch())},t.prototype.fetch=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return[4,this.getHash()];case 1:return(t=i.sent())&&""!==t?[4,this.apiSvc.fetchAffiliateNetworks(t)]:[3,3];case 2:if(e=i.sent())for(n=e.length-1;n>=0;n--)if(r=e[n],n>=e.length-2&&r.length>100&&r[0]==r[3]&&["SB","MP","SM"].indexOf(r.substring(1,3))>=0){this.networkMap=this.transformLegacyAffiliateData(r);break}return this._initialized=!0,this._onAffiliateNetworksChanged.next(),[3,4];case 3:this.consoleSvc.debug("No valid hash when fetch for affiliate service"),i.label=4;case 4:return[2]}}))}))},t.prototype.checkForAffiliateRedirect=function(t){var e=new H(!1,!1);if(!t)return e;if(!this.networkMap)return this.lifecycle.getFreshConfigs(),e;try{e.isOwnRedirect=this.isOwnRedirect(t),this.networkMap&&(e=this.checkForAffiliateRedirectInNetworkMap(t,e))}catch(n){this.consoleSvc.error("Failed to check for affiliate redirect.",n)}return e},t.prototype.checkForAffiliateRedirectInNetworkMap=function(t,e){for(var n,r,i=0;i<t.stack.length;i++){var o=t.stack[i];for(var s in this.networkMap)if(this.networkMap.hasOwnProperty(s)){var c=this.networkMap[s];if(Array.isArray(c))try{for(var a=(n=void 0,Object(l.g)(c)),u=a.next();!u.done;u=a.next())this.getDetails(t,s,o,u.value).isAffiliateRedirect&&(e.isAffiliateRedirect=!0)}catch(h){n={error:h}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}else this.getDetails(t,s,o,c).isAffiliateRedirect&&(e.isAffiliateRedirect=!0)}}return e},t.prototype.isOwnRedirect=function(t){var e=[this.configSvc.apiHost+Z.DEFAULT_REDIRECT_ENDPOINT,this.configSvc.hostGoDomain+Z.DEFAULT_REDIRECT_ENDPOINT,this.configSvc.apiHost+"/?cmd="+Z.DISCOVER_CLICK_COMMAND];return t.stack.some((function(t){return e.some((function(e){return 0===t.indexOf(e)}))}))},t.prototype.transformLegacyAffiliateData=function(t){if((t=t.trim()).length<200)return this.consoleSvc.debug("String is too short"),null;var e=t.split(t[0]),n=e.length;if(n<20)return this.consoleSvc.debug("Array is too short"),null;for(var r={},i=null,o=null,s=n-3,c=2;c<s;c+=3){if(!(o=i?o:e[c]))return this.consoleSvc.debug("No domain for index "+c),null;i&&c--;var a={},u=e[c+1];if(i||"["!=u){if(i&&"]"==u){i=null,c--;continue}if(i&&","==u){if(u=e[1+ ++c],c>=s)break}else i?this.consoleSvc.debug("Bad element ("+u+") in array for index "+c):a=r[o]={}}else if(i=r[o]=[],u=e[1+ ++c],c>=s)break;if(i&&i.push(a),u){u.length>2&&"/"==u[0]&&"/"==u[u.length-1]&&(u=u.substring(1,u.length-1));try{a.regex=new RegExp(u)}catch(l){}}var h=e[c+2];if(h)if(/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/.test(a.host))a.host=h;else try{a.hostURLRegex=new RegExp(h)}catch(d){a.host=h}}return r["bestbuy.com"]&&(r["bestbuy.com"].hostURLRegex="bestbuy[.]com[/]([?]ref=)|([?].+&ref=)",delete r["bestbuy.com"].host),r},t.prototype.getDetails=function(t,e,n,r){var i=!1,o=n.includes(e)&&(!r.host||n.includes(r.host));return o&&!(i=r.regex?n.search(new RegExp(r.regex))>0:this.isOwnRedirect(t))&&r.hostURLRegex&&n.search(new RegExp(r.hostURLRegex))<=0&&(o=!1),new H(o,i)},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Wt),Object(r.gc)(Yt),Object(r.gc)(Qt),Object(r.gc)(zt),Object(r.gc)(ne))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),ie=function(){function t(t,e,n,r,i,o){this.consoleSvc=t,this.apiSvc=e,this.storage=n,this.exceptionHandler=r,this.config=i,this.browser=o,this.filters=[],this._onMerchantListChanged=new b.b,this._hash=null,this._initialized=!1,this.onMerchantListChanged=this._onMerchantListChanged.asObservable()}return t.prototype.getHash=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return this._hash?[3,2]:(t=this,[4,this.storage.merchantHash.get()]);case 1:t._hash=e.sent(),e.label=2;case 2:return[2,this._hash]}}))}))},Object.defineProperty(t.prototype,"initialized",{get:function(){return this._initialized},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=this;this.config.subscribeConfigChange(et.merchantHash,(function(e){t.tryUpdateHash(e)})),this.config.subscribeConfigChange(et.featuredMerchants,(function(e){t.parseFeaturedMerchants(e)})),this.fetch()},t.prototype.tryUpdateHash=function(t){this._hash!==t&&(this._hash=t,this.storage.merchantHash.set(t),this.fetch())},t.prototype.fetch=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),[4,this.getHash()];case 1:return(t=i.sent())&&""!==t?[4,this.storage.member.get()]:[3,4];case 2:return e=i.sent(),this.clearDiscoverOfferFilters(),n=this,[4,this.apiSvc.fetchMerchants(t,e?e.location:Z.LOCATION_USA)];case 3:return n.merchantMap=i.sent(),this.merchantMapKeys=Array.from(this.merchantMap.keys()),this.merchantMapValues=Array.from(this.merchantMap.values()),this._initialized=!0,this._onMerchantListChanged.next(),[3,5];case 4:this.consoleSvc.debug("No valid hash when fetch for merchant service"),i.label=5;case 5:return[3,7];case 6:return r=i.sent(),this.exceptionHandler.handleError(r),[3,7];case 7:return[2]}}))}))},t.prototype.checkFilters=function(t){for(var e=!0,n=0;n<this.filters.length&&(e=this.filters[n].check(t));n++);return e},t.prototype.validateMeta=function(t,e){var n=function(t,e){return e.filter((function(e){return void 0===t[e]}))},r=n(t,["id","type"]);return r.length?(this.consoleSvc.debug("Prop(s) missing from merchant meta for "+e.toString()+":",r),!1):((r=n(t,["loc","reward"])).length&&t.type!==O.discover&&this.consoleSvc.debug("Prop(s) missing from merchant meta for "+e.toString()+":",r),!0)},t.prototype.matchKey=function(t,e){var n,r,i=null,o=this.merchantMap.get(t);if(o){var s=Object.keys(o).filter((function(t){return t.startsWith("/")}));if(s.length)try{for(var c=Object(l.g)(s),a=c.next();!a.done;a=c.next()){var u=a.value;if(e.path().includes(u)&&this.validateMeta(o[u],e)){i=o[u];break}}}catch(h){n={error:h}}finally{try{a&&!a.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}!i&&this.validateMeta(o,e)&&(i=o)}return i},t.prototype.shouldShowSERP=function(t){return!(!(t&&t.reward&&t.reward.amount&&0!==t.reward.amount&&0!==t.type)||t.noSERP)},t.prototype.matchMerchantUrl=function(t){if(!t)return null;if(!this.merchantMap)return this.fetch(),null;var e=null,n=new f(t.toLowerCase());return this.merchantMapKeys.includes(n.hostname())&&(e=this.matchKey(n.hostname(),n)),!e&&this.merchantMapKeys.includes(n.domain())&&(e=this.matchKey(n.domain(),n)),e&&this.consoleSvc.debug("Matched MID:",e.id),e&&this.checkFilters(e)?e:null},t.prototype.fetchMerchantByMeta=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return t?[4,this.apiSvc.fetchMerchantJson(t.id)]:[3,2];case 1:return e=n.sent(),[2,new W(e,t)];case 2:return this.consoleSvc.debug("No valid merchant meta"),[2,null]}}))}))},t.prototype.getMerchantMeta=function(t){return this.merchantMapValues.find((function(e){return e.id===t}))},t.prototype.fetchMerchantById=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return(n=this.getMerchantMeta(t))?[4,this.fetchMerchantByMeta(n,e)]:[3,2];case 1:return r=i.sent(),[3,3];case 2:r=null,i.label=3;case 3:return[2,r]}}))}))},t.prototype.getMerchantImageUrl=function(t){return this.config.cdnHost+"/img/shop/ms/ms"+t+".jpg?v="+this.apiSvc.cacheBuster},t.prototype.getCurrencySymbol=function(e){return(new DOMParser).parseFromString("<!doctype html><body>"+t.CURRENCY_SYMBOL_FOR_COUNTRY[Math.log2(e)],"text/html").body.textContent},t.prototype.parseFeaturedMerchants=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return e=t.split(",").map((function(t){return parseInt(t)})),[4,this.storage.featuredMerchants.set(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.constructCashBackRewardString=function(t){return(t.showUpTo&&!t.isFlat?"up to ":"")+(t.isFlat?Y.getCashBack(t.amount):t.amount)+(t.isFlat?"":"%")+" Cash Back"},t.prototype.constructSbRewardString=function(t){var e=this.browser.api.i18n.getMessage,n=(t.showUpTo?e("upTo")+" ":"")+t.amount+(t.isFlat?" SB":"%");return t.isFlat?n:e("xxxCashBack",n)},t.prototype.constructMpRewardString=function(t,e){var n=this.browser.api.i18n.getMessage,r=t.showUpTo?n("upTo")+" ":"",i=t.amount>1?" "+n("points"):" "+n("point"),o=t.isFlat?"":" per dollar";return(t.showUpTo||e)&&(i=t.amount>1?" PTS":" PT",o=t.isFlat?"":" / $"),""+r+t.amount+i+o},t.prototype.constructSbRewardStringInCurrency=function(t){return(t.showUpTo?(0,this.browser.api.i18n.getMessage)("upTo")+" ":"")+t.amount+" SB "+(t.isFlat?"":" per dollar")},t.prototype.constructRewardString=function(t,e){var n=null;if(e&&e.amount)switch(t){case w.ibd:case w.tada:case w.upm:n=this.constructCashBackRewardString(e);break;case w.sb:n=this.constructSbRewardString(e);break;case w.mp:n=this.constructMpRewardString(e)}else n="";return n},t.prototype.constructRewardStringInCurrency=function(t,e){var n=null;if(1===e.loc&&e.reward&&e.reward.amount)switch(t){case w.sb:n=this.constructSbRewardStringInCurrency(e.reward)}else n="";return n},t.prototype.constructUpmTadaActivateString=function(t,e){return(0,this.browser.api.i18n.getMessage)(e?"somethingActivated":t.showUpTo?"getSomething":"getSomethingWithUpTo",this.constructCashBackRewardString(t))},t.prototype.constructSbActivateString=function(t,e){return(0,this.browser.api.i18n.getMessage)(e?"somethingActivated":t.showUpTo?"getSomething":"getSomethingWithUpTo",this.constructSbRewardString(t))},t.prototype.constructMpActivateString=function(t,e,n){return(0,this.browser.api.i18n.getMessage)(e?"somethingActivated":t.showUpTo?"getSomething":"getSomethingWithUpTo",this.constructMpRewardString(t,n))},t.prototype.constructActivateString=function(t,e,n,r){var i=null;if(e&&e.amount)switch(t){case w.ibd:i=this.constructCashBackRewardString(e);break;case w.tada:case w.upm:i=this.constructUpmTadaActivateString(e,n);break;case w.sb:i=this.constructSbActivateString(e,n);break;case w.mp:i=this.constructMpActivateString(e,n,r)}else i="";return i},t.prototype.constructStorePageUrl=function(t){var e=null;switch(this.config.client){case w.mp:case w.upm:e=this.config.hostDomain+"/shop-by-brand/"+t.urlSlug;break;case w.tada:e=this.config.hostDomain+"/"+t.urlSlug+"-coupons.html";break;case w.sb:e=this.config.hostDomain+"/shop/store/"+t.id}return e},t.prototype.addFilter=function(t){this.filters.push(t)},t.prototype.clearDiscoverOfferFilters=function(){this.filters=this.filters.filter((function(t){return!(t instanceof dt)}))},t.CURRENCY_SYMBOL_FOR_COUNTRY=["$","&#36;","&#163;","&#36;","&#8364;","&#8377;","&#8364;","&#8364;","&#8364;"],t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Wt),Object(r.gc)(Yt),Object(r.gc)(Qt),Object(r.gc)(Kt),Object(r.gc)(zt),Object(r.gc)(Gt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),oe=function(){function t(t){this.consoleSvc=t}return t.prototype.addToNewRequestStack=function(t,e){t.stack.push(e)},t.prototype.clientRequestCompleted=function(t,e){this.setClientRequestByUrl(t,e),this.tryMergeRequests(t,e.url)},t.prototype.serverRequestCompleted=function(t,e){this.setServerRequestByUrl(t,e),this.tryMergeRequests(t,e.url)},t.prototype.displayStackInTable=function(t){this.consoleSvc.table(t.stack)},t.prototype.isClientRedirectAndNotUserInitiated=function(t,e){return e.transitionQualifiers.indexOf("from_address_bar")>-1&&this.consoleSvc.debug("Previous client request from Address Bar redirect.  url:",e.url),e.transitionQualifiers.indexOf("client_redirect")>-1&&!0!==t.userClicked},t.prototype.spliceStackAtPreviousRequest=function(t){if(void 0!==t.previousClientRequest){var e=t.stack.findIndex((function(e){return e===t.previousClientRequest.url}));t.stack.splice(0,e+1)}},t.prototype.tryMergeRequests=function(t,e){var n=this.getClientRequestByUrl(t,e),r=this.getServerRequestByUrl(t,e);n&&r&&(-1!==n.transitionQualifiers.indexOf("forward_back")&&(t.userClicked=!0),this.isClientRedirectAndNotUserInitiated(t,n)||this.spliceStackAtPreviousRequest(t),this.addToNewRequestStack(t,r.url),t.previousClientRequest=n,t.RequestsFromServerAndClient.client=[],t.RequestsFromServerAndClient.server=[],t.userClicked=!1)},t.prototype.getClientRequestByUrl=function(t,e){return t.RequestsFromServerAndClient.client[e]||null},t.prototype.getServerRequestByUrl=function(t,e){return t.RequestsFromServerAndClient.server[e]||null},t.prototype.setClientRequestByUrl=function(t,e){t.RequestsFromServerAndClient.client[e.url]=e},t.prototype.setServerRequestByUrl=function(t,e){t.RequestsFromServerAndClient.server[e.url]=e},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Wt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),se=function(){function t(t,e,n,r,i,o,s){var c=this;this.gofer=t,this.config=e,this.apiSvc=n,this.storageSvc=r,this.exceptions=i,this.lifecycleEvents=o,this.merchants=s,this._member=new M,this._surveysAdded=new b.b,this.surveysAdded=this._surveysAdded.asObservable(),this._promoCodeAdded=new b.b,this.promoCodeAdded=this._promoCodeAdded.asObservable(),this.isTester=!1,this.lifecycleEvents.onAccountInfoChanged.subscribe((function(t){return Object(l.b)(c,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return this._member&&t.id===this._member.id||(this.merchants.clearDiscoverOfferFilters(),this._member&&(this._member.surveys=[])),[4,this.setAndStoreMember(t)];case 1:return e.sent(),[4,this.tryProcessSurveys(t.surveys)];case 2:return e.sent(),[4,this.tryProcessPromoCode(t.promoCode)];case 3:return e.sent(),[4,this.tryPostReferral()];case 4:return e.sent(),[2]}}))}))})),this.gofer.survey.subscribe((function(t){return Object(l.b)(c,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.tryProcessSurveys([t.msg])];case 1:return e.sent(),[2]}}))}))})),this.gofer.promoCode.subscribe((function(t){return Object(l.b)(c,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.tryProcessPromoCode(t.msg)];case 1:return e.sent(),[2]}}))}))}))}return Object.defineProperty(t.prototype,"member",{get:function(){return this._member},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoggedIn",{get:function(){return!(!this._member||!this._member.id)},enumerable:!0,configurable:!0}),t.prototype.tryPostReferral=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.config.isFlagEnabled(_.MKT_REFERRALS)?[4,this.storageSvc.referral.get()]:[2];case 1:return(t=n.sent())?[4,this.apiSvc.postReferralData(t)]:[3,4];case 2:return e=n.sent(),[4,this.storageSvc.referral.remove()];case 3:n.sent(),e!==j.OK&&this.exceptions.handleError(new Error("Unexpected API response for referral post: "+JSON.stringify(t))),n.label=4;case 4:return[2]}}))}))},t.prototype.tryProcessSurveys=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n=this;return Object(l.d)(this,(function(r){switch(r.label){case 0:return e=p()(),this._member.surveys||(this._member.surveys=[]),this.config.isFlagEnabled(_.ANSWER)&&t&&t.length&&(t.forEach((function(t){t.ts=e.unix(),n._member.surveys=n._member.surveys.filter((function(e){return t.prjId!=e.prjId})),n._member.surveys.push(t)})),this._surveysAdded.next(t)),this._member.surveys=this._member.surveys.filter((function(t){return e<p.a.unix(t.ts).add(t.expires,"seconds")})),[4,this.storeMember()];case 1:return r.sent(),[2]}}))}))},t.prototype.tryProcessPromoCode=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return this.config.isFlagEnabled(_.MKT_PROMO_CODES)?t&&(t.message||t.url)?(t.ts=p()().unix(),this._member.promoCode=t,[4,this.storeMember()]):[3,2]:[2];case 1:e.sent(),this._promoCodeAdded.next(t),e.label=2;case 2:return[2]}}))}))},t.prototype.init=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this,[4,this.storageSvc.member.get()];case 1:return t._member=e.sent(),[2]}}))}))},t.prototype.storeMember=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.storageSvc.member.set(this._member)];case 1:return t.sent(),[2]}}))}))},t.prototype.setAndStoreMember=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return this._member=t,[4,this.storeMember()];case 1:return e.sent(),[2]}}))}))},t.prototype.processAccountResponse=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return t.data&&t.data.member?[4,this.lifecycleEvents.getFreshConfigs()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.login=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return this.lifecycleEvents.isUserAuthenticating=!0,[4,this.apiSvc.executeLogin(t,e)];case 1:return n=r.sent(),[4,this.processAccountResponse(n)];case 2:return r.sent(),this.lifecycleEvents.isUserAuthenticating=!1,[2,n]}}))}))},t.prototype.register=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.lifecycleEvents.isUserAuthenticating=!0,[4,this.apiSvc.executeRegister(t)];case 1:return e=n.sent(),[4,this.processAccountResponse(e)];case 2:return n.sent(),this.lifecycleEvents.isUserAuthenticating=!1,[2,e]}}))}))},t.prototype.sendPasswordReminder=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.apiSvc.sendPasswordReminder(t)];case 1:return e.sent(),[2]}}))}))},t.prototype.refreshBalance=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.apiSvc.getAccountBalance()];case 1:return(t=e.sent()).data?(this._member.balance=t.data.balance,this._member.lifetimeEarnings=t.data.lifetimeEarnings,[4,this.storeMember()]):[3,3];case 2:return e.sent(),[3,4];case 3:this.exceptions.handleError(new Error("Failed to get account balance for member "+this._member.id)),e.label=4;case 4:return[2,this._member]}}))}))},t.prototype.clearMember=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.storageSvc.member.remove()];case 1:return t.sent(),this._member=null,[2]}}))}))},t.prototype.updateMemberPref=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return this.togglePreference(t),[4,this.apiSvc.updateMemberPrefs(this._member.preferences)];case 1:return[2,e.sent()]}}))}))},t.prototype.getPreference=function(t){return(this._member.preferences&t)===t},t.prototype.togglePreference=function(t){this._member.preferences^=t},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)($t),Object(r.gc)(zt),Object(r.gc)(Yt),Object(r.gc)(Qt),Object(r.gc)(Kt),Object(r.gc)(ne),Object(r.gc)(ie))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),ce=function(){function t(t,e,n,r,i,o,s,c,a,u,h,l,d,p){this.consoleSvc=t,this.apiSvc=e,this.configSvc=n,this.memberSvc=r,this.browser=i,this.storage=o,this.networkSvc=s,this.merchantSvc=c,this.exceptionHandler=a,this.affiliateNetworkSvc=u,this.lifecycleEvents=h,this.storageSvc=l,this.browserEvents=d,this.redirectStackSvc=p,this.tabs=new Map,this.interruptedRequests=[],this.silentTabMap=new Map,this._tabNavComplete=new b.b,this.tabNavComplete=this._tabNavComplete.asObservable(),this._tabInitialized=new b.b,this.tabInitialized=this._tabInitialized.asObservable()}return t.prototype.getTabs=function(){return Array.from(this.tabs.values())},t.prototype.init=function(){var t=this;this.merchantSvc.onMerchantListChanged.subscribe((function(){t.initializeTabs()})),this.affiliateNetworkSvc.onAffiliateNetworksChanged.subscribe((function(){t.initializeTabs()})),this.browserEvents.onTabCreated.subscribe((function(e){t.onTabCreated(e)})),this.browserEvents.onTabRemoved.subscribe((function(e){t.onTabRemoved(e)})),this.browserEvents.onBeforeWebRequest.subscribe((function(e){t.onBeforeWebRequest(e)})),this.browserEvents.onBeforeWebRedirect.subscribe((function(e){t.onBeforeWebRedirect(e)})),this.browserEvents.onWebRequestCompleted.subscribe((function(e){t.onWebRequestCompleted(e)})),this.browserEvents.onWebNavigationCommitted.subscribe((function(e){t.onWebNavigationCommitted(e)})),this.browserEvents.onWebNavigationDOMContentLoaded.subscribe((function(e){t.onWebNavigationDOMContentLoaded(e)})),this.lifecycleEvents.onAccountInfoChanged.subscribe((function(){return Object(l.b)(t,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){for(t=Array.from(this.tabs),e=0;e<t.length;e++);return[2]}))}))})),this.lifecycleEvents.onInstalled.subscribe((function(e){return Object(l.b)(t,void 0,void 0,(function(){var t,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return(n=(t=e.data.extension.configs)?t.postInstallUrl:null)&&this.openGoTab(n),(r=this.configSvc.client===w.sb)?[4,this.storage.tutorialViewed.get()]:[3,2];case 1:r=!i.sent(),i.label=2;case 2:return r&&this.lifecycleEvents.showTutorial(!0),[2]}}))}))})),this.initializeTabs()},t.prototype.initializeTabs=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.getAllTabs()];case 1:t=r.sent(),e=0,r.label=2;case 2:return e<t.length?[4,this.addTabState(t[e])]:[3,5];case 3:n=r.sent(),this._tabInitialized.next(n),r.label=4;case 4:return e++,[3,2];case 5:return this.consoleSvc.info("Tabs:",this.tabs),[2]}}))}))},t.prototype.addTabState=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return e=new G(t.windowId,t.id),this.tabs.set(t.id,e),e.url=t.url||t.pendingUrl,this.merchantSvc.initialized&&(n=this.merchantSvc.matchMerchantUrl(e.url))&&n.type>O.unsupported?[4,this.checkTabMerchantState(e,n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return t.openerTabId&&(r=this.tabs.get(t.openerTabId),this.shouldInheritFromOpenerTab(e,r)&&(e.merchantState.activationState=r.merchantState.activationState||J.NotActive,this.recordMerchantSessionActivationStateChange(e),e.merchantState.session.logData.parentSessionID=r.merchantState.session.logData.merchantSessionID)),[2,e]}}))}))},t.prototype.updateWindow=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.browser.callbackDecorator("windows.update",this.browser.api.windows.update,[t,e])];case 1:return n.sent(),[2]}}))}))},t.prototype.updateTab=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.browser.callbackDecorator("tabs.update",this.browser.api.tabs.update,[t,e])];case 1:return n.sent(),[2]}}))}))},t.prototype.removeTab=function(t){this.tabs.delete(t),this.consoleSvc.debug("Removed tab:",this.tabs)},t.prototype.queryTabs=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.browser.callbackDecorator(t,this.browser.api.tabs.query,e,(function(t){return t}))];case 1:return[2,n.sent()]}}))}))},t.prototype.getAllTabs=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.queryTabs("tabs.query all",[{}])];case 1:return[2,t.sent()]}}))}))},t.prototype.getAllTabStates=function(){return Array.from(this.tabs.values())},t.prototype.getAllHostTabs=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.queryTabs("tabs.query host",[{url:this.configSvc.hostDomain+"/*"}])];case 1:return[2,t.sent()]}}))}))},t.prototype.getTabById=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.getAllTabs()];case 1:if(e=r.sent(),!(n=e.find((function(e){return e.id===t}))))throw"No real tab with tabId "+t;return[2,n]}}))}))},t.prototype.getOrAddTabState=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:if(e=this.getTabState(t))return[3,5];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,this.getTabById(t)];case 2:return n=r.sent(),[4,this.addTabState(n)];case 3:return e=r.sent(),[3,5];case 4:return r.sent(),this.consoleSvc.debug("Invalid tab id to get:",t),[3,5];case 5:return[2,e]}}))}))},t.prototype.getTabState=function(t){var e=null;return this.tabs.has(t)&&(e=this.tabs.get(t)),e},t.prototype.getActiveTabState=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.queryTabs("tabs.query active",[{active:!0,lastFocusedWindow:!0,windowType:"normal"}])];case 1:return 1===(t=e.sent()).length?[2,this.getTabState(t[0].id)]:(this.consoleSvc.error("Unexpected active tab query results:",t),[2])}}))}))},t.prototype.getTabActivationState=function(t){if(!(t&&t.merchantState&&t.merchantState.merchant&&t.redirectDetails))return null;var e=t.redirectDetails.isAffiliateRedirect,n=t.redirectDetails.isOwnRedirect;return this.shouldStandDown(t.redirectDetails)||this.shouldStandDownCustomEbay(t)?J.StandingDown:n&&(e||t.merchantState.merchant.type===O.discover||this.isEbayRedirect(t))?J.Activated:t.merchantState.activationState||J.NotActive},t.prototype.setTabActivationDismissed=function(t){var e=this.getTabState(t);e&&e.merchantState&&e.merchantState.injectionState&&(e.merchantState.injectionState.activationDismissed=!0)},t.prototype.setTabActivationInjected=function(t){var e=this.getTabState(t);e&&e.merchantState&&e.merchantState.injectionState&&(e.merchantState.injectionState.activationInjected=!0)},t.prototype.setTabActivationConfirmed=function(t){var e=this.getTabState(t);e&&e.merchantState&&e.merchantState.injectionState&&(e.merchantState.injectionState.activationConfirmed=!0)},t.prototype.setTabShopperMarketingInjected=function(t){var e=this.getTabState(t);e&&e.merchantState&&e.merchantState.injectionState&&(e.merchantState.injectionState.shopperMarketingInjected=!0)},t.prototype.navigate=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.updateTab(e.tabId,{url:t})];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),this.consoleSvc.error("Failed to navigate:",n),[3,3];case 3:return[2]}}))}))},t.prototype.openNewTab=function(t,e){var n=this;return this.browser.callbackDecorator("tabs.create",this.browser.api.tabs.create,[{url:t,active:e}],(function(t){return n.tabs.get(t.id)}))},t.prototype.openSiteTab=function(t){this.openNewTab(window.__hostDomain+"/"+(t||""),!0)},t.prototype.openGoTab=function(t){this.openNewTab(""+this.configSvc.hostGoDomain+t,!0)},t.prototype.openProdegeTab=function(t){this.openNewTab("https://www.prodege.com/"+(t||""),!0)},t.prototype.closeTab=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e=this;return Object(l.d)(this,(function(n){return[2,new Promise((function(n){e.browser.api.tabs.remove(t,(function(){setTimeout((function(){n()}),200)}))}))]}))}))},t.prototype.onTabCreated=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.addTabState(t)];case 1:return e.sent(),this.consoleSvc.debug("Added tab:",this.tabs),[2]}}))}))},t.prototype.onTabRemoved=function(t){var e=this.getTabState(t);e&&(e.previousMerchantState&&(e.merchantState=e.previousMerchantState),e.merchantState&&e.merchantState.session&&e.merchantState.session.logData&&!this.silentTabMap.has(t)&&this.postMerchantSessionLog(e.merchantState.session),this.settingsTab&&this.settingsTab.tab.id===t&&(this.settingsTab=null)),this.removeTab(t)},t.prototype.onTabReplaced=function(t,e){var n=this.tabs.get(e);this.tabs.set(t,n),this.removeTab(e),this.consoleSvc.debug("Replaced tab:",this.tabs)},t.prototype.resetTabMerchantState=function(t,e){e&&t.merchantState&&(t.previousMerchantState=Nt()(t.merchantState),t.previousMerchantState.expiry=p()().add(15,"seconds").unix()),t.merchantState=null},t.prototype.setTabMerchant=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.merchantSvc.fetchMerchantByMeta(e,null)];case 1:return n=r.sent(),t.merchantState=new ct(n),[2,n]}}))}))},t.prototype.setTabMerchantState=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return t.isSettingMerchant?[3,12]:(t.isSettingMerchant=!0,this.shouldRestorePreviousTabState(t,e)?(this.consoleSvc.debug("Restoring tab merchant state for tab: ",JSON.parse(JSON.stringify(t))),t.merchantState=Nt()(t.previousMerchantState),t.merchantState.expiry=p()().add(15,"minutes").unix(),t.previousMerchantState=null,[3,11]):[3,1]);case 1:return this.consoleSvc.debug("Setting tab merchant state for tab: ",JSON.parse(JSON.stringify(t))),t.previousMerchantState&&t.previousMerchantState.session&&t.previousMerchantState.session.logData?[4,this.postMerchantSessionLog(t.previousMerchantState.session)]:[3,3];case 2:r.sent(),t.previousMerchantState=null,r.label=3;case 3:return t.shouldAnimateIcon=!0,t.merchantState&&t.merchantState.session&&t.merchantState.session.logData?[4,this.postMerchantSessionLog(t.merchantState.session)]:[3,5];case 4:r.sent(),r.label=5;case 5:return this.resetTabMerchantState(t),e.type!==O.discover?[3,7]:[4,this.setTabDiscoverOffer(t,e)];case 6:return r.sent(),[3,9];case 7:return[4,this.setTabMerchant(t,e)];case 8:r.sent(),r.label=9;case 9:return[4,this.storage.extId.get()];case 10:n=r.sent(),t.merchantState.session=new it(n,this.memberSvc.member.id,e),r.label=11;case 11:t.isSettingMerchant=!1,this.consoleSvc.debug("Finished setting tab merchant state for tab: ",JSON.parse(JSON.stringify(t))),r.label=12;case 12:return[2,t.merchantState.merchant]}}))}))},t.prototype.postMerchantSessionLog=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:t.logData.merchantActivationType===O.discover&&t.logData.merchantID>0&&(t.logData.merchantID=-t.logData.merchantID),e.label=1;case 1:return e.trys.push([1,3,4,5]),t&&t.finalize&&t.finalize(),[4,this.apiSvc.postMerchantSessionLog(t.logData)];case 2:return e.sent(),[3,5];case 3:return e.sent(),this.exceptionHandler.handleError(new Error("Merchant session failed to post: "+t)),[3,5];case 4:return t=null,[7];case 5:return[2]}}))}))},t.prototype.onBeforeWebRedirect=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.getOrAddTabState(t.tabId)];case 1:return(e=n.sent())?(e&&!e.redirectStack&&(e.redirectStack=new B(t.requestId,t.initiator)),this.redirectStackSvc.addToNewRequestStack(e.redirectStack,t.url),[2]):[2]}}))}))},t.prototype.onBeforeWebRequest=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return[4,this.getOrAddTabState(t.tabId)];case 1:return(e=i.sent())?(e.url=t.url,e.shouldAnimateIcon=!1,e&&!e.redirectStack&&(e.redirectStack=new B(t.requestId,t.initiator)),(n=this.merchantSvc.matchMerchantUrl(e.url))&&n.type==O.autoRedirect?(r=-1,e.merchantState&&e.merchantState.merchant.id&&(r=e.merchantState.merchant.id),[4,this.checkTabMerchantState(e,n)]):[3,3]):[2];case 2:if(i.sent(),!e.merchantState)return[2];e.merchantState&&e.merchantState.merchant.id&&r&&e.merchantState.merchant.id!==r&&this.redirectStackSvc.spliceStackAtPreviousRequest(e.redirectStack),e.redirectDetails=this.affiliateNetworkSvc.checkForAffiliateRedirect(e.redirectStack),this.shouldStandDown(e.redirectDetails)||this.shouldStandDownCustomEbay(e)?(e.merchantState.activationState=J.StandingDown,e.shouldAnimateIcon=!1):e.merchantState.activationState=e.redirectDetails&&e.redirectDetails.isOwnRedirect&&e.merchantState.activationState!==J.Activated?J.Activating:e.merchantState.activationState||J.NotActive,this.recordMerchantSessionActivationStateChange(e),this.shouldAutoRedirect(e)&&(this.consoleSvc.debug("Auto-redirecting, ignore completion of requestId: "+t.requestId),this.interruptedRequests.push(t.requestId),this.activate(e,e.merchantState.merchant.id,S.Merchant,I.AutoRedirect,k.currentTab)),i.label=3;case 3:return[2]}}))}))},t.prototype.onWebRequestCompleted=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){return this.interruptedRequests.includes(t.requestId)?(this.consoleSvc.debug("Ignoring interrupted request: "+t.requestId),this.interruptedRequests.splice(this.interruptedRequests.indexOf(t.requestId),1)):(this.consoleSvc.debug("Evaluating webRequestComplete: ",JSON.parse(JSON.stringify(t))),(e=this.tabs.get(t.tabId))&&e.redirectStack&&this.redirectStackSvc.serverRequestCompleted(e.redirectStack,t)),[2]}))}))},t.prototype.onWebNavigationCommitted=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){return this.shouldEvaluateWebNavigationCommitted(t)&&(this.lifecycleEvents.executeCallback(),(e=this.tabs.get(t.tabId))&&(e.hasTriedInjection=!1,e.redirectStack&&this.redirectStackSvc.clientRequestCompleted(e.redirectStack,t))),[2]}))}))},t.prototype.onWebNavigationDOMContentLoaded=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return 0!==t.frameId?[3,2]:(e=this.tabs.get(t.tabId))?(e.redirectStack&&this.redirectStackSvc.displayStackInTable(e.redirectStack),[4,this.completeTabNav(e,t.url,"onWebNavigationDOMContentLoaded")]):[3,2];case 1:n.sent(),this._tabNavComplete.next(e),this.consoleSvc.debug("_tabNavComplete.next broadcast: ",JSON.parse(JSON.stringify(e))),n.label=2;case 2:return[2]}}))}))},t.prototype.setTabDiscoverOffer=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(l.d)(this,(function(s){switch(s.label){case 0:return[4,this.apiSvc.checkOfferPlacement(e.id)];case 1:return(n=s.sent())&&n.available?[4,this.apiSvc.fetchDiscoverPlacementJson(n.placementID)]:[3,3];case 2:return r=s.sent(),i=new ht(r,e,n),t.merchantState=new ct(i),[3,4];case 3:o=new dt(e.id),this.merchantSvc.addFilter(o),t.merchantState.activationState=J.StandingDown,s.label=4;case 4:return[2]}}))}))},t.prototype.checkTabMerchantState=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.shouldSetTabMerchantState(t,e)?(this.consoleSvc.debug("setting tab merchantState for tab: "+JSON.stringify(t),t),[4,this.setTabMerchantState(t,e)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this.shouldRefreshTabMerchantData(t)?(this.consoleSvc.debug("refreshing merchant data for tab: "+JSON.stringify(t),t),e.type!==O.discover?[3,4]:[4,this.setTabDiscoverOffer(t,e)]):[3,6];case 3:return n.sent(),[3,6];case 4:return[4,this.setTabMerchant(t,e)];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},t.prototype.completeTabNav=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i;return Object(l.d)(this,(function(o){switch(o.label){case 0:return this.consoleSvc.debug("Completing tabNav to "+e+" from "+n+": ",JSON.parse(JSON.stringify(t))),t.url=e,(r=this.merchantSvc.matchMerchantUrl(t.url))&&r.type>O.unsupported?[4,this.checkTabMerchantState(t,r)]:[3,2];case 1:return o.sent(),t.redirectDetails=this.affiliateNetworkSvc.checkForAffiliateRedirect(t.redirectStack),t.merchantState.activationState=this.getTabActivationState(t),this.recordMerchantSessionActivationStateChange(t),t.merchantState.activationState!==J.StandingDown&&r.type!==O.unsupported||(t.shouldAnimateIcon=!1),[3,5];case 2:return t.previousMerchantState&&t.previousMerchantState.session&&t.previousMerchantState.session.logData?[4,this.postMerchantSessionLog(t.previousMerchantState.session)]:[3,4];case 3:o.sent(),t.previousMerchantState=null,o.label=4;case 4:t.shouldAnimateIcon=!1,this.resetTabMerchantState(t,!0),o.label=5;case 5:return this.silentTabMap.has(t.tabId)?(this.consoleSvc.debug("Found silent tab for tabId:"+t.tabId),i=this.getTabState(this.silentTabMap.get(t.tabId)),this.shouldUpdateOpenerTabState(i,t)&&(this.consoleSvc.debug("Updating opener tab state for silent tab for tabId:"+t.tabId),this.consoleSvc.debug("Opener tab state before:",JSON.parse(JSON.stringify(i))),i.merchantState.activationState=t.merchantState.activationState,this.recordMerchantSessionActivationStateChange(i),this.consoleSvc.debug("Opener tab state after:",JSON.parse(JSON.stringify(i)))),this._tabNavComplete.next(i),this.consoleSvc.debug("_tabNavComplete.next broadcast (from silent tab): ",JSON.parse(JSON.stringify(i))),[4,this.closeTab(t.tabId)]):[3,7];case 6:o.sent(),this.silentTabMap.delete(t.tabId),o.label=7;case 7:return[2]}}))}))},t.prototype.recordMerchantSessionActivationStateChange=function(t){t&&t.merchantState&&t.merchantState.session&&t.merchantState.session.logData?t.merchantState.session.tryAddActivationState(t.merchantState.activationState):this.consoleSvc.debug("No merchant session for tab: "+JSON.stringify(t),t)},t.prototype.shouldAutoRedirect=function(t){return t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.type===O.autoRedirect&&!this.silentTabMap.has(t.tabId)&&t.merchantState.activationState===J.NotActive&&(t.merchantState.merchant.deeplinkEnabled||this.urlIsHomePage(t.url))},t.prototype.shouldEvaluateWebNavigationCommitted=function(t){return"auto_subframe"!=t.transitionType},t.prototype.shouldInheritFromOpenerTab=function(t,e){return e.merchantState&&t.merchantState&&e.merchantState.merchant.id===t.merchantState.merchant.id},t.prototype.shouldRedirectInBackground=function(t,e,n){return n===k.background||t&&t.isZeroPayout&&!t.affiliate&&![k.currentTab,k.silentTab].includes(n)},t.prototype.shouldRedirectInSilentTab=function(t,e,n,r){if(r===k.silentTab)return!0;if(!this.memberSvc.isLoggedIn&&this.configSvc.client===w.tada&&e&&e.type===O.autoRedirect)return!1;var i=!(!e||!t||e.deeplinkEnabled||this.urlIsHomePage(t.url));return e.type!==O.discover&&(n===S.Checkout||!this.memberSvc.isLoggedIn||t&&e&&(i||!!e&&e.isZeroPayout&&!!e.affiliate)&&![k.currentTab,k.background].includes(r))},t.prototype.shouldRefreshTabMerchantData=function(t){return t.merchantState&&t.merchantState.merchant&&p()().unix()>t.merchantState.expiry&&t.merchantState.activationState!==J.Activating},t.prototype.shouldRestorePreviousTabState=function(t,e){return e&&t.previousMerchantState&&t.previousMerchantState.merchant&&t.previousMerchantState.merchant.id===e.id&&t.previousMerchantState.expiry&&p()().unix()<t.previousMerchantState.expiry},t.prototype.shouldSetTabMerchantState=function(t,e){return e&&!t.isSettingMerchant&&(!t.merchantState||!t.merchantState.merchant||t.merchantState.merchant.id!==e.id)},t.prototype.shouldStandDown=function(t){return t.isAffiliateRedirect&&!t.isOwnRedirect},t.prototype.shouldStandDownCustomEbay=function(t){return this.isEbayRedirect(t)&&!t.redirectDetails.isOwnRedirect},t.prototype.isEbayRedirect=function(t){var e=new f(t.url),n=e.domain().startsWith("ebay."),r=e.hasQuery("mkevt")||e.hasQuery("mkcid")||e.hasQuery("campid");return n&&r},t.prototype.shouldUpdateOpenerTabState=function(t,e){return t&&t.merchantState&&t.merchantState.merchant&&e&&e.merchantState&&e.merchantState.merchant&&t.merchantState.merchant.id===e.merchantState.merchant.id},t.prototype.urlIsHomePage=function(t){var e=new f(t);return t&&"/"===e.path()},t.prototype.constructDiscoverUrl=function(t){var e=t.placement;return this.configSvc.apiHost+"?cmd="+Z.DISCOVER_CLICK_COMMAND+"&mid="+this.memberSvc.member.id+"&trkId="+e.trackingID+"&placementID="+e.placementID+"&offerID="+e.offerID},t.prototype.constructRedirectUrl=function(t,e,n,r){return Object(l.b)(this,void 0,void 0,(function(){var i,o,s,c,a,u,h;return Object(l.d)(this,(function(l){switch(l.label){case 0:return t.type!==O.discover?[3,1]:[2,this.constructDiscoverUrl(t)];case 1:return n=n||I.Default,i=e&&e.merchantState&&e.merchantState.session&&e.merchantState.session.logData&&e.merchantState.session.logData.merchantSessionID||"",o=this.configSvc.client,[4,this.storage.extId.get()];case 2:return s=l.sent(),c=this.browser.api.runtime.getManifest().version,a=t.deeplinkEnabled&&e?e.url:null,u=[w.sb,w.mp].includes(o)&&this.memberSvc.isLoggedIn&&null!==a&&!r&&!(this.configSvc.browser===y.firefox),[2,((h=o!==w.sb)&&u?this.configSvc.hostDomain+"/jumppage":this.configSvc.apiHost+Z.DEFAULT_REDIRECT_ENDPOINT)+"?merchant="+t.id+"&page="+n+"&extid="+s+"&extv="+c+"&msid="+i+(u?"&jump=1":"&drctLink=2")+(h&&u?"&brand="+t.urlSlug:"")+(a?"&dlink="+encodeURIComponent(a):"")]}}))}))},t.prototype.activate=function(t,e,n,r,i){return void 0===i&&(i=k.default),Object(l.b)(this,void 0,void 0,(function(){var o,s,c,a,u,h,d,p;return Object(l.d)(this,(function(l){switch(l.label){case 0:return t.merchantState&&t.merchantState.activationState!==J.Activating?(t.merchantState.activationState=J.Activating,this.recordMerchantSessionActivationStateChange(t),(s=t.merchantState.merchant)?[3,2]:[4,this.merchantSvc.fetchMerchantById(e,null)]):[2];case 1:s=l.sent(),l.label=2;case 2:return c=this.shouldRedirectInBackground(o=s,t.url,i),a=this.shouldRedirectInSilentTab(t,o,n,i),[4,this.constructRedirectUrl(o,t,r,c||a)];case 3:return u=l.sent(),c?[4,this.networkSvc.getText(u)]:[3,5];case 4:return(h=l.sent())&&this.isHTML(h)&&t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.id===o.id&&(t.merchantState.activationState=J.Activated,this.recordMerchantSessionActivationStateChange(t),this._tabNavComplete.next(t)),[3,9];case 5:return d=t,a?[4,this.openNewTab(void 0,!1)]:[3,7];case 6:p=l.sent(),this.silentTabMap.set(p.tabId,t.tabId),d=p,l.label=7;case 7:return[4,this.navigate(u,d)];case 8:l.sent(),l.label=9;case 9:return[2]}}))}))},t.prototype.isHTML=function(t){var e=(new DOMParser).parseFromString(t,"text/html");return Array.from(e.body.childNodes).some((function(t){return 1===t.nodeType}))},t.prototype.resetCouponCoolDown=function(t){this.getTabState(t).merchantState.couponCoolDownExpiry=p()().add(15,"seconds").unix()},t.prototype.verifyCurrentUrl=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.getTabById(t.tabId)];case 1:return e=r.sent(),t.url===e.url?[3,3]:(this.consoleSvc.info("Current tab has an out of sync url. Update now."),t.url=e.url,this.merchantSvc.initialized&&(n=this.merchantSvc.matchMerchantUrl(e.url))&&n.type>O.unsupported?[4,this.checkTabMerchantState(t,n)]:[3,3]);case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.updateUserClicked=function(t,e){var n=this.getTabState(t);n.redirectStack&&(n.redirectStack.userClicked=!0)},t.prototype.checkTabExists=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.queryTabs("checkTabExists",[{url:["http://*/*","https://*/*"]}])];case 1:return[2,e.sent().some((function(e){return e.id===t}))]}}))}))},t.prototype.focusTab=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return e?[4,this.updateWindow(e,{focused:!0})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.updateTab(t,{active:!0})];case 3:return n.sent(),[2]}}))}))},t.prototype.openSettings=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:if(t=!0,!this.settingsTab)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.focusTab(this.settingsTab.tab.id,this.settingsTab.tab.windowId)];case 2:return i.sent(),t=!1,[3,4];case 3:return i.sent(),[3,4];case 4:return t?[4,this.getActiveTabState()]:[3,7];case 5:return e=i.sent(),n=this.browser.api.runtime.getURL("index.html?page=settings"),[4,this.openNewTab(n,!0)];case 6:r=i.sent(),this.settingsTab={tab:{id:r.tabId,windowId:r.windowId},opener:{id:e.tabId,windowId:e.windowId}},i.label=7;case 7:return[2]}}))}))},t.prototype.closeSettings=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.settingsTab?[4,this.closeTab(this.settingsTab.tab.id)]:[3,3];case 1:return t.sent(),[4,this.focusTab(this.settingsTab.opener.id,this.settingsTab.opener.windowId)];case 2:t.sent(),this.settingsTab=null,t.label=3;case 3:return[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Wt),Object(r.gc)(Yt),Object(r.gc)(zt),Object(r.gc)(se),Object(r.gc)(Gt),Object(r.gc)(Qt),Object(r.gc)(Xt),Object(r.gc)(ie),Object(r.gc)(Kt),Object(r.gc)(re),Object(r.gc)(ne),Object(r.gc)(Qt),Object(r.gc)(Vt),Object(r.gc)(oe))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),ae=function(){function t(t,e){this.http=t,this.exceptionHandler=e}return t.prototype.getFileText=function(t){var e=this;return new Promise((function(n,r){e.http.get(t,{responseType:"text"}).pipe(Object(kt.a)(Z.HTTP_RETRIES)).subscribe((function(t){return n(t)}),(function(t){e.exceptionHandler.handleError(t),r(t)}))}))},t.prototype.deserializeFileJson=function(t){var e=this;return new Promise((function(n){e.getFileText(t).then((function(t){n(JSON.parse(t))}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(s.a),Object(r.gc)(Kt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),ue=function(){function t(t,e,n,r,i,o,s,c,a,u,h,l){this.apiSvc=t,this.consoleSvc=e,this.tabSvc=n,this.configSvc=r,this.memberSvc=i,this.browser=o,this.merchantSvc=s,this.fileSystemSvc=c,this.storageSvc=a,this.lifecycleEvents=u,this.browserEvents=h,this.network=l,this.couponInjectionInitiated=!1,this.couponInjectionForceJSON=!1}return t.prototype.init=function(){var t=this;this.tabSvc.tabNavComplete.subscribe((function(e){return Object(l.b)(t,void 0,void 0,(function(){return Object(l.d)(this,(function(t){if(e)try{this.tryInjectUserClickedListener(e),this.shouldTryInjectSlider(e)?this.tryInjectSlider(e):this.configSvc.isFlagEnabled(_.SHOP_SERP_INJECT)&&this.tryInjectSearch(e),this.dispatchPresentEvent(e)}catch(n){this.consoleSvc.error("Injection error ",n)}return[2]}))}))})),this.tabSvc.tabInitialized.subscribe((function(e){t.dispatchPresentEvent(e)})),this.browserEvents.onRuntimeInstalled.subscribe((function(){t.injectInstallationEvent()})),this.browserEvents.onInstallTutorialLoaded.subscribe((function(e){0===e.frameId&&t.dispatchInstalledEvent(e.tabId)}))},t.prototype.dispatchInstalledEvent=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:if(e=this.configSvc.brand,!t||!this.tabSvc.checkTabExists(t))return[3,5];n="pdgHostMessenger = new Prodege.HostMessenger('"+this.browser.api.runtime.id+'\');\n\n      // Listen for message events like: window.postMessage(cmpData, \'*\')\n      window.addEventListener("message", function(event) {\n        if (event.source != window)\n            return;\n        if (event.data.messageType === "cmpData" || event.data.messageType === "refData") {\n            pdgHostMessenger.sendDataFromHostToExt(event.data);\n      }});\n\n      // Tell the host website extension installed\n      document.dispatchEvent(new Event(\''+e+"ExtensionInstalled'));",i.label=1;case 1:return i.trys.push([1,4,,5]),[4,this.injectScriptFile(t,"assets/injections/host-messenger/host-messenger.js")];case 2:return i.sent(),[4,this.injectScript(t,n)];case 3:return i.sent(),this.consoleSvc.debug("Dispatched install event"),[3,5];case 4:return r=i.sent(),this.consoleSvc.error("Broadcast extension installed with error: ",r),[3,5];case 5:return[2]}}))}))},t.prototype.dispatchPresentEvent=function(t){if(t&&t.url)try{0===t.url.indexOf(this.configSvc.hostDomain)&&this.injectScript(t.tabId,"document.dispatchEvent(new Event('"+this.configSvc.brand+"ExtensionPresent'));")}catch(e){this.consoleSvc.error("Broadcast extension present with error: ",e)}},t.prototype.injectScriptFile=function(t,e,n){return void 0===n&&(n=!1),Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.inject(t,{file:e,allFrames:n})];case 1:return r.sent(),[2]}}))}))},t.prototype.injectScript=function(t,e,n){return void 0===n&&(n=!1),Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.injectScriptFile(t,"browser-api-content.js")];case 1:return r.sent(),[4,this.inject(t,{code:e,allFrames:n})];case 2:return r.sent(),[2]}}))}))},t.prototype.injectInstallationEvent=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.tabSvc.getAllHostTabs()];case 1:if(t=n.sent())for(e=0;e<t.length;e++)this.dispatchInstalledEvent(t[e].id);else this.consoleSvc.debug("No host tab found",t);return[2]}}))}))},t.prototype.inject=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.tabSvc.checkTabExists(t)];case 1:if(!r.sent())return[3,5];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.browser.callbackDecorator("tabs.executeScript",this.browser.api.tabs.executeScript,[t,e])];case 3:return r.sent(),[3,5];case 4:return n=r.sent(),this.consoleSvc.info("ContentInjectionSvc failed to inject:",n),[3,5];case 5:return[2]}}))}))},t.prototype.getSliderDataJson=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i,o,s,c;return Object(l.d)(this,(function(a){switch(a.label){case 0:return r=this.memberSvc.member.id,e.coupons&&e.coupons.forEach((function(t){t.description=t.description.trim()})),e.couponApplyEnabled=e.couponApplyEnabled&&this.configSvc.isFlagEnabled(_.SHOP_APPLY_COUPONS),e.storePageUrl=this.merchantSvc.constructStorePageUrl(e),[4,this.storageSvc.extId.get()];case 1:return i=a.sent(),o="",t&&t.merchantState&&t.merchantState.session&&t.merchantState.session.logData&&(o=t.merchantState.session.logData.merchantSessionID),[4,this.storageSvc.extensionAlert.get()];case 2:return s=a.sent(),[4,this.getShopBonusUrlAndAmountIfShould()];case 3:return c=l.e.apply(void 0,[a.sent(),2]),[2,new A(t.tabId,r,e,o,t.merchantState.activationState===J.Activated,t.merchantState.injectionState.activationConfirmed,n,i,c[0],c[1],this.configSvc.client,this.memberSvc.isTester,this.consoleSvc.getLevel(),s)]}}))}))},t.prototype.getShopBonusUrlAndAmountIfShould=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,c;return Object(l.d)(this,(function(a){switch(a.label){case 0:return t=null,e=null,n=null,r=!1,i=Et()().tz("America/Los_Angeles"),[4,this.storageSvc.shopBonusLastShown.get()];case 1:return o=a.sent(),s=!1,Number(o)>=i.startOf("day").unix()&&(s=!0),!s&&this.memberSvc.member.shopPromo&&!this.memberSvc.member.shopPromo.activationRequired&&new Date(this.memberSvc.member.shopPromo.expirationDate).getTime()+864e5>Date.now()&&(n=this.merchantSvc.getCurrencySymbol(this.memberSvc.member.location||Z.LOCATION_USA),e=(c=this.memberSvc.member.shopPromo.bonus)%10==0&&c%100!=0?c/100+"0":""+c/100,this.configSvc.client===w.sb?t=this.configSvc.hostDomain+"/account/swagup":this.configSvc.client===w.mp?(1750==c?e=10:(e=c+" "+this.browser.getLocalizedMessage("points"),r=!0),t="https://help.mypoints.com/hc/en-us/articles/210708766-When-will-I-receive-my-10-Gift-Card-"):this.configSvc.client===w.tada&&(t="https://help.shopathome.com/hc/en-us/articles/360035150072")),r?[2,[t,e]]:n&&0===n.indexOf("\u20ac")?[2,[t,e+" "+n]]:[2,[t,n+e]]}}))}))},t.prototype.injectSlider=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(l.d)(this,(function(c){switch(c.label){case 0:return r=t.tabId,[4,this.fileSystemSvc.getFileText((i="assets/injections")+"/slider.css")];case 1:return o=c.sent(),[4,this.fileSystemSvc.getFileText(i+"/slider.html")];case 2:return s=c.sent(),[4,this.injectScriptFile(r,"vendor/sanitizer.js")];case 3:return c.sent(),[4,this.injectScriptFile(r,i+"/slider/slider.js")];case 4:return c.sent(),[4,this.injectScript(r,"__browserApi.runtime.onMessage.addListener(function(params) {  (function() {    if (params.clientId === "+this.configSvc.client+'         && params.extensionRuntimeId === "'+this.browser.api.runtime.id+'"         && params.msg === "pdgSlider"         && params.html && params.css && params.data) {      pdgSlider = new Prodege.Slider(params.extensionRuntimeId, params.type, params.html, params.css, params.data)    }  })();});')];case 5:return c.sent(),this.browser.api.tabs.sendMessage(t.tabId,{clientId:this.configSvc.client,extensionRuntimeId:this.browser.api.runtime.id,msg:"pdgSlider",html:s,css:o,data:n,type:e}),[2]}}))}))},t.prototype.injectActivationSlider=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i,o,s,c;return Object(l.d)(this,(function(a){switch(a.label){case 0:t.hasTriedInjection=!0,a.label=1;case 1:return a.trys.push([1,10,,11]),this.configSvc.client!==w.ibd?[3,3]:[4,this.injectSlider(t,bt.Activation,e)];case 2:return a.sent(),[3,9];case 3:return n=t.tabId,r="assets/injections/activation-slider",i=/(?<!(?<!var\()--(.*));/g,[4,this.fileSystemSvc.getFileText("assets/injections/sliders.css")];case 4:return o=a.sent().replace(i,"!important;"),[4,this.fileSystemSvc.getFileText(r+"/slider.html")];case 5:return s=a.sent(),[4,this.injectScriptFile(n,"vendor/sanitizer.js")];case 6:return a.sent(),[4,this.injectScriptFile(n,r+"/slider.js")];case 7:return a.sent(),[4,this.injectScript(n,"__browserApi.runtime.onMessage.addListener(function(params) {  (function() {    if (params.clientId === "+this.configSvc.client+'         && params.extensionRuntimeId === "'+this.browser.api.runtime.id+'"         && params.msg === "pdgSlider"         && params.html && params.css && params.json) {      pdgSlider = new Prodege.ActivationSlider(params.extensionRuntimeId, params.html, params.css, params.json)    }  })();});')];case 8:a.sent(),this.browser.api.tabs.sendMessage(t.tabId,{clientId:this.configSvc.client,extensionRuntimeId:this.browser.api.runtime.id,msg:"pdgSlider",html:s,css:o,json:e}),a.label=9;case 9:return this.consoleSvc.debug("Injected Activation Slider - Current State:",t),[3,11];case 10:return c=a.sent(),this.consoleSvc.error("Failed to inject activation slider:",c),[3,11];case 11:return[2]}}))}))},t.prototype.injectCouponSlider=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i,o,s,c,a,u;return Object(l.d)(this,(function(h){switch(h.label){case 0:t.hasTriedInjection=!0,h.label=1;case 1:return h.trys.push([1,11,,12]),this.configSvc.client!==w.ibd?[3,3]:[4,this.injectSlider(t,bt.Coupons,e)];case 2:return h.sent(),[3,10];case 3:return n=t.tabId,i=(r="assets/injections")+"/coupon-slider",[4,this.browser.api.runtime.getURL("assets/images/chrome-icon_sprite_new-brand.png")];case 4:return o=h.sent(),s=/(?<!(?<!var\()--(.*));/g,[4,this.fileSystemSvc.getFileText(r+"/sliders.css")];case 5:return c=h.sent().replace(s,"!important;").replace(/assets\/images\/chrome-icon_sprite_new-brand\.png/g,o),[4,this.fileSystemSvc.getFileText(i+"/slider.html")];case 6:return a=h.sent(),[4,this.injectScriptFile(n,"vendor/sanitizer.js")];case 7:return h.sent(),[4,this.injectScriptFile(n,i+"/slider.js")];case 8:return h.sent(),[4,this.injectScript(n,"__browserApi.runtime.onMessage.addListener(function(params) {  (function() {    if (params.clientId === "+this.configSvc.client+'         && params.extensionRuntimeId  === "'+this.browser.api.runtime.id+'"         && params.msg === "pdgCoupon"         && params.html && params.css && params.json) {      pdgCouponSlider = new Prodege.CouponSlider(params.extensionRuntimeId , params.html, params.css, params.json)    }  })();});')];case 9:h.sent(),this.browser.api.tabs.sendMessage(n,{clientId:this.configSvc.client,extensionRuntimeId:this.browser.api.runtime.id,msg:"pdgCoupon",html:a,css:c,json:e}),h.label=10;case 10:return this.consoleSvc.debug("Injected Coupon Slider - Current State:",t),[3,12];case 11:return u=h.sent(),this.consoleSvc.error("Failed to inject coupon slider:",u),[3,12];case 12:return[2]}}))}))},t.prototype.injectShopperMarketingSlider=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i;return Object(l.d)(this,(function(o){switch(o.label){case 0:return n="assets/injections/shm-slider",[4,this.fileSystemSvc.getFileText("assets/injections/sliders.css")];case 1:return r=o.sent(),[4,this.fileSystemSvc.getFileText(n+"/slider.html")];case 2:return i=o.sent(),[4,this.injectScriptFile(t.tabId,"vendor/sanitizer.js")];case 3:return o.sent(),[4,this.injectScriptFile(t.tabId,n+"/slider.js")];case 4:return o.sent(),[4,this.injectScript(t.tabId,"__browserApi.runtime.onMessage.addListener(function(params) {  (function() {    if (params.clientId === "+this.configSvc.client+'         && params.extensionRuntimeId === "'+this.browser.api.runtime.id+'"         && params.msg === "pdgSlider"         && params.html && params.css && params.data) {      pdgSlider = new Prodege.SHMSlider(params.extensionRuntimeId, params.sliderId, params.type, params.html, params.css, params.data)    }  })();});')];case 5:return o.sent(),this.browser.api.tabs.sendMessage(t.tabId,{clientId:this.configSvc.client,extensionRuntimeId:this.browser.api.runtime.id,msg:"pdgSlider",html:i,css:r,data:e,type:bt.SHM,sliderId:"sb-slider-container"}),[2]}}))}))},t.prototype.injectNotification=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i;return Object(l.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),[4,this.fileSystemSvc.getFileText((n="assets/injections/notification")+"/notification.html")];case 1:return r=o.sent(),[4,this.fileSystemSvc.getFileText(n+"/notification.css")];case 2:return i=o.sent(),[4,this.injectScriptFile(t,n+"/notification.js")];case 3:return o.sent(),[4,this.injectScript(t,"if (!window['notificationListener']) {notificationListener = function(params) {if (params.clientId === "+this.configSvc.client+"&& params.extensionRuntimeId === '"+this.browser.api.runtime.id+"'&& params.msg === 'pdgNotification'&& params.html && params.css && params.json) {window['pdgNotification'] = new Prodege.NotificationInjection(params.extensionRuntimeId, params.html, params.css, params.json)}};}if (window['pdgNotification']) {document.body.removeChild(document.getElementsByClassName(window['pdgNotification'].CONTAINER)[0]);}__browserApi.runtime.onMessage.removeListener(notificationListener);__browserApi.runtime.onMessage.addListener(notificationListener);")];case 4:return o.sent(),this.browser.api.tabs.sendMessage(t,{clientId:this.configSvc.client,extensionRuntimeId:this.browser.api.runtime.id,msg:"pdgNotification",html:r,css:i,json:e}),[3,6];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.tryInjectUserClickedListener=function(t){this.injectScript(t.tabId,"\n      var jsTabId = "+t.tabId+"\n      var logMessage = { type: 0, value: {message:' logging mesages from tab ' + jsTabId, level:3} };\n      var userClickedMessage =      {type : "+v.userClickedInPage+", value: {tabId:jsTabId, clientId:"+this.configSvc.client+"}};\n      var fn = window['__browserApi'].runtime.sendMessage;\n      var cb = function (response) {\n          res(response);\n      };        \n      document.documentElement.addEventListener('click', \n        function () {  \n         fn(userClickedMessage);    \n      });        \n     ")},t.prototype.tryInjectSlider=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(l.d)(this,(function(s){switch(s.label){case 0:return e=this.getUrlType(t.url,t.merchantState.merchant),[4,this.getSliderDataJson(t,t.merchantState.merchant,e)];case 1:return n=s.sent(),this.shouldInjectCouponsAtCheckout(t)?[4,this.initializeCouponInjectionCode(t.tabId,t.merchantState.merchant)]:[3,3];case 2:return r=s.sent(),t.merchantState.merchant.hasMerchantScript=!!r,"object"==typeof r&&(n.jsonMerchantDefinition=r),this.injectCouponSlider(t,n),[3,6];case 3:return this.shouldInjectShopperMarketingSlider(t)?[4,this.apiSvc.checkShopperMarketingPlacement(t.merchantState.merchant.shopperMarketingID)]:[3,5];case 4:return(i=s.sent())&&i.status===j.OK&&i.data?((o=i.data)&&o.rewardTotal>0&&o.url&&(n.shmReward=o.rewardTotal,n.shmOfferPage=o.url,this.injectShopperMarketingSlider(t,n)),[3,6]):[2];case 5:if(!this.shouldInjectPostPurchaseContent(t)){if(this.hasConfirmedActivation(t)||this.hasSeenActivationSlider(t)&&!t.merchantState.activationState&&!this.shouldShowActivationAtCheckoutNoCoupons(t))return[2];if(this.shouldTryActivationConfirmation(t)&&this.injectScript(t.tabId,"document.dispatchEvent(new CustomEvent('rewards-activated', { detail: { client: "+this.configSvc.client+" } }))"),this.shouldInjectNonCheckoutCoupons(t))this.injectCouponSlider(t,n);else{if(this.shouldNotInjectActivation(t,n))return[2];this.memberSvc.isLoggedIn?this.injectActivationSlider(t,n):this.injectCouponSlider(t,n)}return[2]}s.label=6;case 6:return[2]}}))}))},t.prototype.getUrlType=function(t,e,n){return t&&e?e.checkoutUrl&&t.match(new RegExp(e.checkoutUrl))?S.Checkout:e.postPurchaseUrl&&t.match(new RegExp(e.postPurchaseUrl))?S.PostPurchase:S.Merchant:t&&t.includes(n.domain)&&n.rx.test(t)?S.Serp:null},t.prototype.initializeCouponInjectionCode=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(l.d)(this,(function(c){switch(c.label){case 0:return this.couponInjectionInitiated?[3,8]:[4,this.injectVendorScripts(t)];case 1:return c.sent(),[4,this.injectScriptFile(t,"coupon-scripts/coupon-injection.js")];case 2:return c.sent(),[4,this.injectGlobals(t)];case 3:return c.sent(),[4,this.fetchScripts("coupon-injection-json.min.json","jsonCouponMerchantScripts")];case 4:return n=c.sent(),(o=(i=(r=n.shared?n.shared[e.groupID]:null)?n[r]:n[e.groupID])?JSON.parse(i):null)&&(o.enabled||void 0===o.enabled||this.couponInjectionForceJSON)?("string"==typeof(s=o.applyCoupon)&&(o.applyCoupon=JSON.parse(n.templates[s])),[2,o]):[3,5];case 5:return[4,this.fetchScripts("coupon-injection.min.json","couponMerchantScripts")];case 6:return n=c.sent(),[4,this.injectMerchantScript(n,t,e.groupID)];case 7:return[2,c.sent()];case 8:return[2,!1]}}))}))},t.prototype.injectVendorScripts=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.injectScriptFile(t,"vendor/jquery.js")];case 1:return e.sent(),[4,this.injectScriptFile(t,"vendor/sanitizer.js")];case 2:return e.sent(),[2]}}))}))},t.prototype.fetchScripts=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return n=null,[4,this.storageSvc[e].get()];case 1:if((r=i.sent())&&!r.expired)return[3,10];i.label=2;case 2:return i.trys.push([2,5,,9]),[4,this.network.getText(this.configSvc.cdnHost+"/json/extension/"+t+"?v="+this.apiSvc.cacheBuster)];case 3:return n=i.sent(),[4,this.storageSvc[e].setValue(n)];case 4:return i.sent(),[3,9];case 5:return i.sent(),r&&r.value?(n=r.value,[3,8]):[3,6];case 6:return[4,this.fileSystemSvc.getFileText("coupon-scripts/"+t)];case 7:n=i.sent(),i.label=8;case 8:return[3,9];case 9:return[3,11];case 10:n=r.value,i.label=11;case 11:return[2,n?JSON.parse(n):null]}}))}))},t.prototype.injectGlobals=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.injectScript(t,'window["CouponWorkerBase"] = ProdegeCouponInjection.CouponInjection.init;window["CouponInjection"] = {WORKER_TYPE_API: ProdegeCouponInjection.CouponInjection.CouponWorkerTypes.api,WORKER_TYPE_ASYNC: ProdegeCouponInjection.CouponInjection.CouponWorkerTypes.async,WORKER_TYPE_POSTBACK: ProdegeCouponInjection.CouponInjection.CouponWorkerTypes.postback,WORKER_TYPE_JSON: ProdegeCouponInjection.CouponInjection.CouponWorkerTypes.json};')];case 1:return e.sent(),[2]}}))}))},t.prototype.injectMerchantScript=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i;return Object(l.d)(this,(function(o){switch(o.label){case 0:return(r=t[n])||(i=t.shared[n])&&(r=t[i]),r?[4,this.injectScript(e,r)]:[3,2];case 1:return o.sent(),[2,!0];case 2:return[2,!1]}}))}))},t.prototype.tryInjectSearch=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,i,o,s,c;return Object(l.d)(this,(function(a){switch(a.label){case 0:a.trys.push([0,6,7,8]),e=Object(l.g)($.SEARCH_PAGE_INJECTION_SETTINGS),n=e.next(),a.label=1;case 1:return n.done?[3,5]:this.getUrlType(t.url,null,r=n.value)?[4,this.injectScriptFile(t.tabId,"assets/injections/serp-injector/serp-injector.js",i="swagbucks.com"===r.domain||"mypoints.com"===r.domain)]:[3,4];case 2:return a.sent(),[4,this.injectScript(t.tabId,"pdgSerpInjection"+this.configSvc.client+" = new Prodege.SerpInjector(\n          "+this.configSvc.client+", '"+this.browser.api.runtime.id+"', "+r.id+"\n        )",i)];case 3:a.sent(),a.label=4;case 4:return n=e.next(),[3,1];case 5:return[3,8];case 6:return o=a.sent(),s={error:o},[3,8];case 7:try{n&&!n.done&&(c=e.return)&&c.call(e)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},t.prototype.hasConfirmedActivation=function(t){return t&&t.merchantState&&t.merchantState.activationState===J.Activated&&t.merchantState.injectionState&&t.merchantState.injectionState.activationConfirmed},t.prototype.hasMerchantCoupons=function(t){return t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.coupons&&t.merchantState.merchant.coupons.length>0},t.prototype.hasSeenActivationSlider=function(t){return t&&t.merchantState&&t.merchantState.injectionState&&(t.merchantState.injectionState.activationDismissed||t.merchantState.injectionState.activationInjected)},t.prototype.hasSeenShopperMarketingSlider=function(t){return t&&t.merchantState&&t.merchantState.injectionState&&t.merchantState.injectionState.shopperMarketingInjected},t.prototype.isShopperMarketingUrl=function(t,e){return e&&e.shopperMarketingUrl&&t&&t.match(new RegExp(e.shopperMarketingUrl))},t.prototype.shouldShowActivationAtCheckoutNoCoupons=function(t){return t.merchantState&&t.merchantState.merchant.checkoutUrl&&t.url&&this.getUrlType(t.url,t.merchantState.merchant)===S.Checkout},t.prototype.shouldInjectCouponsAtCheckout=function(t){return this.logShouldInjectCouponsAtCheckout(t),t&&this.hasMerchantCoupons(t)&&t.merchantState&&t.merchantState.merchant.checkoutUrl&&t.url&&this.getUrlType(t.url,t.merchantState.merchant)===S.Checkout&&!t.hasTriedInjection&&(!t.merchantState.couponCoolDownExpiry||t.merchantState.couponCoolDownExpiry&&Et()().unix()>t.merchantState.couponCoolDownExpiry)},t.prototype.logShouldInjectCouponsAtCheckout=function(t){this.consoleSvc.debug("shouldInjectCouponsAtCheckout() : 0 All 6 must be true."),this.consoleSvc.debug("shouldInjectCouponsAtCheckout() : 1 this.hasMerchantCoupons(tab): "+this.hasMerchantCoupons(t)),this.consoleSvc.debug("shouldInjectCouponsAtCheckout() : 2 tab.merchantState.merchant.checkoutUrl: "+!!this.hasMerchantCoupons(t)+" :",t.merchantState.merchant.checkoutUrl),this.consoleSvc.debug("shouldInjectCouponsAtCheckout() : 3 tab.url: "+!!t.url+" :",t.url),this.consoleSvc.debug("shouldInjectCouponsAtCheckout() : 4 this.getUrlType(tab.url, tab.merchantState.merchant) === UrlTypes.Checkout: "+(this.getUrlType(t.url,t.merchantState.merchant)===S.Checkout)),this.consoleSvc.debug("shouldInjectCouponsAtCheckout() : 5 !tab.hasTriedInjection: "+!t.hasTriedInjection),this.consoleSvc.debug("shouldInjectCouponsAtCheckout() : 6 coolDownReady: "+(!t.merchantState.couponCoolDownExpiry||t.merchantState.couponCoolDownExpiry&&Et()().unix()>t.merchantState.couponCoolDownExpiry))},t.prototype.shouldInjectShopperMarketingSlider=function(t){return t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.shopperMarketingID&&this.isShopperMarketingUrl(t.url,t.merchantState.merchant)&&!this.hasSeenShopperMarketingSlider(t)&&(this.hasSeenActivationSlider(t)||t.merchantState.merchant.isZeroPayout)},t.prototype.shouldInjectNonCheckoutCoupons=function(t){var e=t.merchantState.activationState,n=t.merchantState.couponCoolDownExpiry,r=t.merchantState.merchant.isZeroPayout;return t&&this.hasMerchantCoupons(t)&&(e===J.NotActive||r&&e===J.Activated)&&(r||!this.memberSvc.isLoggedIn)&&!t.hasTriedInjection&&(!n||n&&Et()().unix()>n)},t.prototype.shouldInjectPostPurchaseContent=function(t){return t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.activationState===J.Activated&&t.merchantState.merchant.postPurchaseUrl&&t.url&&this.getUrlType(t.url,t.merchantState.merchant)===S.PostPurchase&&!t.hasTriedInjection},t.prototype.shouldNotInjectActivation=function(t,e){return!t||!t.merchantState||!t.merchantState.merchant||t.merchantState.merchant.isZeroPayout&&!this.hasMerchantCoupons(t)||this.configSvc.client===w.ibd&&!this.memberSvc.isLoggedIn&&!e.merchant.coupons.length||this.configSvc.client===w.tada&&!this.memberSvc.isLoggedIn&&!e.merchant.coupons.length||this.configSvc.client===w.upm&&!this.memberSvc.isLoggedIn&&!e.merchant.coupons.length},t.prototype.shouldTryActivationConfirmation=function(t){return t&&t.merchantState&&t.merchantState.activationState===J.Activated&&t.merchantState.injectionState&&!t.merchantState.injectionState.activationConfirmed&&t.hasTriedInjection},t.prototype.shouldTryInjectSlider=function(t){return t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.type&&t.merchantState.merchant.type>O.popupOnly&&t.merchantState.activationState!==J.StandingDown},t.prototype.injectLoginOccurred=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){return this.injectScript(t,'document.dispatchEvent(new CustomEvent("login-occurred"));'),[2]}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Yt),Object(r.gc)(Wt),Object(r.gc)(ce),Object(r.gc)(zt),Object(r.gc)(se),Object(r.gc)(Gt),Object(r.gc)(ie),Object(r.gc)(ae),Object(r.gc)(Qt),Object(r.gc)(ne),Object(r.gc)(Vt),Object(r.gc)(Xt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),he=function(){function t(t,e,n,r,i,o,s,c,a){this.tabs=t,this.config=e,this.member=n,this.browser=r,this.console=i,this.exceptions=o,this.browserEvents=s,this.contentInjection=c,this.storage=a,this.VISIBLE_NOTIFICATION_INTERVAL=3e5,this.queue=[],this._notifications=[]}return t.prototype.init=function(){var t=this;this.member.surveysAdded.subscribe((function(e){for(var n=0;n<e.length;n++)t.addForSurvey(e[n],0===n)})),this.member.promoCodeAdded.subscribe((function(e){t.notifyPromoCode(e)})),this.browserEvents.onNotificationClicked.subscribe((function(e){t.notificationClicked(e)})),this.queueProcessor=Object(It.a)(this.VISIBLE_NOTIFICATION_INTERVAL),this.queueProcessor.subscribe((function(){if(t.queue.length){var e=t.queue.shift();e.type===ut.Survey&&t.member.getPreference(X.surveyAlertOptOut)?t.console.debug("Suppressing notification: ",e):t.createVisibleNotification(e)}}))},t.prototype.notifyPromoCode=function(t){var e=new at(t.id.toString(),ut.PromoCode,t.ts,t.expires,t,this.browser.getLocalizedMessage("newSwagCodeAvailable"),this.browser.getLocalizedMessage("clickSBIconToView"),t.url,t.message||this.browser.getLocalizedMessage("getStarted"),!1,"assets/images/sc.svg");this.createVisibleNotification(e),this.add(e)},t.prototype.remove=function(t){this.console.debug("Attempting to remove notificationId: "+t);var e=this._notifications.findIndex((function(e){return e.id===t})),n=null;e>-1&&(this.console.debug("Removing notificationId: "+t+" from _notifications"),n=this._notifications[e],this._notifications.splice(e,1));var r=this.queue.findIndex((function(e){return e.id===t}));return r>-1&&(this.console.debug("Removing notificationId: "+t+" from queue"),this.queue.splice(r,1)),n},t.prototype.surveyNotificationClicked=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return e=this.config.sourceId,[4,this.storage.extId.get()];case 1:return n=i.sent(),r=t.url||this.config.apiHost+"/g/survey-click/?projectid="+t.prjId+"&sourceid="+e+"&memberid="+this.member.member.id,r+=(r.includes("?")?"&":"?")+"extid="+n+"&extv="+this.browser.api.runtime.getManifest().version,this.tabs.openNewTab(r,!0),[2]}}))}))},t.prototype.promoCodeNotificationClicked=function(t){t.url?this.tabs.openNewTab(t.url,!0):this.exceptions.handleError(new Error("PromoCode clicked without URL: "+JSON.stringify(t)))},t.prototype.notificationClicked=function(t){var e=this.remove(t);switch(e.type){case ut.Survey:this.surveyNotificationClicked(e.data);break;case ut.PromoCode:this.promoCodeNotificationClicked(e.data)}},t.prototype.createVisibleNotification=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e=this;return Object(l.d)(this,(function(n){switch(n.label){case 0:return t&&t.data?[4,this.browser.callbackDecorator("permissions.contains",this.browser.api.permissions.contains,[{permissions:["notifications"]}],(function(n){return Object(l.b)(e,void 0,void 0,(function(){var e,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return n?(this.browser.api.notifications.create(t.id,{type:"basic",iconUrl:t.icon,title:t.title,message:t.text,contextMessage:this.config.extensionName,buttons:[{title:"Get Started"}],requireInteraction:!0}),[3,4]):[3,1];case 1:return[4,this.tabs.getActiveTabState()];case 2:return e=i.sent(),r=JSON.stringify(t),e&&e.tabId?[4,this.contentInjection.injectNotification(e.tabId,r)]:[3,4];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))}))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.add=function(t){this.console.debug("Adding notification:",t),this._notifications.push(t),t.shouldNotifyVisibly&&this.queue.push(t)},t.prototype.fetchValid=function(){var t=this,e=p()(),n=this._notifications.filter((function(t){return e>p.a.unix(t.ts).add(t.expires,"seconds")}));return n.length&&(this.console.debug("Removing expired notifications:",n),n.forEach((function(e){t.remove(e.id)}))),this._notifications},t.prototype.formatSurveyReward=function(t){var e=null;switch(this.config.client){case w.mp:e=t+" PT"+(1===t?"":"S");break;case w.tada:e="$"+t;break;case w.sb:e=t+" SB";break;case w.ibd:e="$"+(t/100).toFixed(2)}return e},t.prototype.addForSurvey=function(t,e){if(this.remove(t.prjId.toString()),t.expires>0){var n=new at(t.prjId.toString(),ut.Survey,t.ts,t.expires,t,this.browser.getLocalizedMessage("newSurveyAvail"),this.browser.getLocalizedMessage("getAmountForThisSurvey",this.formatSurveyReward(t.sb)),t.url,this.browser.getLocalizedMessage("getStarted"),e,this.config.client==w.ibd?"assets/images/alert.png":"assets/images/answer.svg");this.add(n)}},t.prototype.addToQueue=function(t){this.add(t)},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(ce),Object(r.gc)(zt),Object(r.gc)(se),Object(r.gc)(Gt),Object(r.gc)(Wt),Object(r.gc)(Kt),Object(r.gc)(Vt),Object(r.gc)(ue),Object(r.gc)(Qt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),le=function(){function t(t,e,n,r,i,o,s){this.apiSvc=t,this.browser=e,this.browserEvents=n,this.config=r,this.consoleSvc=i,this.exceptionHandler=o,this.storage=s,this.siteMap=new yt,this._onSiteDetected=new b.b,this.onSiteDetected=this._onSiteDetected.asObservable(),this._hash=null}return t.prototype.getHash=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return this._hash?[3,2]:(t=this,[4,this.storage.siteMapHash.get()]);case 1:t._hash=e.sent(),e.label=2;case 2:return[2,this._hash]}}))}))},t.prototype.init=function(){var t=this;this.config.subscribeConfigChange(et.siteMapHash,(function(e){t.tryUpdateHash(e)})),this.browserEvents.onWebNavigationDOMContentLoaded.subscribe((function(e){t.onWebNavigationDOMContentLoaded(e)})),this.fetch()},t.prototype.onWebNavigationDOMContentLoaded=function(t){if(t&&0===t.frameId&&t.url){var e=this.siteMap.get(t.url);e&&(this.consoleSvc.debug("Found Site Data for url "+t.url,e),e.tab=t,this._onSiteDetected.next(e))}},t.prototype.fetch=function(t){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),[4,this.getHash()];case 1:return(t=r.sent())?[4,this.apiSvc.fetchSiteMapJson(t)]:[3,3];case 2:return e=r.sent(),this.siteMap.load(e,t),[3,4];case 3:this.consoleSvc.debug("No valid sitemap hash"),r.label=4;case 4:return[3,6];case 5:return n=r.sent(),this.exceptionHandler.handleError(n),[3,6];case 6:return[2]}}))}))},t.prototype.tryUpdateHash=function(t){this._hash!==t&&(this._hash=t,this.fetch())},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Yt),Object(r.gc)(Gt),Object(r.gc)(Vt),Object(r.gc)(zt),Object(r.gc)(Wt),Object(r.gc)(Kt),Object(r.gc)(Qt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),de=function(){function t(t,e){this.api=t,this.console=e,this.TYPE_MAP=(new Map).set(xt.Urls,"ext.urls").set(xt.PrePurchaseProducts,"ext.products.prepurchase").set(xt.PostPurchaseProducts,"ext.products.postpurchase").set(xt.OrderHistoryProducts,"ext.products.orderhistory"),this.VERSION_MAP=(new Map).set(xt.Urls,1).set(xt.PrePurchaseProducts,2).set(xt.PostPurchaseProducts,2).set(xt.OrderHistoryProducts,2),this._deliveryStream=null,this._firehose=null}return Object.defineProperty(t.prototype,"deliveryStream",{get:function(){return this._deliveryStream},set:function(t){t&&void 0!==t&&(this._deliveryStream=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firehose",{get:function(){return this._firehose},enumerable:!0,configurable:!0}),t.prototype.init=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return t=p()(),!this._firehose||this.tokenExpiration<=t.unix()?[4,this.api.getToken()]:[3,2];case 1:if(!((e=r.sent())&&0===e.status&&e.data&&e.data.firehose))return this._firehose=null,[2];this._firehose=new Ht.a.Firehose({region:(n=e.data.firehose).region,credentials:new Ht.a.Credentials({sessionToken:n.token,accessKeyId:n.key_id,secretAccessKey:n.key})}),this.tokenExpiration=t.add(n.expiresIn,"seconds").unix(),this.deliveryStream=n.stream,r.label=2;case 2:return[2]}}))}))},t.prototype.log=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r=this;return Object(l.d)(this,(function(i){return e.v=this.VERSION_MAP.get(t),n=new wt(this.TYPE_MAP.get(t),e),[2,new Promise((function(t,e){return Object(l.b)(r,void 0,void 0,(function(){var r=this;return Object(l.d)(this,(function(i){switch(i.label){case 0:return[4,this.init()];case 1:return i.sent(),this.firehose?this.firehose.putRecord({DeliveryStreamName:this.deliveryStream,Record:{Data:JSON.stringify(n)}},(function(n){n?(r.console.error("Error sending data to Firehose:",n),e(n)):t()})):this.console.debug("No firehose, so no log. Presumably because there is no token, because the user is logged out or because logging is not enabled for this client or location."),[2]}}))}))}))]}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Yt),Object(r.gc)(Wt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),pe=function(t){return t[t.url=0]="url",t[t.prePurchase=1]="prePurchase",t[t.postPurchase=2]="postPurchase",t[t.orderHistory=3]="orderHistory",t}({}),be=function(t){return t[t.prePurchase=1]="prePurchase",t[t.postPurchase=2]="postPurchase",t[t.orderHistory=4]="orderHistory",t}({}),fe=function(){function t(t,e,n,r,i,o,s,c,a,u,h,l){this.member=t,this.browser=e,this.storage=n,this.firehose=r,this.consoleSvc=i,this.configSvc=o,this.siteMapSvc=s,this.contentInjectionSvc=c,this.fileSystemSvc=a,this.network=u,this.api=h,this.exceptionHandler=l,this.URL_BATCH_SIZE=10,this.URL_BATCH_LIMIT=100,this.urls=[]}return Object.defineProperty(t.prototype,"dataCollectionEnabledForMember",{get:function(){return this.member.isLoggedIn&&(this.member.member.preferences&X.dataCollectionOptOut)!=X.dataCollectionOptOut},enumerable:!0,configurable:!0}),t.prototype.init=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n=this;return Object(l.d)(this,(function(r){switch(r.label){case 0:return t=function(t){n.dataCollectionEnabled=(t&_.DATA_INSIGHTS)==_.DATA_INSIGHTS,n.consoleSvc.debug("setDataCollectionEnabled flags:"+t+" dataCollectionEnable:"+n.dataCollectionEnabled)},[4,this.storage.flags.get()];case 1:return e=r.sent(),t(e),this.siteMapSvc.onSiteDetected.subscribe((function(t){n.onSiteDetected(t)})),this.configSvc.subscribeConfigChange(et.flags,(function(e){t(e)})),[2]}}))}))},t.prototype.checkSetting=function(t,e){return e&&e.settings&&(e.settings&t)==t},t.prototype.isProductPage=function(t,e){var n=!1;return t&&e&&e.pages&&e.pageMatch?n=Object.keys(e.pages).includes(e.pageMatch)&&(e.pages[e.pageMatch]&t)==t:n},t.prototype.loadJson=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return e=null,[4,this.storage.dataInsights.get()];case 1:return(n=r.sent())&&n.value&&!n.expired?(e=n.value,[3,9]):[3,2];case 2:return r.trys.push([2,5,,9]),[4,this.network.getText(t)];case 3:return e=r.sent(),[4,this.storage.dataInsights.setValue(e)];case 4:return r.sent(),[3,9];case 5:return r.sent(),n&&n.value?(e=n.value,[3,8]):[3,6];case 6:return[4,this.fileSystemSvc.getFileText("data-insights/data-insights-all-merchants.json")];case 7:e=r.sent(),r.label=8;case 8:return[3,9];case 9:return[2,e]}}))}))},t.prototype.doContentInjection=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,i,o,s,c;return Object(l.d)(this,(function(a){switch(a.label){case 0:return this.consoleSvc.debug("setupLogProducts() , siteData",t),[4,this.loadJson(this.configSvc.cdnHost+"/json/extension/data-insights-all-merchants.min.json?v="+this.api.cacheBuster)];case 1:e=a.sent(),a.label=2;case 2:return a.trys.push([2,6,,7]),i=JSON.parse(e),"string"==typeof(n=i[t.id])&&(n=JSON.parse(n)),this.consoleSvc.debug("for url: "+t.tab.url+"  --  selectedMerchantConfig:",n),(o=Object.keys(n)).includes(t.pageMatch)?r=n[t.pageMatch]:(s=t.pageMatch.endsWith("/")?t.pageMatch.substring(0,t.pageMatch.length-1):t.pageMatch+"/",o.includes(s)&&(r=n[s])),r?(this.consoleSvc.debug("DI: Injecting setupEventOnUnloadListener()",r),[4,this.contentInjectionSvc.injectScriptFile(t.tab.tabId,"data-insights/data-insights-factory.js")]):[3,4];case 3:return a.sent(),this.contentInjectionSvc.injectScript(t.tab.tabId,"\n          try{\n            var diResult = new DataInsightsFactory.DataInsightsFactory();\n            diResult.setupEventOnUnloadListener("+JSON.stringify(t)+",\n                  "+JSON.stringify(r)+",\n                  'coreonSiteDetected',\n                  "+this.configSvc.client+",\n                  "+(this.consoleSvc.getLevel()>=m.debug)+"\n                  );\n          }catch(ex){ }\n        "),[3,5];case 4:throw new Error("selectedMerchantConfig could not find a match for key "+t.pageMatch);case 5:return[3,7];case 6:return c=a.sent(),this.exceptionHandler.handleError(c,!0),[3,7];case 7:return[2]}}))}))},t.prototype.logProducts=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,i,o,s;return Object(l.d)(this,(function(c){switch(c.label){case 0:this.consoleSvc.debug("logProducts dataInsightResults:",JSON.parse(JSON.stringify(t))),t.exception&&this.consoleSvc.error("logProducts error dataInsightResults:",JSON.parse(JSON.stringify(t.exception))),c.label=1;case 1:return c.trys.push([1,4,,5]),e=this.cleanOutExtraDataForFirehose(e=t),n=this.browser.api.runtime.getManifest().version,[4,this.storage.extId.get()];case 2:switch(r=c.sent(),i=new Ct(e,n,r,this.member.member.id,this.configSvc.client),o=void 0,e.pageType){case be.prePurchase:o=xt.PrePurchaseProducts;break;case be.postPurchase:o=xt.PostPurchaseProducts;break;case be.orderHistory:o=xt.OrderHistoryProducts}return[4,this.firehose.log(o,i)];case 3:return c.sent(),[3,5];case 4:return s=c.sent(),this.consoleSvc.error("logProducts exception:",s),[3,5];case 5:return[2]}}))}))},t.prototype.cleanOutExtraDataForFirehose=function(t){return t.source&&delete t.source,t.clientID&&delete t.clientID,t},t.prototype.logUrl=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,i,o,s;return Object(l.d)(this,(function(c){switch(c.label){case 0:if(e=new _t(t),n=!1,this.consoleSvc.info("Queueing URL for log:",e),this.urls.push(e),!this.urls.length||this.urls.length%this.URL_BATCH_SIZE!=0)return[3,6];c.label=1;case 1:return c.trys.push([1,4,5,6]),r=this.browser.api.runtime.getManifest().version,[4,this.storage.extId.get()];case 2:return i=c.sent(),o=new Ct(this.urls,r,i,this.member.member.id,this.configSvc.client),this.consoleSvc.info("Pushing URL logs:",o),[4,this.firehose.log(xt.Urls,o)];case 3:return c.sent(),n=!0,[3,6];case 4:return s=c.sent(),this.consoleSvc.error("Failed to log URLs:",s),[3,6];case 5:return(n||this.urls.length>this.URL_BATCH_LIMIT)&&(this.urls=[]),[7];case 6:return[2]}}))}))},t.prototype.onSiteDetected=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){return this.dataCollectionEnabled&&this.dataCollectionEnabledForMember&&(this.consoleSvc.debug("onSiteDetected:",t),this.shouldLog(pe.url,t)&&this.logUrl(t),this.shouldDoContentInjection(t)&&this.doContentInjection(t)),[2]}))}))},t.prototype.shouldLog=function(t,e){switch(t){case pe.url:return this.checkSetting(St.logUrls,e);case pe.prePurchase:return this.checkSetting(St.logPrePurchase,e)&&this.isProductPage(be.prePurchase,e);case pe.postPurchase:return this.checkSetting(St.logPostPurchase,e)&&this.isProductPage(be.postPurchase,e);case pe.orderHistory:return this.checkSetting(St.logOrderHistory,e)&&this.isProductPage(be.orderHistory,e);default:return!1}},t.prototype.shouldDoContentInjection=function(t){return this.shouldLog(pe.prePurchase,t)||this.shouldLog(pe.postPurchase,t)||this.shouldLog(pe.orderHistory,t)},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(se),Object(r.gc)(Gt),Object(r.gc)(Qt),Object(r.gc)(de),Object(r.gc)(Wt),Object(r.gc)(zt),Object(r.gc)(le),Object(r.gc)(ue),Object(r.gc)(ae),Object(r.gc)(Xt),Object(r.gc)(Yt),Object(r.gc)(Kt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),ge=function(){function t(t,e,n,r,i,o,s,c,a,u,h,l,d,p,f){this.api=t,this.config=e,this.console=n,this.tabs=r,this.member=i,this.browser=o,this.storage=s,this.merchant=c,this.lifecycle=a,this.browserEvents=u,this.contentInjection=h,this.notifications=l,this.dataInsights=d,this.exceptions=p,this.gofer=f,this._brandServiceFunctionCalled=new b.b,this.brandServiceFunctionCalled=this._brandServiceFunctionCalled.asObservable(),window.reflection=this}return t.prototype.init=function(){var t=this;this.browserEvents.onRuntimeMessage.subscribe((function(e){t.onRuntimeMessage.apply(t,e)})),this.gofer.onReflect.subscribe((function(e){t.onReflect(e)}))},t.prototype.sendBackgroundMessage=function(t){var e=this;return new Promise((function(n){e.browser.api.runtime.sendMessage(t,(function(t){n(t)}))}))},t.prototype.processAccountResponse=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return e.value.isPopup&&0===t.status?[4,this.tabs.getActiveTabState()]:[3,2];case 1:n=r.sent().tabId,this.contentInjection.injectLoginOccurred(n),r.label=2;case 2:return[2,t]}}))}))},t.prototype.onReflect=function(t){var e=window.reflection;t.target.forEach((function(t){e=e[t]})),e.apply(null,t.args)},t.prototype.onRuntimeMessage=function(t,e,n){this[v[t.type]](t,n)},t.prototype.log=function(t,e){this.console[m[t.value.level]](t.value.message,t.value.extraInfo),e()},t.prototype.login=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.member.login(t.value.email,t.value.password)];case 1:return n=r.sent(),this.processAccountResponse(n,t),e(n),[2]}}))}))},t.prototype.activate=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:if(t.value.merchantId)return[3,1];throw"merchantId (number) missing in message value.";case 1:if(void 0!==t.value.urlType)return[3,2];throw"urlType (MerchantUrlType) missing in message value.";case 2:if(t.value.pageId)return[3,3];throw"pageId (PageIds) missing in message value.";case 3:return t.value.tabId?(n=this.tabs.getTabState(t.value.tabId),[3,6]):[3,4];case 4:return[4,this.tabs.getActiveTabState()];case 5:n=r.sent(),r.label=6;case 6:return[4,this.tabs.activate(n,t.value.merchantId,t.value.urlType,t.value.pageId,t.value.redirectContext)];case 7:r.sent(),e(),r.label=8;case 8:return[2]}}))}))},t.prototype.getCdnHost=function(t,e){e(this.config.cdnHost)},t.prototype.getFilePath=function(t,e){e(this.browser.api.runtime.getURL(t.value))},t.prototype.showTutorial=function(t,e){this.lifecycle.showTutorial(!1),e()},t.prototype.getPopupData=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(l.d)(this,(function(c){switch(c.label){case 0:return(i=t.value&&t.value.tabId||0)?[4,this.tabs.getTabState(i)]:[3,2];case 1:return r=c.sent(),[3,4];case 2:return[4,this.tabs.getActiveTabState()];case 3:r=c.sent(),c.label=4;case 4:return(n=new K).tabId=r&&r.tabId||0,n.member=this.member.member,n.notifications=this.notifications.fetchValid(),r?[4,this.tabs.verifyCurrentUrl(r)]:[3,6];case 5:c.sent(),r.merchantState&&(n.merchant=r.merchantState.merchant,n.activationState=r.merchantState.activationState),c.label=6;case 6:return[4,this.storage.prefs.get()];case 7:return o=c.sent(),n.prefs=o||{},s=n,[4,this.storage.flags.get()];case 8:return s.flags=c.sent(),this.console.info("Popup data:",n),e(n),[2]}}))}))},t.prototype.register=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.member.register(t.value.email)];case 1:return n=r.sent(),this.processAccountResponse(n,t),e(n),[2]}}))}))},t.prototype.setStorageItem=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.storage.setLocal(t.value.key,t.value.value)];case 1:return n.sent(),e(),[2]}}))}))},t.prototype.getStorageItem=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.storage.getLocal(t.value)];case 1:return n=r.sent(),e(n),[2]}}))}))},t.prototype.dismissActivation=function(t,e){this.tabs.setTabActivationDismissed(t.value.tabId),e()},t.prototype.setActivationInjected=function(t,e){this.tabs.setTabActivationInjected(t.value.tabId),e()},t.prototype.setTabShopperMarketingInjected=function(t,e){this.tabs.setTabShopperMarketingInjected(t.value.tabId),e()},t.prototype.getLocalizedString=function(t,e){var n;e((n=this.browser.api.i18n).getMessage.apply(n,Object(l.f)(t.value)))},t.prototype.navigateToFeaturedMerchant=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i;return Object(l.d)(this,(function(o){switch(o.label){case 0:if(t.value)return[3,1];throw"navigateToFeaturedMerchant missing merchantID";case 1:return[4,this.tabs.openNewTab(void 0,!0)];case 2:return n=o.sent(),[4,this.merchant.fetchMerchantById(t.value,this.config.client)];case 3:return r=o.sent(),[4,this.tabs.constructRedirectUrl(r,null,I.PopupFeaturedMerchantClick)];case 4:i=o.sent(),this.tabs.navigate(i,n),e(),o.label=5;case 5:return[2]}}))}))},t.prototype.getFeaturedMerchants=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var t,n,r,i;return Object(l.d)(this,(function(o){switch(o.label){case 0:return t=[],[4,this.storage.featuredMerchants.get()];case 1:if((n=o.sent())&&n.length)for(r=0;r<n.length;r++)(i=this.merchant.getMerchantMeta(n[r]))&&i.reward&&t.push(i);return e(t),[2]}}))}))},t.prototype.sendPasswordReminder=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.member.sendPasswordReminder(t.value.email)];case 1:return n.sent(),e(),[2]}}))}))},t.prototype.setActivationConfirmed=function(t,e){this.tabs.setTabActivationConfirmed(t.value.tabId),e()},t.prototype.getSERPMerchantMetasByUrls=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i;return Object(l.d)(this,(function(o){for(r in n=[],t.value.urls)t.value.urls.hasOwnProperty(r)&&(i=this.merchant.matchMerchantUrl(t.value.urls[r]),this.merchant.shouldShowSERP(i)?n.push(i):n.push(null));return e(n),[2]}))}))},t.prototype.logCouponResults=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.api.postCouponLog(t.value)];case 1:return n.sent(),e(),[2]}}))}))},t.prototype.resetCouponCoolDown=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){return this.tabs.resetCouponCoolDown(t.value),e(),[2]}))}))},t.prototype.parseHostSiteMessage=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return t.messageSrc!==this.config.brand?[3,8]:t.messageContent?[4,e.set(t.messageContent)]:[3,7];case 1:return i.sent(),[4,this.storage.extId.get()];case 2:return(r=i.sent())?[4,this.storage.extHash.get()]:[3,4];case 3:r=i.sent(),i.label=4;case 4:return r?[4,n(t.messageContent)]:[3,6];case 5:i.sent(),i.label=6;case 6:return[3,8];case 7:this.exceptions.handleError(new lt("messageContent missing from host site message: "+JSON.stringify(t))),i.label=8;case 8:return[2]}}))}))},t.prototype.parseCampaignMessage=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e=this;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.parseHostSiteMessage(t,this.storage.campaign,(function(t){e.api.postCampaignData(t)}))];case 1:return n.sent(),[2]}}))}))},t.prototype.parseReferralMessage=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e=this;return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.config.isFlagEnabled(_.MKT_REFERRALS)?[4,this.parseHostSiteMessage(t,this.storage.referral,(function(t){e.api.postReferralData(t)}))]:[2];case 1:return n.sent(),[2]}}))}))},t.prototype.sendDataFromHostToExt=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:if(!t||!t.value)return[3,6];switch(t.value.messageType){case"cmpData":return[3,1];case"refData":return[3,3]}return[3,5];case 1:return[4,this.parseCampaignMessage(t.value)];case 2:return n.sent(),[3,6];case 3:return[4,this.parseReferralMessage(t.value)];case 4:return n.sent(),[3,6];case 5:return this.console.debug("Received unexpected messageType from host.",t),[3,6];case 6:return e(),[2]}}))}))},t.prototype.logImpression=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){return this.tabs.getTabState(t.value),[2]}))}))},t.prototype.executeReflect=function(t,e){var n,r;try{t.value&&t.value.class&&t.value.member&&(this.console.cachedLogPile=[],this.console.shouldCacheLogs=!0,e({results:t.value.params?"messagingSvc"===t.value.class?this[t.value.member].apply(this,Object(l.f)(t.value.params)):t.value.member2&&""!==t.value.member2?(n=this[t.value.class][t.value.member])[t.value.member2].apply(n,Object(l.f)(t.value.params)):(r=this[t.value.class])[t.value.member].apply(r,Object(l.f)(t.value.params)):"messagingSvc"===t.value.class?this[t.value.member]:this[t.value.class][t.value.member],logs:this.console.cachedLogPile}),this.console.cachedLogPile=[],this.console.shouldCacheLogs=!1)}catch(i){e("Call Failed! "+i.message+" "+i.stack)}},t.prototype.executeReflectCmd=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i,o,s,c,a,u,h;return Object(l.d)(this,(function(d){switch(d.label){case 0:return d.trys.push([0,13,,14]),t.value.cmd?(this.console.cachedLogPile=[],this.console.shouldCacheLogs=!0,n=null,i=(r=t.value.cmd).lastIndexOf(")")===r.length-1,o=r.split("."),i?(s=(s=(s="["+(s=r.substring(r.indexOf("(")+1,r.lastIndexOf(")")))+"]").replace(/([a-zA-Z0-9]+?):/gu,'"$1":')).replace(/'/gu,'"'),s=JSON.parse(s),"messagingSvc"!==o[0]?[3,2]:[4,this[c=o[1].substring(0,o[1].indexOf("("))].apply(this,Object(l.f)(s))]):[3,7]):[3,12];case 1:return n=d.sent(),[3,6];case 2:return o[2].indexOf("(")>0?(c=o[2].substring(0,o[2].indexOf("(")),[4,(u=this[o[0]][o[1]])[c].apply(u,Object(l.f)(s))]):[3,4];case 3:return n=d.sent(),[3,6];case 4:return c=o[1].substring(0,o[1].indexOf("(")),[4,(h=this[o[0]])[c].apply(h,Object(l.f)(s))];case 5:n=d.sent(),d.label=6;case 6:return[3,11];case 7:return"messagingSvc"!==o[0]?[3,9]:[4,this[o[1]]];case 8:return n=d.sent(),[3,11];case 9:return[4,this[o[0]][o[1]]];case 10:n=d.sent(),d.label=11;case 11:e({results:n,logs:this.console.cachedLogPile}),this.console.cachedLogPile=[],this.console.shouldCacheLogs=!1,d.label=12;case 12:return[3,14];case 13:return a=d.sent(),e("Call Failed! "+a.message+" "+a.stack),[3,14];case 14:return[2]}}))}))},t.prototype.getAllReflects=function(t,e){var n=this,r=[];Object.keys(this).map((function(t){var e={name:t,children:[]};Object.keys(n[t].__proto__).map((function(r){e.children.push({name:r+("function"==typeof n[t][r]?": f()":"")})})),r.push(e)}));var i={name:"messagingSvc",children:[]};Object.keys(this.__proto__).map((function(t){i.children.push({name:t+("function"==typeof n[t]?": f()":"")})})),r.push(i),e(r)},t.prototype.constructRewardString=function(t,e){e(this.merchant.constructRewardString(t.value.clientId,t.value.reward))},t.prototype.getCurrencySymbol=function(t,e){e(this.merchant.getCurrencySymbol(t.value.loc))},t.prototype.constructRewardStringInCurrency=function(t,e){e(this.merchant.constructRewardStringInCurrency(t.value.clientId,t.value.merchant))},t.prototype.constructActivateString=function(t,e){e(this.merchant.constructActivateString(t.value.clientId,t.value.reward,t.value.activated,!!t.value.isShort))},t.prototype.notificationClicked=function(t,e){this.notifications.notificationClicked(t.value),e()},t.prototype.notificationRemoveClicked=function(t,e){this.notifications.remove(t.value),e()},t.prototype.executeCallback=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.lifecycle.executeCallback()];case 1:return t.sent(),e(),[2]}}))}))},t.prototype.refreshAccountBalance=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.member.refreshBalance()];case 1:return t=n.sent(),e(t),[2]}}))}))},t.prototype.userClickedInPage=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){return t.value.clientId===this.config.client&&this.tabs.updateUserClicked(t.value.tabId,!0),e(),[2]}))}))},t.prototype.callBrandServiceFunction=function(t,e){this._brandServiceFunctionCalled.next(t.value),e()},t.prototype.updateMemberPrefs=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.member.updateMemberPref(t.value)];case 1:return n.sent(),e(),[2]}}))}))},t.prototype.dataInsightsResults=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){return t.value.clientID===this.config.client&&this.dataInsights.logProducts(t.value),e(),[2]}))}))},t.prototype.openSiteTab=function(t,e){this.tabs.openSiteTab(t.value),e()},t.prototype.openGoTab=function(t,e){this.tabs.openGoTab(t.value),e()},t.prototype.openSettings=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.tabs.openSettings()];case 1:return t.sent(),e(),[2]}}))}))},t.prototype.closeSettings=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.tabs.closeSettings()];case 1:return t.sent(),e(),[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Yt),Object(r.gc)(zt),Object(r.gc)(Wt),Object(r.gc)(ce),Object(r.gc)(se),Object(r.gc)(Gt),Object(r.gc)(Qt),Object(r.gc)(ie),Object(r.gc)(ne),Object(r.gc)(Vt),Object(r.gc)(ue),Object(r.gc)(he),Object(r.gc)(fe),Object(r.gc)(Kt),Object(r.gc)($t))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),ve=function(){function t(t,e,n,r,i,o){this.apiSvc=t,this.config=e,this.browserEvents=n,this.consoleSvc=r,this.lifecycleEvents=i,this.storageSvc=o,this.memberId=0,this.extensionId=null,this.loggingSupported=!1,this.logForMember=!1,this.tabStorage={},this.tabToUidMap=new Map,this.lastRequestId={},this.lastTimeStamp=0,this.detailsTotalSize={},this.hasOversized={},this.supportedRequestTypes=["main_frame"],this.invalidTransitionQualifier="from_address_bar",this.invalidTransitionType="auto_bookmark"}return Object.defineProperty(t.prototype,"shouldLog",{get:function(){return this.loggingSupported&&this.logForMember},enumerable:!0,configurable:!0}),t.prototype.init=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e=this;return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.config.subscribeConfigChange(et.flags,(function(t){e.loggingSupported=(t&_.ANSWER_LOGGING)==_.ANSWER_LOGGING})),this.lifecycleEvents.onAccountInfoChanged.subscribe((function(t){return Object(l.b)(e,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.memberId=t.id,this.logForMember=t.id&&t.doSurveyLog,e=this,[4,this.storageSvc.extId.get()];case 1:return e.extensionId=n.sent(),[2]}}))}))})),this.browserEvents.onStartSurveyLogging.subscribe((function(t){e.shouldLog&&e.startLogging(t)})),this.browserEvents.onUpdateSurveyLogging.subscribe((function(t){e.shouldLog&&e.updateTabStorageLog(t)})),this.browserEvents.onEndSurveyLogging.subscribe((function(t){e.shouldLog&&e.endLogging(t)})),this.browserEvents.onWebNavigationCommitted.subscribe((function(t){e.shouldLog&&e.breakLogging(t)})),this.browserEvents.onTabCreated.subscribe((function(t){e.shouldLog&&e.continueLoggingNewTab(t)})),t=this,[4,this.storageSvc.extId.get()];case 1:return t.extensionId=n.sent(),[2]}}))}))},t.prototype.startLogging=function(t){var e=t.tabId;if(e&&!this.tabStorage.hasOwnProperty(e)){this.consoleSvc.debug("startLogging",t),this.tabStorage[e]={},this.tabStorage[e].requests={};var n=this.memberId+"-"+Date.now()+"-"+this.extensionId;this.tabToUidMap.set(e,n),this.detailsTotalSize[n]=0,this.hasOversized[n]=!1,this.updateTabStorageLog({event:"onLoggingStart",details:t})}},t.prototype.updateTabStorageLog=function(e){var n=e.eventName,r=e.details;if(this.supportedRequestTypes.includes(r.type)){var i=r.tabId,o=r.requestId;if(i&&o&&this.tabStorage.hasOwnProperty(i)){this.consoleSvc.debug("updateTabStorageLog: event - "+n,r),this.tabStorage[i].requests.hasOwnProperty(o)||(this.tabStorage[i].requests[o]=[]);var s=this.tabToUidMap.get(i);r.timeStamp!==this.lastTimeStamp&&(this.tabStorage[i].requests[o].push(e),this.lastTimeStamp=r.timeStamp,s&&(this.detailsTotalSize[s]+=JSON.stringify(r).length,this.lastRequestId[this.tabToUidMap.get(i)]=o)),s&&this.detailsTotalSize[s]>t.MAX_LOG_SIZE&&!this.hasOversized[s]&&(this.hasOversized[s]=!0,r.oversized=this.detailsTotalSize[s],this.endLogging(r))}}},t.prototype.endLogging=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,i,o,s=this;return Object(l.d)(this,(function(c){switch(c.label){case 0:if(0===Object.keys(this.tabStorage).length)return this.consoleSvc.debug("Nothing logged so nothing to see here."),[2];if(n=t.requestId,!(r=this.tabToUidMap.get(e=t.tabId))||!e||!this.tabStorage.hasOwnProperty(e))return[2];if(t.redacted&&!n)for(o in i=this.tabStorage[e].requests[this.lastRequestId[r]])i.hasOwnProperty(o)&&i[o]&&i[o].details&&i[o].details.url===t.url&&(i[o].details.url="REDACTED",i[o].details.transitionQualifiers=t.transitionQualifiers,i[o].details.transitionType=t.transitionType);else this.tabStorage[e].requests.hasOwnProperty(n)||(this.tabStorage[e].requests[n]=[]),this.tabStorage[e].requests[n].push({event:"onLoggingEnd",details:t}),this.lastRequestId[r]=n;return this.consoleSvc.debug("Logging ended by tab:"+e+", - Final tabStorage map: ",this.tabStorage),[4,this.logCurrentData(r)];case 1:return c.sent(),this.tabToUidMap.forEach((function(t,e){r===t&&delete s.tabStorage[e]})),[2]}}))}))},t.prototype.logCurrentData=function(e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,i,o,s,c,a,u,h,d,p,b;return Object(l.d)(this,(function(l){switch(l.label){case 0:for(o in n={},r=0,i=[],this.tabStorage)i.push(o);s=0,l.label=1;case 1:if(!(s<i.length))return[3,6];if(c=i[s],this.tabToUidMap.get(Number(c))!==e)return[3,5];for(u in a=[],this.tabStorage[c].requests)a.push(u);h=0,l.label=2;case 2:return h<a.length?this.tabStorage[c].requests.hasOwnProperty(d=a[h])?(0===Object.getOwnPropertyNames(n).length&&(n[c]={},n[c].requests={}),n[c].requests[d]=this.tabStorage[c].requests[d],r++,p=d===this.lastRequestId[e],r>=t.surveyLogBatchSize||p?[4,this.apiSvc.executeSurveyLog({uniqueID:e,surveyLog:JSON.stringify(n)})]:[3,4]):[3,4]:[3,5];case 3:return b=l.sent(),n={},r=0,this.consoleSvc.debug("Survey log post response:",b),[2];case 4:return h++,[3,2];case 5:return s++,[3,1];case 6:return[2]}}))}))},t.prototype.breakLogging=function(t){if(t&&(t.transitionQualifiers&&t.transitionQualifiers.indexOf(this.invalidTransitionQualifier)>=0||t.transitionType&&t.transitionType===this.invalidTransitionType)){var e=t.tabId;e&&this.tabStorage.hasOwnProperty(e)&&(this.consoleSvc.debug("breakLogging",t),t.redacted=!0,this.endLogging(t))}},t.prototype.continueLoggingNewTab=function(t){var e=t.openerTabId;if(e&&this.tabStorage.hasOwnProperty(e)){var n=t.id;n&&!this.tabStorage.hasOwnProperty(n)&&(this.tabStorage[n]={},this.tabStorage[n].requests=[],this.tabToUidMap.set(n,this.tabToUidMap.get(e)),this.consoleSvc.debug("Start logging for new tabId:"+n+" opened by tabId: "+e))}},t.MAX_LOG_SIZE=1e6,t.surveyLogBatchSize=10,t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Yt),Object(r.gc)(zt),Object(r.gc)(Vt),Object(r.gc)(Wt),Object(r.gc)(ne),Object(r.gc)(Qt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),me=function(){function t(t,e,n){this.tabs=t,this.member=e,this.browser=n,this.supportedSizes=[16,32,48,64,128],this.assetPath="assets/icons",this.animatingTabs={},this.pulseAnimation=new Oe(["pulse-0.png","pulse-1.png","pulse-2.png","pulse-1.png","pulse-0.png","pulse+1.png","pulse+2.png","pulse+1.png","pulse-0.png"],[32,48,64,128],150,2),this.clientIconMap=(new Map).set(w.ibd,new je("default.png","default.png","default.png")).set(w.mp,new je("merchant.png","merchant-activated.png","non-merchant.png",this.pulseAnimation)).set(w.sb,new je("merchant.png","merchant-activated.png","non-merchant.png",this.pulseAnimation)).set(w.tada,new je("merchant.png","merchant.png","non-merchant.png")).set(w.upm,new je("default.png","default.png","default.png"))}return t.prototype.getPath=function(t,e){var n,r;void 0===e&&(e=this.supportedSizes);var i={};try{for(var o=Object(l.g)(e),s=o.next();!s.done;s=o.next()){var c=s.value;i[""+c]=this.assetPath+"/"+c+"/"+t}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},t.prototype.setIcon=function(t,e,n){return void 0===n&&(n=this.supportedSizes),Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.tabs.checkTabExists(t)];case 1:return r.sent()?[4,this.browser.callbackDecorator("browserAction.setIcon",this.browser.api.browserAction.setIcon,[{path:this.getPath(e,n),tabId:t}])]:[3,3];case 2:return[2,r.sent()];case 3:return[2]}}))}))},t.prototype.stopAnimation=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(r){switch(r.label){case 0:return clearInterval(t),delete this.animatingTabs[e],[4,this.setIcon(e,n)];case 1:return r.sent(),[2]}}))}))},t.prototype.animateIcon=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,i,o,s=this;return Object(l.d)(this,(function(c){return r=null,this.animatingTabs[t]||(this.animatingTabs[t]=!0,i=0,o=1,r=setInterval((function(){return Object(l.b)(s,void 0,void 0,(function(){return Object(l.d)(this,(function(s){switch(s.label){case 0:return i>e.frames.length-1?o<e.maxLoopCount?(i=0,o++,[3,3]):[3,1]:[3,3];case 1:return[4,this.stopAnimation(r,t,n)];case 2:return s.sent(),[2];case 3:return s.trys.push([3,5,,7]),[4,this.setIcon(t,e.frames[i],e.sizes)];case 4:return s.sent(),i++,[3,7];case 5:return s.sent(),[4,this.stopAnimation(r,t,n)];case 6:return s.sent(),[3,7];case 7:return[2]}}))}))}),e.frameDuration)),[2]}))}))},t.prototype.setIconWithActivationState=function(t,e,n,r){return void 0===r&&(r=!1),Object(l.b)(this,void 0,void 0,(function(){var i,o,s;return Object(l.d)(this,(function(c){switch(c.label){case 0:switch(o=this.clientIconMap.get(t),s=r?o.animation:null,n){case J.NotActive:case J.StandingDown:case J.Activating:i=o.merchant;break;case J.Activated:i=this.member.isLoggedIn?o.merchantActivated:o.merchant;break;default:i=o.nonMerchant}return s?[4,this.animateIcon(e,s,i)]:[3,2];case 1:return c.sent(),[3,4];case 2:return[4,this.setIcon(e,i)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(ce),Object(r.gc)(se),Object(r.gc)(Gt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Oe=function(){return function(t,e,n,r){void 0===n&&(n=100),void 0===r&&(r=2),this.frames=t,this.sizes=e,this.frameDuration=n,this.maxLoopCount=r}}(),je=function(){return function(t,e,n,r){void 0===r&&(r=null),this.merchant=t,this.merchantActivated=e,this.nonMerchant=n,this.animation=r}}(),ye=function(){function t(t,e,n,r){this.api=t,this.alarms=e,this.storage=n,this.browser=r,this.isEnabled=!0,this.periodInMinutes=10080}return Object.defineProperty(t.prototype,"isSupported",{get:function(){return!(!this.browser.api.management||!this.browser.api.management.getAll)},enumerable:!0,configurable:!0}),t.prototype.log=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(l.d)(this,(function(i){switch(i.label){case 0:return this.isEnabled&&this.isSupported?[4,this.browser.callbackDecorator("management.getAll",this.browser.api.management.getAll,[],(function(t){return t}))]:[3,3];case 1:return t=i.sent(),e=t.filter((function(t){return t.id!==r.browser.api.runtime.id&&t.enabled})).map((function(t){return t.id})),n=new pt(e),[4,this.api.postPeerLog(n)];case 2:i.sent(),this.storage.lastPeerLog.set(d().unix()),i.label=3;case 3:return[2]}}))}))},t.prototype.init=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(l.d)(this,(function(i){switch(i.label){case 0:return[4,this.storage.extHash.get()];case 1:return t=i.sent(),[4,this.storage.extId.get()];case 2:return e=i.sent(),t&&e?[4,this.alarms.registerAlarm("peer-log",{periodInMinutes:this.periodInMinutes},(function(){return Object(l.b)(r,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.log()];case 1:return t.sent(),[2]}}))}))}))]:[3,7];case 3:return i.sent(),[4,this.storage.lastPeerLog.get()];case 4:return n=i.sent(),d().unix()>n+60*this.periodInMinutes?[4,this.log()]:[3,6];case 5:i.sent(),i.label=6;case 6:return[3,8];case 7:setTimeout((function(){return Object(l.b)(r,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.init()];case 1:return t.sent(),[2]}}))}))}),6e4),i.label=8;case 8:return[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(Yt),Object(r.gc)(Zt),Object(r.gc)(Qt),Object(r.gc)(Gt))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Se=(n("26FU"),function(){function t(t,e){this.browser=t,this.el=e}return t.prototype.ngOnInit=function(){this.el.nativeElement.innerHTML=this.browser.getLocalizedMessage(this.l10n,this.substitutions)},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(Gt),Object(r.Wb)(r.o))},t.\u0275dir=Object(r.Rb)({type:t,selectors:[["","l10n",""]],inputs:{l10n:"l10n",substitutions:"substitutions"}}),t}()),we=function(){function t(t,e){this.tabs=t,this.messaging=e,this.DEFAULT_POPUP_VIEW_KEY="default-popup-view",this._onInitialized=new b.b,this.onInitialized=this._onInitialized.asObservable(),this._onOpenSiteTab=new b.b,this.onOpenSiteTab=this._onOpenSiteTab.asObservable(),this._onOpenHowItWorks=new b.b,this.onOpenHowItWorks=this._onOpenHowItWorks.asObservable()}return Object.defineProperty(t.prototype,"accountPopoverMenu",{get:function(){return this.ACCOUNT_POPOVER_MENU},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMerchantContext",{get:function(){return!!this._data.merchant},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this.data.flags||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"member",{get:function(){var t=this._data?this._data.member:null;return t&&t.id?t:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tabId",{get:function(){return this._tabId||(this._tabId=this.data?this.data.tabId:0),this._tabId},enumerable:!0,configurable:!0}),t.prototype.init=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.updateData()];case 1:return t.sent(),this._onInitialized.next(),[2]}}))}))},t.prototype.updateData=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.sendBackgroundMessage(v.getPopupData,{tabId:this.tabId})];case 1:return t=e.sent(),this._data=t,[2]}}))}))},t.prototype.sendBackgroundMessage=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return n=new P(t,e),[4,this.messaging.sendBackgroundMessage(n)];case 1:return[2,r.sent()]}}))}))},t.prototype.sendActivationMessage=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.isMerchantContext?[4,this.sendBackgroundMessage(v.activate,{tabId:this.tabId,merchantId:this.data.merchant.id,pageId:I.PopupMerchantClick,urlType:S.Merchant})]:[3,3];case 1:return t.sent(),[4,this.updateData()];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.getDefaultView=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.sendBackgroundMessage(v.getStorageItem,this.DEFAULT_POPUP_VIEW_KEY)];case 1:return[2,t.sent()||_.SHOP]}}))}))},t.prototype.setAccountPopoverMenu=function(t){this.ACCOUNT_POPOVER_MENU=t},t.prototype.isFlagEnabled=function(t){return(this.flags&t)==t},t.prototype.isActivatedMerchantContext=function(){return this.isMerchantContext&&[J.Activated,J.Activating].includes(this.data.activationState)},t.prototype.openSiteTab=function(t,e){this._onOpenSiteTab.next({location:t,args:e})},t.prototype.openHowItWorks=function(){this._onOpenHowItWorks.next()},t.prototype.openTerms=function(){this.tabs.openProdegeTab("terms-of-use")},t.prototype.openPrivacy=function(){this.tabs.openProdegeTab("privacy-policy")},t.prototype.log=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.sendBackgroundMessage(v.log,{level:e,message:t,extraInfo:n})];case 1:return r.sent(),[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(ce),Object(r.gc)(ge))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Ce=function(t){return t[t.Login=0]="Login",t[t.Answer=1]="Answer",t[t.Merchant=2]="Merchant",t[t.Registration=3]="Registration",t[t.FeaturedStores=4]="FeaturedStores",t}({}),_e=function(){function t(t){this.el=t}return t.prototype.ngOnInit=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,fetch(this.src)];case 1:return[4,e.sent().text()];case 2:return t=e.sent(),this.el.nativeElement.innerHTML=t,[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(r.o))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-svg"]],inputs:{src:"src"},decls:0,vars:0,template:function(t,e){},styles:[""],encapsulation:2}),t}();function xe(t,e){1&t&&Object(r.Xb)(0,"p",2)}function Me(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",5),Object(r.cc)(1,"div",6),Object(r.Xb)(2,"div"),Object(r.bc)(),Object(r.cc)(3,"div",7),Object(r.cc)(4,"b"),Object(r.Kc)(5),Object(r.bc)(),Object(r.cc)(6,"p"),Object(r.Kc)(7),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(8,"div",8),Object(r.cc)(9,"a",9),Object(r.kc)("click",(function(){Object(r.Cc)(n);var t=e.$implicit;return Object(r.mc)(2).alertClicked(t.id)})),Object(r.Kc)(10),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(11,"div",10),Object(r.cc)(12,"shared-svg",11),Object(r.kc)("click",(function(){Object(r.Cc)(n);var t=e.$implicit;return Object(r.mc)(2).dismissAlert(t.id)})),Object(r.bc)(),Object(r.bc)(),Object(r.bc)()}if(2&t){var i=e.$implicit;Object(r.Jb)(5),Object(r.Lc)(i.title),Object(r.Jb)(2),Object(r.Lc)(i.text),Object(r.Jb)(3),Object(r.Lc)(i.linkText)}}function Pe(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"a",12),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)(2).toggleAlertLimit()})),Object(r.Kc)(1),Object(r.bc)()}if(2&t){var i=Object(r.mc)(2);Object(r.Jb)(1),Object(r.Lc)(i.toggleAlertLimitText)}}function Ie(t,e){if(1&t&&(Object(r.ac)(0),Object(r.Ic)(1,Me,13,3,"div",3),Object(r.nc)(2,"slice"),Object(r.Ic)(3,Pe,2,1,"a",4),Object(r.Zb)()),2&t){var n=Object(r.mc)();Object(r.Jb)(1),Object(r.sc)("ngForOf",n.shouldShowAllAlerts?n.alerts:Object(r.pc)(2,2,n.alerts,0,n.ALERT_LIMIT)),Object(r.Jb)(2),Object(r.sc)("ngIf",n.alerts.length>2)}}var ke=function(t){return[t]};function Ae(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",17),Object(r.kc)("click",(function(){Object(r.Cc)(n);var t=e.$implicit;return Object(r.mc)(2).surveyClicked(t)})),Object(r.cc)(1,"div",18),Object(r.Kc)(2),Object(r.bc)(),Object(r.cc)(3,"div",19),Object(r.Xb)(4,"b",20),Object(r.cc)(5,"span"),Object(r.Kc)(6),Object(r.bc)(),Object(r.bc)(),Object(r.bc)()}if(2&t){var i=e.$implicit,o=Object(r.mc)(2);Object(r.Jb)(2),Object(r.Lc)(o.formatReward(i)),Object(r.Jb)(2),Object(r.sc)("substitutions",Object(r.wc)(3,ke,i.loi)),Object(r.Jb)(2),Object(r.Mc)("Survey #",i.srvId,"")}}function Re(t,e){if(1&t){var n=Object(r.dc)();Object(r.ac)(0),Object(r.cc)(1,"div",13),Object(r.Xb)(2,"h1",14),Object(r.cc)(3,"a",15),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().viewAll()})),Object(r.bc)(),Object(r.bc)(),Object(r.Ic)(4,Ae,7,5,"div",16),Object(r.Zb)()}if(2&t){var i=Object(r.mc)();Object(r.Jb)(4),Object(r.sc)("ngForOf",i.surveys)}}var Te=function(){function t(t,e,n,r){this.tabs=t,this.popup=e,this.config=n,this.browser=r,this.SHOW_MORE_ALERTS="popup_answer_more_alerts",this.ALERT_LIMIT=2,this.alerts=[],this.surveys=[]}return t.prototype.ngOnInit=function(){this.alerts=this.popup.data.notifications.filter((function(t){return t.type===ut.Survey})),this.surveys=this.popup.member.surveys,this.toggleAlertLimitText=this.browser.getLocalizedMessage(this.SHOW_MORE_ALERTS)},t.prototype.processNotification=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return n=this.alerts.findIndex((function(t){return t.id===e})),this.alerts.splice(n,1),[4,this.popup.sendBackgroundMessage(t,e)];case 1:return r.sent(),[4,this.popup.updateData()];case 2:return r.sent(),[2]}}))}))},t.prototype.alertClicked=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.processNotification(v.notificationClicked,t)];case 1:return e.sent(),[2]}}))}))},t.prototype.dismissAlert=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.processNotification(v.notificationRemoveClicked,t)];case 1:return e.sent(),[2]}}))}))},t.prototype.toggleAlertLimit=function(){this.shouldShowAllAlerts=!this.shouldShowAllAlerts,this.toggleAlertLimitText=this.browser.getLocalizedMessage(this.shouldShowAllAlerts?"popup_answer_less_alerts":this.SHOW_MORE_ALERTS)},t.prototype.viewAll=function(){this.popup.openSiteTab(Mt.Answer)},t.prototype.formatReward=function(t){return this.config.formatAccountBalance(t.sb)},t.prototype.surveyClicked=function(t){this.tabs.openNewTab(t.url,!0)},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(ce),Object(r.Wb)(we),Object(r.Wb)(zt),Object(r.Wb)(Gt))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["lib-answer"]],decls:3,vars:3,consts:[["class","no-surveys","l10n","popup_answer_no_surveys",4,"ngIf"],[4,"ngIf"],["l10n","popup_answer_no_surveys",1,"no-surveys"],["class","alert",4,"ngFor","ngForOf"],["class","alert-limit-toggle",3,"click",4,"ngIf"],[1,"alert"],[1,"status"],[1,"text"],[1,"link"],[3,"click"],[1,"x"],["src","assets/redesign/icons/x.svg",3,"click"],[1,"alert-limit-toggle",3,"click"],[1,"title"],["l10n","popup_answer_title"],["l10n","popup_answer_view_all",3,"click"],["class","card survey",3,"click",4,"ngFor","ngForOf"],[1,"card","survey",3,"click"],[1,"reward"],[1,"info"],["l10n","popup_answer_survey_time",3,"substitutions"]],template:function(t,e){1&t&&(Object(r.Ic)(0,xe,1,0,"p",0),Object(r.Ic)(1,Ie,4,6,"ng-container",1),Object(r.Ic)(2,Re,5,1,"ng-container",1)),2&t&&(Object(r.sc)("ngIf",!e.alerts.length&&!e.surveys.length),Object(r.Jb)(1),Object(r.sc)("ngIf",e.alerts.length),Object(r.Jb)(1),Object(r.sc)("ngIf",e.surveys.length))},directives:[h.t,Se,h.s,_e],pipes:[h.E],styles:["[_nghost-%COMP%]{flex-grow:1}.no-surveys[_ngcontent-%COMP%]{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;flex-grow:1;text-align:center;font-size:14px;line-height:18px;margin-bottom:16px}.alert[_ngcontent-%COMP%]{padding:10px;display:flex;border-bottom:solid 1px var(--gray)}.alert[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{display:flex;align-items:center;padding-right:15px}.alert[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{background:var(--error);width:10px;height:10px;border-radius:5px}.alert[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex-grow:1}.alert[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0 0}.alert[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{display:flex;align-items:center}.alert[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{border:solid 1px var(--primary);border-radius:4px;padding:8px 15px;color:var(--primary);font-weight:700}.alert[_ngcontent-%COMP%]   .x[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:10px}.alert[_ngcontent-%COMP%]   .x[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{cursor:pointer;fill:var(--default)}.alert-limit-toggle[_ngcontent-%COMP%]{display:block;margin-top:10px;margin-left:35px}.title[_ngcontent-%COMP%]{overflow:auto;margin-bottom:10px;margin-top:15px}.title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:400;font-size:14px;margin:0;color:var(--default-darker);float:left}.title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary);float:right}.survey[_ngcontent-%COMP%]{cursor:pointer}.survey[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{width:130px;background:var(--secondary-light);padding-top:15px;padding-bottom:15px;color:var(--secondary);font-size:24px;font-weight:700;text-align:center}.survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-grow:1;flex-direction:column;justify-content:center;margin-left:10px}.survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{display:block;color:var(--secondary);font-size:14px}.survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--default-darker);font-size:12px}"]}),t}(),Ee=function(){function t(){this.AuthType={Login:0,Registration:1}}return t.prototype.init=function(t,e,n,r){var i;this.type=t,this._popup=e,this._browser=r,this._renderer=n,this.isDismissible=this._popup.isMerchantContext,this.usernamePlaceholder=this._browser.getLocalizedMessage("popup_auth_username_placeholder"),t===this.AuthType.Login?(i="popup_auth_login_error",this.name="Login",this.runtimeMessageType=v.login):(i="popup_auth_signup_error",this.name="Register",this.runtimeMessageType=v.register),this.genericError=this._browser.getLocalizedMessage(i)},t.prototype.onUsernameChanged=function(t){this.username=t},t.prototype.clear=function(){this.error=null,this.usernameError=!1},t.prototype.validateUsername=function(){return!!this.username||(this.error=this._browser.getLocalizedMessage("popup_auth_error_user_blank"),this.usernameError=!0,!1)},t.prototype.throwError=function(t,e){this.error=this.genericError,this._popup.log(this.name+" failed",t,e)},t.prototype.authenticate=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:n=Object(l.a)({email:this.username},t),i.label=1;case 1:return i.trys.push([1,9,,11]),[4,this._popup.sendBackgroundMessage(this.runtimeMessageType,n)];case 2:return(e=i.sent())&&0===e.status?[3,4]:[4,this.throwError(m.debug,"response.status is not 0")];case 3:return i.sent(),[3,8];case 4:return this._popup.isActivatedMerchantContext()?[4,this._popup.sendActivationMessage()]:[3,6];case 5:i.sent(),i.label=6;case 6:return[4,this._popup.updateData()];case 7:i.sent(),this._renderer.renderDefaultView(),i.label=8;case 8:return[3,11];case 9:return r=i.sent(),[4,this.throwError(m.error,r)];case 10:return i.sent(),[3,11];case 11:return[2]}}))}))},t.prototype.dismiss=function(){this._renderer.renderDefaultView()},t}(),Le=function(t){return{error:t}},De=function(t){return{position:t}};function Ne(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",1),Object(r.Xb)(1,"span",2),Object(r.cc)(2,"shared-svg",3),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().hide()})),Object(r.bc)(),Object(r.bc)()}if(2&t){var i=Object(r.mc)();Object(r.sc)("ngClass",Object(r.wc)(3,Le,"error"===i.type))("ngStyle",Object(r.wc)(5,De,i.position)),Object(r.Jb)(1),Object(r.sc)("innerHtml",i.message,r.Dc)}}var Ue=function(){function t(){this.position="absolute"}return t.prototype.ngOnInit=function(){},t.prototype.hide=function(){this.message=null},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-alert"]],inputs:{type:"type",message:"message",position:"position"},decls:1,vars:1,consts:[["class","alert",3,"ngClass","ngStyle",4,"ngIf"],[1,"alert",3,"ngClass","ngStyle"],[3,"innerHtml"],["src","assets/redesign/icons/x.svg",3,"click"]],template:function(t,e){1&t&&Object(r.Ic)(0,Ne,3,7,"div",0),2&t&&Object(r.sc)("ngIf",e.message)},directives:[h.t,h.q,h.w,_e],styles:[".alert[_ngcontent-%COMP%]{width:100%;height:67px;position:absolute;top:0;left:0;display:flex;align-items:center;border-radius:4px;background:#fff;color:var(--default)}.alert[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex-grow:1;margin-left:20px;font-size:14px;padding-left:20px}.alert[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{cursor:pointer;width:14px;height:14px;margin-right:20px;fill:var(--default)}.alert.error[_ngcontent-%COMP%]{background:var(--error);color:#fff}.alert.error[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{fill:#fff}"]}),t}(),He=function(t){return{error:t}},Fe=function(){function t(){this.type="text",this.changed=new r.q}return t.prototype.ngOnInit=function(){},t.prototype.onChange=function(t){this.changed.next(t.target.value)},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-form-field"]],inputs:{icon:"icon",type:"type",error:"error",placeholder:"placeholder"},outputs:{changed:"changed"},decls:4,vars:6,consts:[[1,"input",3,"ngClass"],[1,"icon"],[3,"src"],[3,"type","placeholder","change"]],template:function(t,e){1&t&&(Object(r.cc)(0,"div",0),Object(r.cc)(1,"div",1),Object(r.Xb)(2,"img",2),Object(r.bc)(),Object(r.cc)(3,"input",3),Object(r.kc)("change",(function(t){return e.onChange(t)})),Object(r.bc)(),Object(r.bc)()),2&t&&(Object(r.sc)("ngClass",Object(r.wc)(4,He,e.error)),Object(r.Jb)(2),Object(r.sc)("src",e.icon,r.Ec),Object(r.Jb)(1),Object(r.sc)("type",e.type)("placeholder",e.placeholder))},directives:[h.q],styles:["[_ngcontent-%COMP%]:root{--gray:#AAAAAA;--light-gray:#DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#f5f5f5}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}button[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;border-radius:3.5px;cursor:pointer}button.primary[_ngcontent-%COMP%]{background:var(--primary);font-size:14px;padding:15px;border:0}button.primary[_ngcontent-%COMP%]:focus{border:0;outline:0}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);border:solid 1px var(--default-darker);font-size:16px;padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);border:0;color:var(--secondary);cursor:not-allowed}button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:0}.card[_ngcontent-%COMP%]{background:#fff;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}[_nghost-%COMP%]{display:block}.input[_ngcontent-%COMP%]{background:#fff;border:solid 1px var(--light-gray);border-radius:4px;display:flex;max-height:48px}.input[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{border-right:solid 1px var(--light-gray);padding:0 10px;margin-top:12px;margin-bottom:12px}.input[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:25px;height:25px}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex-grow:1;font-size:14px;border:none;outline:0;color:var(--default);margin-left:10px;margin-right:10px}.input.error[_ngcontent-%COMP%]{border-color:var(--error)}"]}),t}();function ze(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"shared-svg",10),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().dismiss()})),Object(r.bc)()}}var We=function(t){function e(e,n,r){var i=t.call(this)||this;return i.popup=e,i.browser=n,i.renderer=r,i}return Object(l.c)(e,t),e.prototype.ngOnInit=function(){this.init(this.AuthType.Login,this.popup,this.renderer,this.browser),this.passwordPlaceholder=this.browser.getLocalizedMessage("popup_auth_password_placeholder")},e.prototype.onPasswordChanged=function(t){this.password=t},e.prototype.submit=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.clear(),this.passwordError=!1,this.validateUsername()?this.password?[3,1]:(this.error=this.browser.getLocalizedMessage("popup_auth_error_pass_blank"),this.passwordError=!0,[3,3]):[3,3];case 1:return[4,this.authenticate({password:this.password})];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e.prototype.forgotPassword=function(){this.popup.openSiteTab(Mt.ForgotPassword)},e.prototype.register=function(){this.renderer.renderContext(Ce.Registration)},e.\u0275fac=function(t){return new(t||e)(Object(r.Wb)(we),Object(r.Wb)(Gt),Object(r.Wb)(pn))},e.\u0275cmp=Object(r.Qb)({type:e,selectors:[["shared-login"]],features:[r.Gb],decls:11,vars:6,consts:[["type","error",3,"message"],["src","assets/redesign/icons/x.svg",3,"click",4,"ngIf"],[3,"ngSubmit"],["l10n","popup_auth_log_in"],["icon","assets/redesign/icons/avatar.svg",3,"error","placeholder","changed"],["icon","assets/redesign/icons/locked.svg","type","password",3,"error","placeholder","changed"],["type","submit","l10n","popup_auth_log_in",1,"primary"],["l10n","popup_auth_forgot_password",1,"forgot",3,"click"],["l10n","popup_auth_no_account"],["l10n","popup_auth_sign_up",3,"click"],["src","assets/redesign/icons/x.svg",3,"click"]],template:function(t,e){1&t&&(Object(r.Xb)(0,"shared-alert",0),Object(r.Ic)(1,ze,1,0,"shared-svg",1),Object(r.cc)(2,"form",2),Object(r.kc)("ngSubmit",(function(){return e.submit()})),Object(r.Xb)(3,"h1",3),Object(r.cc)(4,"shared-form-field",4),Object(r.kc)("changed",(function(t){return e.onUsernameChanged(t)})),Object(r.bc)(),Object(r.cc)(5,"shared-form-field",5),Object(r.kc)("changed",(function(t){return e.onPasswordChanged(t)})),Object(r.bc)(),Object(r.Xb)(6,"button",6),Object(r.cc)(7,"a",7),Object(r.kc)("click",(function(){return e.forgotPassword()})),Object(r.bc)(),Object(r.cc)(8,"div"),Object(r.Xb)(9,"span",8),Object(r.cc)(10,"a",9),Object(r.kc)("click",(function(){return e.register()})),Object(r.bc)(),Object(r.bc)(),Object(r.bc)()),2&t&&(Object(r.sc)("message",e.error),Object(r.Jb)(1),Object(r.sc)("ngIf",e.isDismissible),Object(r.Jb)(3),Object(r.sc)("error",e.usernameError)("placeholder",e.usernamePlaceholder),Object(r.Jb)(1),Object(r.sc)("error",e.passwordError)("placeholder",e.passwordPlaceholder))},directives:[Ue,h.t,o.h,o.e,o.f,Se,Fe,_e],styles:["[_nghost-%COMP%]{display:flex;flex-grow:1;justify-content:center;position:relative}shared-svg[_ngcontent-%COMP%]{position:absolute;right:8px;font-size:20px;cursor:pointer}form[_ngcontent-%COMP%]{margin:75px 20px 20px;flex-grow:1;text-align:center}form[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:400;margin:0 0 15px;color:var(--default-dark);text-align:left}form[_ngcontent-%COMP%]   shared-form-field[_ngcontent-%COMP%]{margin-bottom:15px}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:14px;margin-top:15px}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]::after{content:' '}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:underline}"]}),e}(Ee);function Be(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"shared-svg",9),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().dismiss()})),Object(r.bc)()}}var Je=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.el=e,o.popup=n,o.browser=r,o.renderer=i,o}return Object(l.c)(e,t),e.prototype.ngOnInit=function(){var t=this;this.init(this.AuthType.Registration,this.popup,this.renderer,this.browser),this.heading=this.browser.getSanitizedLocalizedMessage("popup_auth_signup_heading"),setTimeout((function(){t.el.nativeElement.querySelector(".terms").onclick=function(){t.popup.openTerms()},t.el.nativeElement.querySelector(".privacy").onclick=function(){t.popup.openPrivacy()}}))},e.prototype.submit=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.clear(),this.validateUsername()?[4,this.authenticate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.login=function(){this.renderer.renderContext(Ce.Login)},e.\u0275fac=function(t){return new(t||e)(Object(r.Wb)(r.o),Object(r.Wb)(we),Object(r.Wb)(Gt),Object(r.Wb)(pn))},e.\u0275cmp=Object(r.Qb)({type:e,selectors:[["shared-register"]],features:[r.Gb],decls:9,vars:5,consts:[["type","error",3,"message"],["src","assets/redesign/icons/x.svg",3,"click",4,"ngIf"],[3,"ngSubmit"],[1,"heading",3,"innerHtml"],["l10n","popup_auth_signup_subheading"],["icon","assets/redesign/icons/avatar.svg",3,"error","placeholder","changed"],["type","submit","l10n","popup_auth_signup_submit",1,"primary"],["l10n","popup_auth_signup_already_member",1,"login",3,"click"],["l10n","popup_auth_signup_agreement",1,"agreement"],["src","assets/redesign/icons/x.svg",3,"click"]],template:function(t,e){1&t&&(Object(r.Xb)(0,"shared-alert",0),Object(r.Ic)(1,Be,1,0,"shared-svg",1),Object(r.cc)(2,"form",2),Object(r.kc)("ngSubmit",(function(){return e.submit()})),Object(r.Xb)(3,"div",3),Object(r.Xb)(4,"p",4),Object(r.cc)(5,"shared-form-field",5),Object(r.kc)("changed",(function(t){return e.onUsernameChanged(t)})),Object(r.bc)(),Object(r.Xb)(6,"button",6),Object(r.cc)(7,"a",7),Object(r.kc)("click",(function(){return e.login()})),Object(r.bc)(),Object(r.Xb)(8,"div",8),Object(r.bc)()),2&t&&(Object(r.sc)("message",e.error),Object(r.Jb)(1),Object(r.sc)("ngIf",e.isDismissible),Object(r.Jb)(2),Object(r.sc)("innerHtml",e.heading,r.Dc),Object(r.Jb)(2),Object(r.sc)("error",e.usernameError)("placeholder",e.usernamePlaceholder))},directives:[Ue,h.t,o.h,o.e,o.f,Se,Fe,_e],styles:["[_nghost-%COMP%]{display:flex;flex-grow:1;justify-content:center;position:relative;width:100%}shared-svg[_ngcontent-%COMP%]{position:absolute;right:8px;font-size:20px;cursor:pointer}form[_ngcontent-%COMP%]{margin:75px 20px 20px;flex-grow:1;text-align:center}form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:underline}form[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:30px;color:var(--default-dark)}form[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#999;font-size:14px}form[_ngcontent-%COMP%]   shared-form-field[_ngcontent-%COMP%]{margin-bottom:15px}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:100%;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}form[_ngcontent-%COMP%]   .agreement[_ngcontent-%COMP%]{margin-top:20px}form[_ngcontent-%COMP%]   .agreement[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]::after{content:' '}"]}),e}(Ee),qe=function(t){return[t]};function Ge(t,e){if(1&t&&Object(r.Xb)(0,"span",5),2&t){var n=Object(r.mc)();Object(r.sc)("l10n",n.reward.showUpTo?"popup_merchant_currency_per_up_to":"popup_merchant_currency_per")("substitutions",Object(r.wc)(2,qe,n.reward.amount))}}var Ke=function(){function t(t,e,n){this.tabs=t,this.config=e,this.merchants=n}return t.prototype.ngOnInit=function(){this.reward=this.merchantMeta.reward,this.hasPseudoCurrency=this.config.hasPseudoCurrency,this.imageUrl=this.merchants.getMerchantImageUrl(this.merchantMeta.id),this.rewardString=""+this.merchants.constructRewardString(this.config.client,this.merchantMeta.reward)},t.prototype.openTab=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.tabs.constructRedirectUrl(this.merchantMeta,null,I.PopupFeaturedMerchantClick)];case 1:return t=e.sent(),this.tabs.openNewTab(t,!0),[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(ce),Object(r.Wb)(zt),Object(r.Wb)(ie))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-featured-store"]],inputs:{merchantMeta:"merchantMeta"},decls:7,vars:3,consts:[[1,"card"],[1,"logo"],[3,"src","click"],[1,"info",3,"click"],[3,"l10n","substitutions",4,"ngIf"],[3,"l10n","substitutions"]],template:function(t,e){1&t&&(Object(r.cc)(0,"div",0),Object(r.cc)(1,"div",1),Object(r.cc)(2,"img",2),Object(r.kc)("click",(function(){return e.openTab()})),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(3,"div",3),Object(r.kc)("click",(function(){return e.openTab()})),Object(r.cc)(4,"h2"),Object(r.Kc)(5),Object(r.bc)(),Object(r.Ic)(6,Ge,1,4,"span",4),Object(r.bc)(),Object(r.bc)()),2&t&&(Object(r.Jb)(2),Object(r.sc)("src",e.imageUrl,r.Ec),Object(r.Jb)(3),Object(r.Lc)(e.rewardString),Object(r.Jb)(1),Object(r.sc)("ngIf",e.hasPseudoCurrency))},directives:[h.t,Se],styles:[".card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:129px;height:64px;display:flex;justify-content:center}.card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:pointer;-ms-grid-row-align:center;align-self:center}.card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;margin-left:20px;justify-content:center;cursor:pointer;text-transform:capitalize}.card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:18px}.card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--primary);font-size:14px;font-weight:700;margin:0}.card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--default-darker)}"]}),t}();function Xe(t,e){if(1&t&&Object(r.Xb)(0,"shared-featured-store",4),2&t){var n=e.$implicit;Object(r.sc)("merchantMeta",n)}}var Ve=function(){function t(t){this.popup=t,this.merchantsMeta=[]}return t.prototype.ngOnInit=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this,[4,this.popup.sendBackgroundMessage(v.getFeaturedMerchants)];case 1:return t.merchantsMeta=e.sent(),[2]}}))}))},t.prototype.viewAll=function(){this.popup.openSiteTab(Mt.Stores)},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(we))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-featured-stores"]],decls:4,vars:1,consts:[[1,"title"],["l10n","popup_featured_stores"],["l10n","popup_featured_stores_view_all",3,"click"],[3,"merchantMeta",4,"ngFor","ngForOf"],[3,"merchantMeta"]],template:function(t,e){1&t&&(Object(r.cc)(0,"div",0),Object(r.Xb)(1,"h1",1),Object(r.cc)(2,"a",2),Object(r.kc)("click",(function(){return e.viewAll()})),Object(r.bc)(),Object(r.bc)(),Object(r.Ic)(3,Xe,1,1,"shared-featured-store",3)),2&t&&(Object(r.Jb)(3),Object(r.sc)("ngForOf",e.merchantsMeta))},directives:[Se,h.s,Ke],styles:["[_nghost-%COMP%]{flex-grow:1}.title[_ngcontent-%COMP%]{overflow:auto;margin-bottom:10px}.title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:400;font-size:14px;margin:0;color:var(--default-darker);float:left}.title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary);float:right}"]}),t}(),Qe=function(){function t(){}return t.toggleFade=function(t,e){e.style.opacity="0",setTimeout((function(){t.style.opacity="1",setTimeout((function(){t.style.opacity="0",setTimeout((function(){e.style.opacity="1"}),500)}),2e3)}),500)},t}(),Ye=["code"],Ze=["copied"];function $e(t,e){1&t&&(Object(r.cc)(0,"div",16),Object(r.Xb)(1,"div",17),Object(r.Xb)(2,"img",18),Object(r.bc)())}function tn(t,e){if(1&t&&(Object(r.cc)(0,"div",19),Object(r.Xb)(1,"span",20),Object(r.Kc)(2),Object(r.bc)()),2&t){var n=Object(r.mc)();Object(r.Jb)(2),Object(r.Mc)(" ",n.expirationDate()," ")}}var en=function(t){return{code:!0,right:t}},nn=function(){function t(t){this.browser=t,this.clicked=new r.q}return t.prototype.ngOnInit=function(){},t.prototype.onClick=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){return Y.copyTextToClipboard(this.coupon.code),this.peeled||this.clicked.next(),Qe.toggleFade(this.copied.nativeElement,this.code.nativeElement),[2]}))}))},t.prototype.discountValue=function(){return this.coupon.discountValue&&this.coupon.discountLabel?this.coupon.discountValue:""+this.browser.getLocalizedMessage("popup_merchant_coupon_callout_default_discount_value")},t.prototype.discountLabel=function(){return this.coupon.discountValue&&this.coupon.discountLabel?this.coupon.discountLabel:""+this.browser.getLocalizedMessage("popup_merchant_coupon_callout_default_discount_label")},t.prototype.expirationDate=function(){try{var t=Date.parse(this.coupon.expires);return new Intl.DateTimeFormat([],{dateStyle:"short"}).format(t)}catch(e){return""}},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(Gt))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-coupon"]],viewQuery:function(t,e){var n;1&t&&(Object(r.Oc)(Ye,!0,r.o),Object(r.Oc)(Ze,!0,r.o)),2&t&&(Object(r.zc)(n=Object(r.lc)())&&(e.code=n.first),Object(r.zc)(n=Object(r.lc)())&&(e.copied=n.first))},inputs:{peeled:"peeled",coupon:"coupon"},outputs:{clicked:"clicked"},decls:20,vars:9,consts:[[1,"coupon","card"],[1,"callout"],[1,"discount"],[1,"value"],[1,"label"],["l10n","popup_merchant_coupon_callout_discount_tagline",1,"tagline"],[1,"info"],[1,"description"],[1,"button",3,"click"],[1,"text"],[3,"ngClass"],["code",""],["l10n","copied",1,"copied"],["copied",""],["class","peel",4,"ngIf"],["class","expiration",4,"ngIf"],[1,"peel"],["l10n","popup_merchant_coupon_get_code"],["src","assets/redesign/images/coupon-peel.png"],[1,"expiration"],["l10n","popup_merchant_coupon_expiration_abbreviation"]],template:function(t,e){1&t&&(Object(r.cc)(0,"div",0),Object(r.cc)(1,"div",1),Object(r.cc)(2,"div",2),Object(r.cc)(3,"span",3),Object(r.Kc)(4),Object(r.bc)(),Object(r.cc)(5,"span",4),Object(r.Kc)(6),Object(r.bc)(),Object(r.bc)(),Object(r.Xb)(7,"div",5),Object(r.bc)(),Object(r.cc)(8,"div",6),Object(r.cc)(9,"span",7),Object(r.Kc)(10),Object(r.bc)(),Object(r.cc)(11,"div",8),Object(r.kc)("click",(function(){return e.onClick()})),Object(r.cc)(12,"div",9),Object(r.cc)(13,"span",10,11),Object(r.Kc)(15),Object(r.bc)(),Object(r.Xb)(16,"span",12,13),Object(r.bc)(),Object(r.Ic)(18,$e,3,0,"div",14),Object(r.bc)(),Object(r.Ic)(19,tn,3,1,"div",15),Object(r.bc)(),Object(r.bc)()),2&t&&(Object(r.Jb)(4),Object(r.Lc)(e.discountValue()),Object(r.Jb)(2),Object(r.Lc)(e.discountLabel()),Object(r.Jb)(4),Object(r.Lc)(e.coupon.description),Object(r.Jb)(3),Object(r.sc)("ngClass",Object(r.wc)(7,en,!e.peeled)),Object(r.Jb)(2),Object(r.Lc)(e.coupon.code),Object(r.Jb)(3),Object(r.sc)("ngIf",!e.peeled),Object(r.Jb)(1),Object(r.sc)("ngIf",e.coupon.expires))},directives:[Se,h.q,h.t],styles:[".coupon[_ngcontent-%COMP%]{display:flex}.coupon.card[_ngcontent-%COMP%]{padding:8px}.coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:110px;height:110px;border:1px solid var(--primary-light);border-radius:8px;margin-right:16px;text-transform:uppercase;flex-shrink:0}.coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]{color:var(--primary);font-size:24px;line-height:30px;font-weight:800;display:flex;flex-wrap:wrap;flex-basis:100%;align-content:center;align-items:center;text-align:center}.coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%], .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{flex-basis:100%}.coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .tagline[_ngcontent-%COMP%]{background-color:var(--primary-light);color:#fff;font-size:12px;font-weight:600;line-height:24px;text-align:center;border-radius:0 0 8px 8px}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{flex-grow:1}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:14px}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{display:flex;height:46px;position:relative;margin-top:10px;margin-bottom:6px;cursor:pointer}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:16px;line-height:24px;font-weight:700;align-items:center;justify-content:center;display:flex;box-shadow:0 3.36667px 10.1px rgba(136,136,136,.2)}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:var(--tertiary-light);border:1px solid var(--tertiary);border-radius:20px;font-weight:700;height:40px;width:100%;position:relative}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;transition:opacity 1s}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   span.right[_ngcontent-%COMP%]{right:10px}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .copied[_ngcontent-%COMP%]{opacity:0;text-transform:uppercase}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]{position:absolute;top:0;left:0;display:flex;flex-direction:row;width:100%}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;background:var(--primary-light);border:1px solid var(--primary-light);border-radius:50px;color:var(--primary);height:40px;width:calc(100% - 30px)}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:-4px}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .expiration[_ngcontent-%COMP%]{color:var(--text-inactivated);font-size:10px;font-weight:600}"]}),t}(),rn=function(t){return[t]};function on(t,e){if(1&t&&(Object(r.cc)(0,"div"),Object(r.Xb)(1,"b",9),Object(r.bc)()),2&t){var n=Object(r.mc)(2);Object(r.Jb)(1),Object(r.sc)("l10n",n.reward.showUpTo?"popup_merchant_earn_currency_per_up_to":"popup_merchant_earn_currency_per")("substitutions",Object(r.wc)(2,rn,n.reward.amount))}}function sn(t,e){1&t&&Object(r.Xb)(0,"div",10)}function cn(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",5),Object(r.cc)(1,"button",6),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().activate()})),Object(r.Kc)(2),Object(r.bc)(),Object(r.Ic)(3,on,2,4,"div",7),Object(r.Ic)(4,sn,1,0,"div",8),Object(r.bc)()}if(2&t){var i=Object(r.mc)();Object(r.Jb)(1),Object(r.sc)("disabled",i.member&&i.activated),Object(r.Jb)(1),Object(r.Lc)(i.getReward()),Object(r.Jb)(1),Object(r.sc)("ngIf",i.member&&i.hasPseudoCurrency&&!i.reward.isFlat),Object(r.Jb)(1),Object(r.sc)("ngIf",!i.member)}}function an(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"shared-coupon",14),Object(r.kc)("clicked",(function(){return Object(r.Cc)(n),Object(r.mc)(2).onCouponClicked()})),Object(r.bc)()}if(2&t){var i=e.$implicit,o=Object(r.mc)(2);Object(r.sc)("coupon",i)("peeled",o.activated)}}function un(t,e){if(1&t&&(Object(r.cc)(0,"div",11),Object(r.Xb)(1,"div",12),Object(r.Ic)(2,an,1,2,"shared-coupon",13),Object(r.bc)()),2&t){var n=Object(r.mc)();Object(r.Jb)(1),Object(r.sc)("l10n",1===n.coupons.length?"popup_merchant_coupon_count":"popup_merchant_coupon_count_plural")("substitutions",n.coupons.length.toString()),Object(r.Jb)(1),Object(r.sc)("ngForOf",n.coupons)}}function hn(t,e){1&t&&(Object(r.cc)(0,"div",15),Object(r.Xb)(1,"div",16),Object(r.Xb)(2,"img",17),Object(r.bc)())}var ln=function(){function t(t,e,n,r,i){this.popup=t,this.config=e,this.browser=n,this.renderer=r,this.merchants=i,this.coupons=[]}return Object.defineProperty(t.prototype,"merchant",{get:function(){return this.popup.data.merchant},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"member",{get:function(){return this.popup.member},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.reward=this.merchant.reward,this.coupons=this.merchant.coupons,this.hasPseudoCurrency=this.config.hasPseudoCurrency,this.imageUrl=this.merchants.getMerchantImageUrl(this.merchant.id),this.name=this.merchant.name,this.updateActivationState()},t.prototype.updateActivationState=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){return this.popup.isActivatedMerchantContext()&&(this.activated=!0,this.peeled=!0),[2]}))}))},t.prototype.getReward=function(){var t=this.merchants.constructRewardString(this.config.client,this.merchant.reward);return this.activated&&this.member?t+" "+this.browser.getLocalizedMessage("activated"):this.browser.getLocalizedMessage("get")+" "+t},t.prototype.activate=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.popup.isActivatedMerchantContext()?[3,3]:[4,this.popup.sendActivationMessage()];case 1:return t.sent(),[4,this.updateActivationState()];case 2:t.sent(),t.label=3;case 3:return this.popup.member||this.renderer.renderContext(Ce.Registration),[2]}}))}))},t.prototype.onCouponClicked=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.activated?[3,2]:[4,this.activate()];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(we),Object(r.Wb)(zt),Object(r.Wb)(Gt),Object(r.Wb)(pn),Object(r.Wb)(ie))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-merchant"]],decls:6,vars:5,consts:[[1,"merchant","card"],[3,"src","alt"],["class","info",4,"ngIf"],["class","coupons",4,"ngIf","ngIfElse"],["noCoupons",""],[1,"info"],[1,"secondary",3,"disabled","click"],[4,"ngIf"],["class","nonmember","l10n","popup_merchant_nonmember_offer",4,"ngIf"],[3,"l10n","substitutions"],["l10n","popup_merchant_nonmember_offer",1,"nonmember"],[1,"coupons"],[1,"coupon-count",3,"l10n","substitutions"],[3,"coupon","peeled","clicked",4,"ngFor","ngForOf"],[3,"coupon","peeled","clicked"],[1,"no-coupons"],["l10n","popup_merchant_no_coupons"],["src","assets/redesign/images/no-coupons.png"]],template:function(t,e){if(1&t&&(Object(r.cc)(0,"div",0),Object(r.Xb)(1,"img",1),Object(r.Ic)(2,cn,5,4,"div",2),Object(r.bc)(),Object(r.Ic)(3,un,3,3,"div",3),Object(r.Ic)(4,hn,3,0,"ng-template",null,4,r.Jc)),2&t){var n=Object(r.Ac)(5);Object(r.Jb)(1),Object(r.sc)("src",e.imageUrl,r.Ec)("alt",e.name),Object(r.Jb)(1),Object(r.sc)("ngIf",e.reward.amount),Object(r.Jb)(1),Object(r.sc)("ngIf",e.coupons.length)("ngIfElse",n)}},directives:[h.t,Se,h.s,nn],styles:["[_nghost-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.merchant[_ngcontent-%COMP%]{border-radius:5px;padding:10px;margin-bottom:10px;justify-content:center}.merchant.card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:120px}.merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-grow:1;flex-direction:column;justify-content:center;margin-left:10px;font-size:14px}.merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px}.merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]::before{content:' '}.merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .nonmember[_ngcontent-%COMP%]{font-size:12px;font-weight:600;text-align:center}.coupons[_ngcontent-%COMP%]{padding-bottom:10px}.coupons[_ngcontent-%COMP%]   .coupon-count[_ngcontent-%COMP%]{font-size:14px}.no-coupons[_ngcontent-%COMP%]{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;background:var(--primary-light);flex-grow:1}.no-coupons[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-align:center;font-size:14px;line-height:18px;margin-bottom:16px}"]}),t}(),dn=(new Map).set(Ce.Login,We).set(Ce.Answer,Te).set(Ce.Merchant,ln).set(Ce.Registration,Je).set(Ce.FeaturedStores,Ve),pn=function(){function t(t){this.popup=t,this._onRenderBody=new b.b,this.onRenderBody=this._onRenderBody.asObservable(),this._onRenderPromoCodes=new b.b,this.onRenderPromoCodes=this._onRenderPromoCodes.asObservable()}return Object.defineProperty(t.prototype,"shouldShowHeaderControls",{get:function(){return this.popup.member&&![Ce.Login,Ce.Registration].includes(this.context)},enumerable:!0,configurable:!0}),t.prototype.renderContext=function(t){this.context=t;var e=dn.get(t);this._onRenderBody.next(e)},t.prototype.renderBrandComponent=function(t){this.context=null,this._onRenderBody.next(t)},t.prototype.renderDefaultView=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return this.popup.isMerchantContext?(this.renderShop(),[3,4]):[3,1];case 1:return this.popup.member?[4,this.popup.getDefaultView()]:[3,3];case 2:return t.sent()===_.SHOP?this.renderShop():this.renderContext(Ce.Answer),[3,4];case 3:this.renderContext(Ce.Registration),t.label=4;case 4:return[2]}}))}))},t.prototype.renderShop=function(){this.renderContext(this.popup.data.merchant?Ce.Merchant:Ce.FeaturedStores)},t.prototype.renderPromoCodes=function(){this._onRenderPromoCodes.next()},t.\u0275fac=function(e){return new(e||t)(Object(r.gc)(we))},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),bn=function(){function t(){this._onShow=new b.b,this.onShow=this._onShow.asObservable(),this._onClose=new b.b,this.onClose=this._onClose.asObservable()}return t.prototype.show=function(t,e){this._onShow.next({content:t,targetBounds:e})},t.prototype.close=function(){this._onClose.next()},t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),fn=["arrow"],gn=["content"],vn=["contentContainer"];function mn(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",3),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().close()})),Object(r.bc)()}}function On(t,e){1&t&&Object(r.Xb)(0,"div",4,5)}function jn(t,e){1&t&&(Object(r.cc)(0,"div",6,7),Object(r.Yb)(2,null,8),Object(r.bc)())}var yn=function(){function t(t,e,n){this.dom=t,this.svc=e,this.changeDetector=n,this.MARGIN=8}return t.prototype.ngOnInit=function(){var t=this;this.svc.onShow.subscribe((function(e){t.visible=!0,t.changeDetector.detectChanges(),setTimeout((function(){var n=e.targetBounds,r=n.x+n.width/2,i=t.positionArrow(n,r);t.content.createEmbeddedView(e.content),t.positionContent(r,i),t.arrow.nativeElement.style.visibility="visible",t.contentContainer.nativeElement.style.visibility="visible"}))})),this.svc.onClose.subscribe((function(){t.close()}))},t.prototype.positionArrow=function(t,e){var n=this.arrow.nativeElement.getBoundingClientRect();return this.arrow.nativeElement.style.left=e-n.width/2+"px",this.arrow.nativeElement.style.top=t.y+t.height+this.MARGIN+"px",this.arrow.nativeElement.getBoundingClientRect()},t.prototype.positionContent=function(t,e){var n=this.contentContainer.nativeElement.getBoundingClientRect(),r=t-n.width/2,i=this.dom.body.getBoundingClientRect();r<0?r=this.MARGIN:r+n.width>i.width&&(r=i.width-n.width-this.MARGIN),this.contentContainer.nativeElement.style.left=r+"px",this.contentContainer.nativeElement.style.top=e.y+(e.height-1)+"px"},t.prototype.close=function(){this.arrow.nativeElement.style.visibility="hidden",this.contentContainer.nativeElement.style.visibility="hidden",this.visible=!1},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(h.e),Object(r.Wb)(bn),Object(r.Wb)(r.h))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-popover"]],viewQuery:function(t,e){var n;1&t&&(Object(r.Oc)(fn,!0,r.o),Object(r.Oc)(gn,!0,r.W),Object(r.Oc)(vn,!0,r.o)),2&t&&(Object(r.zc)(n=Object(r.lc)())&&(e.arrow=n.first),Object(r.zc)(n=Object(r.lc)())&&(e.content=n.first),Object(r.zc)(n=Object(r.lc)())&&(e.contentContainer=n.first))},decls:3,vars:3,consts:[["class","overlay",3,"click",4,"ngIf"],["class","arrow",4,"ngIf"],["class","content",4,"ngIf"],[1,"overlay",3,"click"],[1,"arrow"],["arrow",""],[1,"content"],["contentContainer",""],["content",""]],template:function(t,e){1&t&&(Object(r.Ic)(0,mn,1,0,"div",0),Object(r.Ic)(1,On,2,0,"div",1),Object(r.Ic)(2,jn,4,0,"div",2)),2&t&&(Object(r.sc)("ngIf",e.visible),Object(r.Jb)(1),Object(r.sc)("ngIf",e.visible),Object(r.Jb)(1),Object(r.sc)("ngIf",e.visible))},directives:[h.t],styles:["[_nghost-%COMP%]{position:absolute;top:0;left:0}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:10px solid #dadada;position:absolute;z-index:999999;visibility:hidden}.arrow[_ngcontent-%COMP%]::after{content:'';position:absolute;top:1.5px;left:-8.5px;width:0;height:0;border-left:9px solid transparent;border-right:9px solid transparent;border-bottom:9px solid #fff}.content[_ngcontent-%COMP%]{position:absolute;background:#fff;border:1px solid #dadada;border-radius:4px;visibility:hidden}"]}),t}(),Sn=function(){function t(t,e){this.svc=t,this.el=e}return t.prototype.ngOnInit=function(){var t=this;this.el.nativeElement.addEventListener("click",(function(){t.onClick()}))},t.prototype.onClick=function(){this.svc.show(this.popover,this.el.nativeElement.getBoundingClientRect())},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(bn),Object(r.Wb)(r.o))},t.\u0275dir=Object(r.Rb)({type:t,selectors:[["","popover",""]],inputs:{popover:"popover"}}),t}();function wn(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"a",10),Object(r.kc)("click",(function(){Object(r.Cc)(n);var t=e.$implicit;return Object(r.mc)().openSiteTab(t.key)})),Object(r.bc)()}if(2&t){var i=e.$implicit;Object(r.sc)("l10n",i.value)}}var Cn=function(){function t(t,e,n,r){this.popup=t,this.config=e,this.popover=n,this.renderer=r}return t.prototype.ngOnInit=function(){var t=this.popup.data.member;this.menu=this.popup.accountPopoverMenu,this.name=t.fName||t.uName,this.lifetimeEarned=this.config.formatAccountBalance(t.lifetimeEarnings),this.extensionName=this.config.extensionName},t.prototype.openSiteTab=function(t){this.popup.openSiteTab(t)},t.prototype.renderLogin=function(){this.renderer.renderContext(Ce.Login),this.popover.close()},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(we),Object(r.Wb)(zt),Object(r.Wb)(bn),Object(r.Wb)(pn))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-account-popover"]],decls:14,vars:5,consts:[[1,"account-popover"],[1,"top"],[1,"greeting"],["l10n","popup_account_popover_greeting",3,"substitutions"],["l10n","popup_account_popover_not_you",3,"click"],[1,"earnings-logout"],[1,"earnings"],["l10n","popup_account_popover_lifetime_earned"],[1,"bottom"],[3,"l10n","click",4,"ngFor","ngForOf"],[3,"l10n","click"]],template:function(t,e){1&t&&(Object(r.cc)(0,"div",0),Object(r.cc)(1,"div",1),Object(r.cc)(2,"div",2),Object(r.Xb)(3,"span",3),Object(r.cc)(4,"a",4),Object(r.kc)("click",(function(){return e.renderLogin()})),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(5,"div",5),Object(r.cc)(6,"div",6),Object(r.Xb)(7,"span",7),Object(r.Xb)(8,"br"),Object(r.cc)(9,"b"),Object(r.Kc)(10),Object(r.bc)(),Object(r.bc)(),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(11,"div",8),Object(r.Ic)(12,wn,1,1,"a",9),Object(r.nc)(13,"keyvalue"),Object(r.bc)(),Object(r.bc)()),2&t&&(Object(r.Jb)(3),Object(r.sc)("substitutions",e.name),Object(r.Jb)(7),Object(r.Lc)(e.lifetimeEarned),Object(r.Jb)(2),Object(r.sc)("ngForOf",Object(r.oc)(13,3,e.menu)))},directives:[Se,h.s],pipes:[h.l],styles:["[_ngcontent-%COMP%]:root{--gray:#AAAAAA;--light-gray:#DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#f5f5f5}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}button[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;border-radius:3.5px;cursor:pointer}button.primary[_ngcontent-%COMP%]{background:var(--primary);font-size:14px;padding:15px;border:0}button.primary[_ngcontent-%COMP%]:focus{border:0;outline:0}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);border:solid 1px var(--default-darker);font-size:16px;padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);border:0;color:var(--secondary);cursor:not-allowed}button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:0}.card[_ngcontent-%COMP%]{background:#fff;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}.account-popover[_ngcontent-%COMP%]{width:225px;font-size:14px}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{border-bottom:solid 1px var(--light-gray);display:flex;flex-direction:column;padding:10px}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .greeting[_ngcontent-%COMP%]{overflow:auto}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .greeting[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#000;float:left}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .greeting[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:right;color:var(--primary);margin-top:16px}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .earnings-logout[_ngcontent-%COMP%]{display:flex;margin-top:5px}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .earnings-logout[_ngcontent-%COMP%]   .earnings[_ngcontent-%COMP%]{color:var(--primary)}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .earnings-logout[_ngcontent-%COMP%]   .earnings[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.account-popover[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{padding-bottom:15px}.account-popover[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-top:15px;margin-left:10px;color:var(--primary);display:block;max-width:125px}"]}),t}();function _n(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",6),Object(r.cc)(1,"div",7),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().openAccountStatement()})),Object(r.Xb)(2,"span",8),Object(r.cc)(3,"span",9),Object(r.Kc)(4),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(5,"a",10),Object(r.Xb)(6,"img",11),Object(r.bc)(),Object(r.cc)(7,"a",12),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().settings()})),Object(r.Xb)(8,"img",13),Object(r.bc)(),Object(r.bc)()}if(2&t){var i=Object(r.mc)(),o=Object(r.Ac)(5);Object(r.Jb)(4),Object(r.Lc)(i.balance),Object(r.Jb)(1),Object(r.sc)("popover",o)}}function xn(t,e){1&t&&Object(r.Xb)(0,"shared-account-popover")}function Mn(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"button",14),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().renderLogin()})),Object(r.bc)()}}var Pn=function(){function t(t,e,n,r){this.tabs=t,this.popup=e,this.config=n,this.renderer=r}return t.prototype.ngOnInit=function(){var t=this;this.init(),this.renderer.onRenderBody.subscribe((function(){t.init()}))},t.prototype.init=function(){var t=this.popup.member;t&&(this.balance=this.config.formatAccountBalance(t.balance),this.shouldShowControls=this.renderer.shouldShowHeaderControls)},t.prototype.openSite=function(){this.tabs.openSiteTab()},t.prototype.renderLogin=function(){this.renderer.renderContext(Ce.Login)},t.prototype.settings=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.popup.sendBackgroundMessage(v.openSettings)];case 1:return t.sent(),[2]}}))}))},t.prototype.openAccountStatement=function(){this.popup.openSiteTab(Mt.Ledger)},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(ce),Object(r.Wb)(we),Object(r.Wb)(zt),Object(r.Wb)(pn))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-account-info"]],decls:8,vars:2,consts:[[1,"header"],[1,"logo",3,"click"],["src","assets/redesign/images/logo.svg"],["class","right",4,"ngIf","ngIfElse"],["account",""],["login",""],[1,"right"],[1,"balance",3,"click"],["l10n","popup_member_balance"],[1,"amount"],[1,"icon",3,"popover"],["src","assets/redesign/icons/account.svg"],[1,"icon",3,"click"],["src","assets/redesign/icons/settings.svg"],["l10n","popup_auth_log_in",1,"right",3,"click"]],template:function(t,e){if(1&t&&(Object(r.cc)(0,"div",0),Object(r.cc)(1,"a",1),Object(r.kc)("click",(function(){return e.openSite()})),Object(r.Xb)(2,"img",2),Object(r.bc)(),Object(r.Ic)(3,_n,9,2,"div",3),Object(r.bc)(),Object(r.Ic)(4,xn,1,0,"ng-template",null,4,r.Jc),Object(r.Ic)(6,Mn,1,0,"ng-template",null,5,r.Jc)),2&t){var n=Object(r.Ac)(7);Object(r.Jb)(3),Object(r.sc)("ngIf",e.shouldShowControls)("ngIfElse",n)}},directives:[h.t,Se,Sn,Cn],styles:[".header[_ngcontent-%COMP%]{padding:4px 0 4px 7px;display:flex}.header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{margin:5px}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:row;justify-content:flex-end}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]{text-align:right;padding-right:11px;padding-top:5px;margin-right:20px;cursor:pointer}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:12px}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]   span.amount[_ngcontent-%COMP%]{font-size:14px;font-weight:700}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;margin-right:20px}.header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{-ms-grid-row-align:center;align-self:center;display:block!important;position:absolute;right:16px;background-color:#fff;color:var(--primary);border-radius:50px;border:1px solid var(--primary);font-size:14px;list-style:outside;font-weight:700;text-align:center;min-width:130px;height:32px;cursor:pointer}"]}),t}(),In=function(t){return{selected:t}};function kn(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",2),Object(r.kc)("click",(function(){Object(r.Cc)(n);var t=e.index;return Object(r.mc)().onClick(t)})),Object(r.cc)(1,"span"),Object(r.Kc)(2),Object(r.bc)(),Object(r.Xb)(3,"shared-svg",3),Object(r.bc)()}if(2&t){var i=e.$implicit,o=e.index,s=Object(r.mc)();Object(r.sc)("ngClass",Object(r.wc)(2,In,s.selectedIndex===o)),Object(r.Jb)(2),Object(r.Lc)(i)}}var An=function(){function t(){this.items=[],this.select=new r.q}return t.prototype.ngOnInit=function(){},t.prototype.onClick=function(t){this.selectedIndex=t,this.select.emit(t)},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-select-list"]],inputs:{items:"items",selectedIndex:"selectedIndex"},outputs:{select:"select"},decls:2,vars:1,consts:[[1,"list"],["class","item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"item",3,"ngClass","click"],["src","assets/redesign/icons/check.svg"]],template:function(t,e){1&t&&(Object(r.cc)(0,"div",0),Object(r.Ic)(1,kn,4,4,"div",1),Object(r.bc)()),2&t&&(Object(r.Jb)(1),Object(r.sc)("ngForOf",e.items))},directives:[h.s,h.q,_e],styles:[".list[_ngcontent-%COMP%]{width:130px}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;padding:10px;cursor:pointer}.list[_ngcontent-%COMP%]   .item.selected[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--primary)}.list[_ngcontent-%COMP%]   .item.selected[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{display:block}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:hover{background:#ebf5f8}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{color:#757575}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;flex-grow:1}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{display:none}"]}),t}();function Rn(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",2),Object(r.cc)(1,"div",3),Object(r.cc)(2,"div",4),Object(r.cc)(3,"span"),Object(r.Kc)(4),Object(r.bc)(),Object(r.Xb)(5,"img",5),Object(r.bc)(),Object(r.cc)(6,"form",6),Object(r.kc)("ngSubmit",(function(){return Object(r.Cc)(n),Object(r.mc)().search()})),Object(r.cc)(7,"input",7),Object(r.kc)("ngModelChange",(function(t){return Object(r.Cc)(n),Object(r.mc)().query=t})),Object(r.bc)(),Object(r.cc)(8,"a",8),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().search()})),Object(r.Xb)(9,"img",9),Object(r.bc)(),Object(r.bc)(),Object(r.bc)(),Object(r.bc)()}if(2&t){var i=Object(r.mc)(),o=Object(r.Ac)(2);Object(r.Jb)(2),Object(r.sc)("popover",o),Object(r.Jb)(2),Object(r.Lc)(i.popoverItems[i.selectedPopoverIndex]),Object(r.Jb)(3),Object(r.sc)("ngModel",i.query)("placeholder",i.placeholder)}}function Tn(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"shared-select-list",10),Object(r.kc)("select",(function(t){return Object(r.Cc)(n),Object(r.mc)().onPopoverSelect(t)})),Object(r.bc)()}if(2&t){var i=Object(r.mc)();Object(r.sc)("items",i.popoverItems)("selectedIndex",i.selectedPopoverIndex)}}var En=function(){function t(t,e){this.popup=t,this.browser=e,this.browserMap=(new Map).set("firefox",101).set("edge",102).set("safari",104).set("chrome",105),this.popoverItems=[],this.selectedPopoverIndex=1}return Object.defineProperty(t.prototype,"placeholder",{get:function(){return this.browser.getLocalizedMessage("popup_search_placeholder_"+(0===this.selectedPopoverIndex?"web":"shop"))},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.visible=this.popup.isFlagEnabled(_.UX_POPUP_SEARCH),this.popoverItems=[this.browser.getLocalizedMessage("popup_search_web"),this.browser.getLocalizedMessage("popup_nav_shop")]},t.prototype.search=function(){if(this.query)if(0===this.selectedPopoverIndex){var t=this.browserMap.get(this.browser.name);this.popup.openSiteTab(Mt.WebSearch,[t,this.query])}else this.popup.openSiteTab(Mt.ShopSearch,[this.query])},t.prototype.onPopoverSelect=function(t){this.selectedPopoverIndex=t},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(we),Object(r.Wb)(Gt))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-search"]],decls:3,vars:1,consts:[["class","search-container",4,"ngIf"],["popover",""],[1,"search-container"],[1,"search"],[1,"popover",3,"popover"],["src","assets/redesign/icons/search-chevron-down.svg"],[3,"ngSubmit"],["name","query",3,"ngModel","placeholder","ngModelChange"],[3,"click"],["src","assets/redesign/icons/search.svg"],[3,"items","selectedIndex","select"]],template:function(t,e){1&t&&(Object(r.Ic)(0,Rn,10,4,"div",0),Object(r.Ic)(1,Tn,1,2,"ng-template",null,1,r.Jc)),2&t&&Object(r.sc)("ngIf",e.visible)},directives:[h.t,Sn,o.h,o.e,o.f,o.b,o.d,o.g,An],styles:["[_ngcontent-%COMP%]:root{--gray:#AAAAAA;--light-gray:#DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#f5f5f5}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}button[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;border-radius:3.5px;cursor:pointer}button.primary[_ngcontent-%COMP%]{background:var(--primary);font-size:14px;padding:15px;border:0}button.primary[_ngcontent-%COMP%]:focus{border:0;outline:0}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);border:solid 1px var(--default-darker);font-size:16px;padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);border:0;color:var(--secondary);cursor:not-allowed}button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:0}.card[_ngcontent-%COMP%]{background:#fff;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}.search-container[_ngcontent-%COMP%]{padding:10px;background:#fff}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--light-gray);border-radius:4px;display:flex;cursor:pointer}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .popover[_ngcontent-%COMP%]{display:flex;border-right:solid 1px var(--light-gray);padding-left:10px;padding-right:10px}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .popover[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-transform:uppercase;margin-right:5px;display:flex;align-items:center}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-grow:1}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px;margin:0;background:0 0;border:none;outline:0;display:flex;flex-grow:1}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::-moz-placeholder{color:var(--light-gray);font-weight:400}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:-ms-input-placeholder{color:var(--light-gray);font-weight:400}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--light-gray);font-weight:400}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;margin-right:10px}"]}),t}();function Ln(t,e){if(1&t&&(Object(r.cc)(0,"div",4),Object(r.Kc)(1),Object(r.bc)()),2&t){var n=Object(r.mc)();Object(r.Jb)(1),Object(r.Lc)(n.count)}}var Dn=function(t){return{selected:t}},Nn=function(){function t(){}return t.prototype.ngOnInit=function(){},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-nav-item"]],inputs:{icon:"icon",count:"count",message:"message",selected:"selected"},decls:4,vars:6,consts:[[1,"nav-item",3,"ngClass"],[3,"src"],[3,"l10n"],["class","count",4,"ngIf"],[1,"count"]],template:function(t,e){1&t&&(Object(r.cc)(0,"div",0),Object(r.Xb)(1,"shared-svg",1),Object(r.Xb)(2,"span",2),Object(r.Ic)(3,Ln,2,1,"div",3),Object(r.bc)()),2&t&&(Object(r.sc)("ngClass",Object(r.wc)(4,Dn,e.selected)),Object(r.Jb)(1),Object(r.sc)("src",e.icon),Object(r.Jb)(1),Object(r.sc)("l10n",e.message),Object(r.Jb)(1),Object(r.sc)("ngIf",e.count))},directives:[h.q,_e,Se,h.t],styles:[".nav-item{display:flex;height:34px;align-items:stretch;border-bottom:6px solid #fff;padding-left:20px;padding-right:20px;cursor:pointer;position:relative}.nav-item.selected svg,.nav-item:hover svg{fill:var(--primary)}.nav-item.selected span,.nav-item:hover span{color:var(--primary)}.nav-item.selected{border-bottom:solid 6px var(--primary)}.nav-item shared-svg{display:flex;align-items:center}.nav-item shared-svg svg{height:16px;width:auto;margin-right:6px;fill:var(--default)}.nav-item span{display:flex;align-items:center;font-weight:700}.nav-item .count{background:var(--error);color:#fff;border-radius:10px;position:absolute;top:3px;right:2px;font-size:12px;font-weight:700;text-align:center;padding:2px 4px}"],encapsulation:2}),t}();function Un(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"shared-nav-item",3),Object(r.kc)("click",(function(){Object(r.Cc)(n);var t=e.$implicit;return Object(r.mc)(2).navigate(t.flag)})),Object(r.bc)()}if(2&t){var i=e.$implicit,o=Object(r.mc)(2);Object(r.sc)("icon",i.icon)("count",i.count)("message",i.message)("selected",i.flag===o.selected)}}function Hn(t,e){if(1&t&&(Object(r.cc)(0,"div",1),Object(r.Ic)(1,Un,1,4,"shared-nav-item",2),Object(r.bc)()),2&t){var n=Object(r.mc)();Object(r.Jb)(1),Object(r.sc)("ngForOf",n.items)}}var Fn=function(){function t(t,e){this.popup=t,this.renderer=e,this.items=[]}return t.prototype.ngOnInit=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n=this;return Object(l.d)(this,(function(r){switch(r.label){case 0:return(t=function(t){return n.popup.isFlagEnabled(t)})(_.SHOP)&&this.items.push({flag:_.SHOP,icon:"assets/redesign/icons/shop.svg",message:"popup_nav_shop"}),t(_.ANSWER)&&this.items.push({flag:_.ANSWER,icon:"assets/redesign/icons/answer.svg",count:this.popup.data.notifications.length,message:"popup_nav_answer"}),t(_.MKT_PROMO_CODES)&&this.items.push({flag:_.MKT_PROMO_CODES,icon:"assets/redesign/icons/promos.svg",message:"popup_nav_promos"}),e=this,[4,this.popup.getDefaultView()];case 1:return e.selected=r.sent(),[2]}}))}))},t.prototype.navigate=function(t){switch(this.selected=t,t){case _.SHOP:this.renderer.renderShop();break;case _.ANSWER:this.renderer.renderContext(Ce.Answer);break;case _.MKT_PROMO_CODES:this.renderer.renderPromoCodes()}},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(we),Object(r.Wb)(pn))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-nav"]],decls:1,vars:1,consts:[["class","nav",4,"ngIf"],[1,"nav"],[3,"icon","count","message","selected","click",4,"ngFor","ngForOf"],[3,"icon","count","message","selected","click"]],template:function(t,e){1&t&&Object(r.Ic)(0,Hn,2,1,"div",0),2&t&&Object(r.sc)("ngIf",e.items.length>1)},directives:[h.t,h.s,Nn],styles:["[_ngcontent-%COMP%]:root{--gray:#AAAAAA;--light-gray:#DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#f5f5f5}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}button[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;border-radius:3.5px;cursor:pointer}button.primary[_ngcontent-%COMP%]{background:var(--primary);font-size:14px;padding:15px;border:0}button.primary[_ngcontent-%COMP%]:focus{border:0;outline:0}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);border:solid 1px var(--default-darker);font-size:16px;padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);border:0;color:var(--secondary);cursor:not-allowed}button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:0}.card[_ngcontent-%COMP%]{background:#fff;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}.nav[_ngcontent-%COMP%]{border-top:1px solid var(--light-gray);border-bottom:1px solid var(--light-gray);display:flex;justify-content:space-evenly;background:#fff}"]}),t}();function zn(t,e){1&t&&Object(r.Xb)(0,"shared-search")}function Wn(t,e){1&t&&Object(r.Xb)(0,"shared-nav")}var Bn=function(){function t(t){this.renderer=t}return t.prototype.ngOnInit=function(){var t=this;this.renderer.onRenderBody.subscribe((function(){t.shouldShowControls=t.renderer.shouldShowHeaderControls}))},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(pn))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-header"]],decls:3,vars:2,consts:[[4,"ngIf"]],template:function(t,e){1&t&&(Object(r.Xb)(0,"shared-account-info"),Object(r.Ic)(1,zn,1,0,"shared-search",0),Object(r.Ic)(2,Wn,1,0,"shared-nav",0)),2&t&&(Object(r.Jb)(1),Object(r.sc)("ngIf",e.shouldShowControls),Object(r.Jb)(1),Object(r.sc)("ngIf",e.shouldShowControls))},directives:[Pn,h.t,En,Fn],styles:[""]}),t}(),Jn=["body"];function qn(t,e){1&t&&(Object(r.cc)(0,"div",1),Object(r.Xb)(1,"shared-header"),Object(r.cc)(2,"div",2),Object(r.Yb)(3,null,3),Object(r.bc)(),Object(r.bc)())}var Gn=function(){function t(t,e,n,r){this.popup=t,this.renderer=e,this.changeDetector=n,this.factoryResolver=r}return t.prototype.ngOnInit=function(){return Object(l.b)(this,void 0,void 0,(function(){var t=this;return Object(l.d)(this,(function(e){switch(e.label){case 0:return this.subscribeOnRenderBody(),this.popup.onInitialized.subscribe((function(){t.initialized=!0,t.changeDetector.detectChanges(),t.renderer.renderDefaultView()})),[4,this.popup.init()];case 1:return e.sent(),[2]}}))}))},t.prototype.subscribeOnRenderBody=function(){var t=this;this.renderer.onRenderBody.subscribe((function(e){t.body.clear();var n=t.factoryResolver.resolveComponentFactory(e);t.body.createComponent(n)}))},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(we),Object(r.Wb)(pn),Object(r.Wb)(r.h),Object(r.Wb)(r.k))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["popup-base"]],viewQuery:function(t,e){var n;1&t&&Object(r.Oc)(Jn,!0,r.W),2&t&&Object(r.zc)(n=Object(r.lc)())&&(e.body=n.first)},decls:2,vars:1,consts:[["class","popup",4,"ngIf"],[1,"popup"],[1,"body"],["body",""]],template:function(t,e){1&t&&(Object(r.Ic)(0,qn,5,0,"div",0),Object(r.Xb)(1,"shared-popover")),2&t&&Object(r.sc)("ngIf",e.initialized)},directives:[h.t,yn,Bn],styles:[":root{--gray:#AAAAAA;--light-gray:#DADADA}.popup{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#f5f5f5}.popup .body{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a{color:var(--primary);cursor:pointer}button,input{font-family:var(--font)}button.primary,button.secondary{color:#fff;font-weight:700;border-radius:3.5px;cursor:pointer}button.primary{background:var(--primary);font-size:14px;padding:15px;border:0}button.primary:focus{border:0;outline:0}button.secondary{background:var(--secondary);border:solid 1px var(--default-darker);font-size:16px;padding:10px}button.secondary:disabled{background:var(--secondary-light);border:0;color:var(--secondary);cursor:not-allowed}button.secondary:focus{border:0;outline:0}.card{background:#fff;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}"],encapsulation:2}),t}(),Kn=function(t){return{on:t}},Xn=function(){function t(){this.change=new r.q}return t.prototype.ngOnInit=function(){},t.prototype.toggle=function(){this.on=!this.on,this.change.next(this.on)},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-switch"]],inputs:{on:"on"},outputs:{change:"change"},decls:3,vars:3,consts:[[1,"switch",3,"ngClass","click"],[1,"track"],[1,"indicator"]],template:function(t,e){1&t&&(Object(r.cc)(0,"div",0),Object(r.kc)("click",(function(){return e.toggle()})),Object(r.Xb)(1,"div",1),Object(r.Xb)(2,"div",2),Object(r.bc)()),2&t&&Object(r.sc)("ngClass",Object(r.wc)(1,Kn,e.on))},directives:[h.q],styles:["[_ngcontent-%COMP%]:root{--gray:#AAAAAA;--light-gray:#DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#f5f5f5}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}button[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;border-radius:3.5px;cursor:pointer}button.primary[_ngcontent-%COMP%]{background:var(--primary);font-size:14px;padding:15px;border:0}button.primary[_ngcontent-%COMP%]:focus{border:0;outline:0}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);border:solid 1px var(--default-darker);font-size:16px;padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);border:0;color:var(--secondary);cursor:not-allowed}button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:0}.card[_ngcontent-%COMP%]{background:#fff;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}.switch[_ngcontent-%COMP%]{height:20px;width:40px;position:relative;display:flex;align-items:center;cursor:pointer}.switch[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{background-color:var(--light-gray);width:40px;height:12px;border-radius:8px;transition:background-color 250ms}.switch[_ngcontent-%COMP%]   .indicator[_ngcontent-%COMP%]{position:absolute;top:0;left:0;background:#fff;width:20px;height:20px;border-radius:10px;box-shadow:0 1px 2px rgba(0,0,0,.24);transition:left 250ms}.switch.on[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{background-color:var(--active)}.switch.on[_ngcontent-%COMP%]   .indicator[_ngcontent-%COMP%]{left:calc(100% - 20px)}"]}),t}(),Vn=["bottom"];function Qn(t,e){1&t&&Object(r.Xb)(0,"div",15)}function Yn(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",16),Object(r.Xb)(1,"span",17),Object(r.cc)(2,"shared-switch",18),Object(r.kc)("change",(function(){Object(r.Cc)(n);var t=Object(r.mc)();return t.onPrefChanged(t.MemberPreference.surveyAlertOptOut)})),Object(r.bc)(),Object(r.cc)(3,"a",19),Object(r.Xb)(4,"img",20),Object(r.bc)(),Object(r.bc)()}if(2&t){var i=Object(r.mc)(),o=Object(r.Ac)(18);Object(r.Jb)(2),Object(r.sc)("on",i.surveyAlerts),Object(r.Jb)(1),Object(r.sc)("popover",o)}}var Zn=function(t){return{selected:t}};function $n(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",25),Object(r.kc)("click",(function(){Object(r.Cc)(n);var t=e.$implicit;return Object(r.mc)(2).setDefaultView(t.flag)})),Object(r.Kc)(1),Object(r.bc)()}if(2&t){var i=e.$implicit,o=Object(r.mc)(2);Object(r.sc)("ngClass",Object(r.wc)(2,Zn,o.defaultView===i.flag)),Object(r.Jb)(1),Object(r.Lc)(i.text)}}function tr(t,e){if(1&t&&(Object(r.cc)(0,"div",21),Object(r.Xb)(1,"span",22),Object(r.cc)(2,"div",23),Object(r.Ic)(3,$n,2,4,"div",24),Object(r.bc)(),Object(r.bc)()),2&t){var n=Object(r.mc)();Object(r.Jb)(3),Object(r.sc)("ngForOf",n.views)}}function er(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",16),Object(r.Xb)(1,"span",26),Object(r.cc)(2,"shared-switch",18),Object(r.kc)("change",(function(){Object(r.Cc)(n);var t=Object(r.mc)();return t.onPrefChanged(t.MemberPreference.dataCollectionOptOut)})),Object(r.bc)(),Object(r.cc)(3,"a",19),Object(r.Xb)(4,"img",20),Object(r.bc)(),Object(r.bc)()}if(2&t){var i=Object(r.mc)(),o=Object(r.Ac)(20);Object(r.Jb)(2),Object(r.sc)("on",i.allowDataCollection),Object(r.Jb)(1),Object(r.sc)("popover",o)}}function nr(t,e){if(1&t){var n=Object(r.dc)();Object(r.ac)(0),Object(r.cc)(1,"div",16),Object(r.cc)(2,"a",27),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().collectionNotice()})),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(3,"div",16),Object(r.cc)(4,"a",28),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().financialNotice()})),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(5,"div",16),Object(r.cc)(6,"a",29),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().accessibility()})),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(7,"div",16),Object(r.cc)(8,"a",30),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().doNotSell()})),Object(r.bc)(),Object(r.bc)(),Object(r.Zb)()}}function rr(t,e){1&t&&Object(r.Xb)(0,"div",31)}function ir(t,e){1&t&&Object(r.Xb)(0,"div",32)}var or=function(){function t(t,e,n){this.tabs=t,this.popup=e,this.browser=n,this.MemberPreference=X,this.ccpaCountryCodes=[Pt.US,Pt.CA],this.views=[],this.defaultView=_.SHOP,this.shouldShowDataCollection=!1}return t.prototype.ngOnInit=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e=this;return Object(l.d)(this,(function(n){switch(n.label){case 0:return this.popup.onInitialized.subscribe((function(){e.onInitialized()})),[4,this.popup.init()];case 1:return n.sent(),document.title=this.browser.getLocalizedMessage("popup_settings_title"),this.brand=window.__brandCode,this.settingTextHide=this.browser.getSanitizedLocalizedMessage("popup_settings_hide"),this.settingTextByUsing=this.browser.getSanitizedLocalizedMessage("popup_settings_by_using"),this.views=[{flag:_.SHOP,text:this.browser.getLocalizedMessage("popup_nav_shop")},{flag:_.ANSWER,text:this.browser.getLocalizedMessage("popup_nav_answer")}],t=this,[4,this.popup.getDefaultView()];case 2:return t.defaultView=n.sent(),this.bottom.nativeElement.querySelector(".terms").onclick=function(){e.popup.openTerms()},this.bottom.nativeElement.querySelector(".privacy").onclick=function(){e.popup.openPrivacy()},[2]}}))}))},t.prototype.getPref=function(t){return(this.prefs&t)==t},t.prototype.onInitialized=function(){var t=this,e=this.popup.data,n=function(e){return t.popup.isFlagEnabled(e)};this.prefs=e.member.preferences,this.isAnswer=n(_.ANSWER),this.surveyAlerts=!this.getPref(X.surveyAlertOptOut),this.shouldShowCCPA=this.ccpaCountryCodes.includes(e.member.location),this.allowDataCollection=!this.getPref(X.dataCollectionOptOut),this.shouldShowDefaultView=n(_.ANSWER)&&n(_.SHOP),this.shouldShowDataCollection=n(_.DATA_INSIGHTS)},t.prototype.close=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.popup.sendBackgroundMessage(v.closeSettings)];case 1:return t.sent(),[2]}}))}))},t.prototype.onPrefChanged=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.popup.sendBackgroundMessage(v.updateMemberPrefs,t)];case 1:return e.sent(),this.prefs^=t,[2]}}))}))},t.prototype.setDefaultView=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return this.defaultView=t,[4,this.popup.sendBackgroundMessage(v.setStorageItem,{key:this.popup.DEFAULT_POPUP_VIEW_KEY,value:t})];case 1:return e.sent(),[2]}}))}))},t.prototype.collectionNotice=function(){this.tabs.openProdegeTab("collection-notice")},t.prototype.financialNotice=function(){this.tabs.openProdegeTab("financial-incentives-notice")},t.prototype.accessibility=function(){this.tabs.openProdegeTab("accessibility-statement")},t.prototype.doNotSell=function(){this.tabs.openProdegeTab("do-not-sell")},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(ce),Object(r.Wb)(we),Object(r.Wb)(Gt))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["shared-settings"]],viewQuery:function(t,e){var n;1&t&&Object(r.Oc)(Vn,!0),2&t&&Object(r.zc)(n=Object(r.lc)())&&(e.bottom=n.first)},decls:22,vars:9,consts:[[1,"head"],["src","assets/redesign/images/logo-large.png"],[1,"close",3,"click"],["l10n","close"],["src","assets/redesign/icons/x.svg"],[1,"options"],["class","title","l10n","popup_settings",4,"ngIf"],["class","option",4,"ngIf"],["class","option bottom",4,"ngIf"],["l10n","popup_privacy",1,"title"],[4,"ngIf"],[1,"bottom",3,"innerHTML"],["bottom",""],["surveyAlertsInfo",""],["dataCollectionInfo",""],["l10n","popup_settings",1,"title"],[1,"option"],["l10n","popup_settings_survey_alerts"],[3,"on","change"],[3,"popover"],["src","assets/redesign/icons/info.svg"],[1,"option","bottom"],["l10n","popup_settings_default_view"],[1,"pill-select"],["class","pill",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"pill",3,"ngClass","click"],["l10n","popup_settings_allow_data_collection"],["l10n","popup_settings_collection_notice",3,"click"],["l10n","popup_settings_financial_notice",3,"click"],["l10n","popup_settings_accessibility",3,"click"],["l10n","popup_settings_do_not_sell",3,"click"],["l10n","popup_settings_survey_alerts_info",1,"info"],["l10n","popup_settings_allow_data_collection_info",1,"info"]],template:function(t,e){1&t&&(Object(r.cc)(0,"div"),Object(r.cc)(1,"div",0),Object(r.Xb)(2,"img",1),Object(r.cc)(3,"div",2),Object(r.kc)("click",(function(){return e.close()})),Object(r.Xb)(4,"span",3),Object(r.Xb)(5,"shared-svg",4),Object(r.bc)(),Object(r.bc)(),Object(r.cc)(6,"div",5),Object(r.Ic)(7,Qn,1,0,"div",6),Object(r.cc)(8,"section"),Object(r.Ic)(9,Yn,5,2,"div",7),Object(r.Ic)(10,tr,4,1,"div",8),Object(r.bc)(),Object(r.Xb)(11,"div",9),Object(r.cc)(12,"section"),Object(r.Ic)(13,er,5,2,"div",7),Object(r.Ic)(14,nr,9,0,"ng-container",10),Object(r.bc)(),Object(r.Xb)(15,"section",11,12),Object(r.bc)(),Object(r.bc)(),Object(r.Ic)(17,rr,1,0,"ng-template",null,13,r.Jc),Object(r.Ic)(19,ir,1,0,"ng-template",null,14,r.Jc),Object(r.Xb)(21,"shared-popover")),2&t&&(Object(r.Mb)("settings ",e.brand,""),Object(r.Jb)(7),Object(r.sc)("ngIf",e.isAnswer||e.shouldShowDefaultView),Object(r.Jb)(2),Object(r.sc)("ngIf",e.isAnswer),Object(r.Jb)(1),Object(r.sc)("ngIf",e.shouldShowDefaultView),Object(r.Jb)(3),Object(r.sc)("ngIf",e.shouldShowDataCollection),Object(r.Jb)(1),Object(r.sc)("ngIf",e.shouldShowCCPA),Object(r.Jb)(1),Object(r.sc)("innerHTML",e.settingTextByUsing,r.Dc))},directives:[Se,_e,h.t,yn,Xn,Sn,h.s,h.q],styles:[":root{--gray:#AAAAAA;--light-gray:#DADADA}.popup{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#f5f5f5}.popup .body{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a{color:var(--primary);color:var(--primary);text-decoration:underline;cursor:pointer}button,input{font-family:var(--font)}button.primary,button.secondary{color:#fff;font-weight:700;border-radius:3.5px;cursor:pointer}button.primary{background:var(--primary);font-size:14px;padding:15px;border:0}button.primary:focus{border:0;outline:0}button.secondary{background:var(--secondary);border:solid 1px var(--default-darker);font-size:16px;padding:10px}button.secondary:disabled{background:var(--secondary-light);border:0;color:var(--secondary);cursor:not-allowed}button.secondary:focus{border:0;outline:0}.card{background:#fff;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}.settings{font-family:var(--font);font-size:14px;height:100vh;background:#f1f1f1;color:var(--default)}.settings .head{padding:15px;background:#fff;border-bottom:solid 1px var(--light-gray);text-align:center;position:relative}.settings .head .close{float:right;padding:15px;display:flex;position:absolute;height:calc(100% - 30px);right:0;top:0;margin-right:35px;cursor:pointer}.settings .head .close span{display:flex;align-items:center;font-weight:700;color:var(--gray)}.settings .head .close shared-svg{margin-left:15px;fill:var(--gray);display:flex;align-items:center}.settings .options{margin-top:20px;margin-left:auto;margin-right:auto;background:#fff;border:solid 1px var(--gray);box-shadow:3px 4px 4px rgba(0,0,0,.05);width:450px;padding-bottom:30px}.settings .options .title{border-bottom:solid 1px var(--gray);padding:30px 30px 10px;font-weight:700;margin-bottom:20px}.settings .options section{padding-left:30px;padding-right:30px}.settings .options section .option{display:flex}.settings .options section .option:not(:last-child){margin-bottom:10px}.settings .options section .option span{flex-grow:1;display:flex;align-items:center}.settings .options section .option span.setting-hide a{margin-left:5px}.settings .options section .option shared-switch{margin-right:30px}.settings .options section .option .pill-select{display:inline;padding:3px;border-radius:35px;background:#f1f1f1;display:flex}.settings .options section .option .pill-select .pill{padding:5px 20px;background:#fff;border-radius:35px;font-weight:700;cursor:pointer}.settings .options section .option .pill-select .pill.selected{background:var(--active-dark);color:#fff}.settings .options section .option .pill-select .pill:not(:last-child){margin-right:3px}.settings .options .bottom{margin-top:20px}.info{padding:20px;width:150px}"],encapsulation:2}),t}(),sr=function(){function t(){}return t.\u0275mod=Object(r.Ub)({type:t}),t.\u0275inj=Object(r.Tb)({factory:function(e){return new(e||t)},imports:[[h.c,o.c]]}),t}(),cr=["alertElement"],ar=["copiedElement"];function ur(t,e){if(1&t){var n=Object(r.dc)();Object(r.cc)(0,"div",8),Object(r.kc)("click",(function(){return Object(r.Cc)(n),Object(r.mc)().alertClicked()})),Object(r.Xb)(1,"p",9,10),Object(r.Xb)(3,"p",11,12),Object(r.cc)(5,"a"),Object(r.Kc)(6),Object(r.bc)(),Object(r.bc)()}if(2&t){var i=Object(r.mc)();Object(r.Jb)(6),Object(r.Lc)(i.alert)}}function hr(t,e){if(1&t&&Object(r.Xb)(0,"p",13),2&t){var n=Object(r.mc)();Object(r.sc)("innerHtml",n.collectText,r.Dc)}}var lr=function(){function t(t,e,n,r){this.el=t,this.api=e,this.tabs=n,this.browser=r}return t.prototype.ngOnInit=function(){var t=this;this.placeholder=this.browser.getLocalizedMessage("popup_swag_enter_placeholder"),this.collectText=this.browser.getSanitizedLocalizedMessage("popup_swag_collect"),setTimeout((function(){t.el.nativeElement.querySelector(".collect a").onclick=function(){t.collect()}}))},t.prototype.alertClicked=function(){this.url?this.tabs.openNewTab(this.url,!0):(Y.copyTextToClipboard(this.alert),Qe.toggleFade(this.copiedElement.nativeElement,this.alertElement.nativeElement))},t.prototype.redeem=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return this.error=null,this.code?[3,1]:(this.error=this.browser.getLocalizedMessage("popup_swag_enter_blank"),[3,6]);case 1:t=null,i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.api.redeemPromoCode(this.code)];case 3:return t=i.sent(),[3,5];case 4:return i.sent(),this.error=this.browser.getLocalizedMessage("popup_error_generic"),[3,5];case 5:t&&("string"==typeof t&&"0"===t[0]?this.error=this.browser.getLocalizedMessage("popup_error_generic"):(e=t[0],n=t[1].toString(),r=t[2],"1"===(n.indexOf("&")?n.substring(0,n.indexOf("&")):n)?e&&(e=e.trim()).length>0?(e=e.replace("@sb@",r),this.congratsText=e):this.congratsText=this.browser.getLocalizedMessage("popup_swag_congrats",r):this.error=e)),i.label=6;case 6:return[2]}}))}))},t.prototype.collect=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return this.error=null,[4,this.api.checkPromoCode()];case 1:return(t=i.sent())&&0===t.status&&t.data&&t.data.promoCode&&t.data.promoCode.id>-1&&t.data.promoCode.url&&t.data.promoCode.message?(n=(e=t.data.promoCode).message).includes("~")?(r=n.split("~"),this.alert=r[0],this.url=r[1]):(this.alert=n,this.url=e.url):this.error=this.browser.getSanitizedLocalizedMessage("popup_swag_no_code"),[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(r.o),Object(r.Wb)(Yt),Object(r.Wb)(ce),Object(r.Wb)(Gt))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["sb-swag-code"]],viewQuery:function(t,e){var n;1&t&&(Object(r.Oc)(cr,!0),Object(r.Oc)(ar,!0)),2&t&&(Object(r.zc)(n=Object(r.lc)())&&(e.alertElement=n.first),Object(r.zc)(n=Object(r.lc)())&&(e.copiedElement=n.first))},decls:8,vars:6,consts:[["type","error","position","relative",3,"message"],["position","relative",3,"message"],["class","card",3,"click",4,"ngIf"],[3,"ngSubmit"],["l10n","popup_swag_enter"],["name","code",3,"ngModel","placeholder","ngModelChange"],["l10n","popup_swag_redeem",1,"primary"],["class","collect",3,"innerHtml",4,"ngIf"],[1,"card",3,"click"],["l10n","copied",1,"copied"],["copiedElement",""],["l10n","popup_swag_alert"],["alertElement",""],[1,"collect",3,"innerHtml"]],template:function(t,e){1&t&&(Object(r.Xb)(0,"shared-alert",0),Object(r.Xb)(1,"shared-alert",1),Object(r.Ic)(2,ur,7,1,"div",2),Object(r.cc)(3,"form",3),Object(r.kc)("ngSubmit",(function(){return e.redeem()})),Object(r.Xb)(4,"span",4),Object(r.cc)(5,"input",5),Object(r.kc)("ngModelChange",(function(t){return e.code=t})),Object(r.bc)(),Object(r.Xb)(6,"button",6),Object(r.bc)(),Object(r.Ic)(7,hr,1,1,"p",7)),2&t&&(Object(r.sc)("message",e.error),Object(r.Jb)(1),Object(r.sc)("message",e.congratsText),Object(r.Jb)(1),Object(r.sc)("ngIf",e.alert),Object(r.Jb)(3),Object(r.sc)("ngModel",e.code)("placeholder",e.placeholder),Object(r.Jb)(2),Object(r.sc)("ngIf",!e.alert))},directives:[Ue,h.t,o.h,o.e,o.f,Se,o.b,o.d,o.g],styles:["[_nghost-%COMP%]{color:var(--default-dark);display:flex;flex-direction:column;flex-grow:1;position:relative;font-size:14px}.card[_ngcontent-%COMP%]{text-align:center;flex-direction:column;padding:15px 30px;border:solid 1px var(--light-gray);position:relative;cursor:pointer;margin-bottom:15px}.card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--primary);font-size:16px;text-transform:uppercase;margin:0 0 10px;font-weight:700;transition:opacity 1s}.card[_ngcontent-%COMP%]   p.copied[_ngcontent-%COMP%]{opacity:0;position:absolute;width:calc(100% - 60px)}.card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;padding:15px;border:dashed 1px var(--primary);background:var(--primary-light);color:var(--primary-dark);font-weight:700}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:15px}form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:14px;padding:15px;border:solid 1px var(--light-gray);border-radius:4px;outline:0;margin-top:10px;margin-bottom:15px}.collect[_ngcontent-%COMP%]{text-align:center}"]}),t}(),dr=function(){function t(t,e,n){this.tabs=t,this.popup=e,this.renderer=n,this.ACCOUNT_POPOVER_MENU=(new Map).set(Mt.AccountSummary,"popup_account_popover_my_account").set(Mt.RewardsStore,"popup_account_popover_redeem").set(Mt.Ledger,"popup_account_popover_my_activity").set(Mt.Referrals,"popup_account_popover_refer_a_friend").set(Mt.Tutorial,"popup_account_popover_how_does_it_work")}return t.prototype.ngOnInit=function(){var t=this;this.popup.onOpenSiteTab.subscribe((function(e){t.openSiteTab(e.location,e.args)})),this.popup.onOpenHowItWorks.subscribe((function(){return Object(l.b)(t,void 0,void 0,(function(){return Object(l.d)(this,(function(t){switch(t.label){case 0:return[4,this.popup.sendBackgroundMessage(v.showTutorial)];case 1:return t.sent(),[2]}}))}))})),this.renderer.onRenderPromoCodes.subscribe((function(){t.renderer.renderBrandComponent(lr)})),this.popup.setAccountPopoverMenu(this.ACCOUNT_POPOVER_MENU)},t.prototype.openSiteTab=function(t,e){var n=null;switch(t){case Mt.WebSearch:n="?t=w&p=1&f="+e[0]+"&q="+e[1];break;case Mt.ShopSearch:n="shop/search?shq="+e[0];case Mt.Stores:n="shop/allstores/?view=list&amp;utm_source=SwagButton&amp;utm_medium=directlink&amp;utm_campaign=view_all_stores";break;case Mt.AccountSummary:n="account/summary";break;case Mt.RewardsStore:n="rewards-store";break;case Mt.Ledger:n="account/shop-ledger";break;case Mt.Referrals:n="account/referrals";break;case Mt.ForgotPassword:n="p/login";break;case Mt.Tutorial:this.popup.openHowItWorks();break;case Mt.Answer:n="surveys"}this.tabs.openSiteTab(n)},t.\u0275fac=function(e){return new(e||t)(Object(r.Wb)(ce),Object(r.Wb)(we),Object(r.Wb)(pn))},t.\u0275cmp=Object(r.Qb)({type:t,selectors:[["brand-popup"]],decls:1,vars:0,consts:[[1,"sb"]],template:function(t,e){1&t&&Object(r.Xb)(0,"popup-base",0)},directives:[Gn],styles:[""],encapsulation:2}),t}(),pr=function(){function t(){}return t.\u0275mod=Object(r.Ub)({type:t}),t.\u0275inj=Object(r.Tb)({factory:function(e){return new(e||t)},imports:[[sr,h.c,o.c]]}),t}(),br=function(){function t(){}return t.prototype.preInit=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){return[2]}))}))},t.prototype.postInit=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){return[2]}))}))},t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Object(r.Sb)({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),fr=function(){function t(t,e,n,r,i,o,s,c,a,u,h,l,d,p,b,f,g,v,m,O){this.browserEvents=t,this.tabSvc=e,this.browser=n,this.alarmSvc=r,this.configSvc=i,this.memberSvc=o,this.storageSvc=s,this.merchantSvc=c,this.messagingSvc=a,this.lifecycleEventsSvc=u,this.contentInjectionSvc=h,this.affiliateNetworkSvc=l,this.surveyLogSvc=d,this.peerLogging=p,this.notifications=b,this.browserAction=f,this.siteMapSvc=g,this.cookies=v,this.brand=m,this.dataInsightsSvc=O}return t.prototype.ngOnInit=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r,i=this;return Object(l.d)(this,(function(o){switch(o.label){case 0:return t="UNKNOWN_BRAND_AND_VERSION",this.browser&&this.browser.api?t=this.browser.api.runtime.getManifest().version:chrome&&chrome.runtime&&(t=chrome.runtime.getManifest().version),At.a.install({token:"a77f9aa3cfae4bc59cd1f05c818671ab",application:window.__trackJsApplication,version:this.configSvc.brand+t}),[4,this.brand.preInit()];case 1:return o.sent(),this.browserEvents.init(),this.storageSvc.init(),this.contentInjectionSvc.init(),this.notifications.init(),this.cookies.init(),this.messagingSvc.init(),this.merchantSvc.init(),this.affiliateNetworkSvc.init(),this.memberSvc.init(),this.tabSvc.init(),this.cookies.init(),this.surveyLogSvc.init(),this.siteMapSvc.init(),this.dataInsightsSvc.init(),this.configSvc.init(),this.alarmSvc.init(),this.lifecycleEventsSvc.init(),this.peerLogging.init(),[4,this.brand.postInit()];case 2:return o.sent(),this.tabSvc.tabNavComplete.subscribe((function(t){return Object(l.b)(i,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.tabSvc.checkTabExists(t.tabId)];case 1:return e.sent()&&this.browserAction.setIconWithActivationState(this.configSvc.client,t.tabId,t&&t.merchantState?t.merchantState.activationState:null,t.shouldAnimateIcon),[2]}}))}))})),[4,this.storageSvc.extId.get()];case 3:return e=o.sent(),[4,this.storageSvc.member.get()];case 4:return n=o.sent(),At.a.configure({sessionId:null==e?"NO_EXT_ID":String(e),userId:null==n?"NO_MEMBER_ID":String(n.id)}),[4,this.storageSvc.flags.get()];case 5:return r=o.sent(),this.configSvc.configure(r),[2]}}))}))},t.prototype.ngOnDestroy=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:t=this.tabSvc.getAllTabStates(),e=0,i.label=1;case 1:return e<t.length?(n=t[e]).merchantState&&(r=n.merchantState.session)?[4,this.tabSvc.postMerchantSessionLog(r)]:[3,3]:[3,4];case 2:i.sent(),i.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(r.Wb(Vt),r.Wb(ce),r.Wb(Gt),r.Wb(Zt),r.Wb(zt),r.Wb(se),r.Wb(Qt),r.Wb(ie),r.Wb(ge),r.Wb(ne),r.Wb(ue),r.Wb(re),r.Wb(ve),r.Wb(ye),r.Wb(he),r.Wb(me),r.Wb(le),r.Wb(ee),r.Wb(br),r.Wb(fe))},t.\u0275cmp=r.Qb({type:t,selectors:[["background"]],decls:0,vars:0,template:function(t,e){},styles:[""]}),t}(),gr=function(){function t(t){this.messaging=t}return t.prototype.ngOnInit=function(){var t=new P(v.executeCallback);this.messaging.sendBackgroundMessage(t)},t.\u0275fac=function(e){return new(e||t)(r.Wb(ge))},t.\u0275cmp=r.Qb({type:t,selectors:[["app-popup"]],decls:1,vars:0,template:function(t,e){1&t&&r.Xb(0,"brand-popup")},directives:[dr],styles:["div[_ngcontent-%COMP%]{padding:10px}.error[_ngcontent-%COMP%]{color:#8b0000}"]}),t}(),vr=function(){function t(t){this.messagingSvc=t,this.className="",this.memberName="",this.member2Name="",this.paramsArray="",this.cmd="",this.allMembers=[],this.options={},this.results={},this.logs={},this.error={}}return t.prototype.ngOnInit=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return t=new P(v.getAllReflects),e=this,[4,this.messagingSvc.sendBackgroundMessage(t)];case 1:return e.allMembers=n.sent(),this.paramsArray="[]",[2]}}))}))},t.prototype.onClickSubmit=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=new P(v.executeReflect,{class:this.className,member:this.memberName,member2:this.member2Name,params:this.paramsArray?JSON.parse(this.paramsArray):""}),[4,this.messagingSvc.sendBackgroundMessage(t)];case 1:return"string"==typeof(e=r.sent()).results&&0===e.results.indexOf("Call Failed!")?this.error=e.results:(this.results=e.results,this.error={}),this.logs=e.logs,[3,3];case 2:return n=r.sent(),this.error=n.stack,[3,3];case 3:return[2]}}))}))},t.prototype.onClickCmdSubmit=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r;return Object(l.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=new P(v.executeReflectCmd,{cmd:this.truncateCmd(t.cmd)}),[4,this.messagingSvc.sendBackgroundMessage(e)];case 1:return"string"==typeof(n=i.sent()).results&&0===n.results.indexOf("Call Failed!")?this.error=n.results:(this.results=n.results,this.error={}),this.logs=n.logs,[3,3];case 2:return r=i.sent(),this.error=r.stack,[3,3];case 3:return[2]}}))}))},t.prototype.truncateCmd=function(t){try{var e=t.replace(/\n/gu,"");return e.substring(e.lastIndexOf(";")+1)}catch(n){return null}},t.prototype.onEvent=function(t){if(t.node&&!t.node.isRoot&&t.node.parent&&t.node.parent.data){var e=t.node.data.name.includes(": f()");this.className=t.node.parent.data.name;var n=t.node.data.name;this.memberName=e?n.substring(0,n.indexOf(": f()")):n,this.paramsArray=e?"[]":"",this.cmd+=";\n"+this.className+"."+this.memberName+(e?"()":"")}},t.\u0275fac=function(e){return new(e||t)(r.Wb(ge))},t.\u0275cmp=r.Qb({type:t,selectors:[["app-reflect"]],viewQuery:function(t,e){var n;1&t&&r.Oc(c.a,!0),2&t&&r.zc(n=r.lc())&&(e.tree=n.first)},decls:52,vars:18,consts:[["id","reflect"],["id","reflect-all-members"],["id","reflect-all-members-list","hidden",""],[3,"nodes","activate"],["id","reflect-main"],["id","reflect-form-container"],["id","reflect-form",3,"ngSubmit"],["typeCallingInfo","ngForm"],["id","class-name-input","type","text","name","class","placeholder","class","autofocus","",3,"ngModel","ngModelChange"],["id","member-name-input","type","text","name","member","placeholder","member",3,"ngModel","ngModelChange"],["id","member2-name-input","type","text","name","member2","placeholder","member2",3,"ngModel","ngModelChange"],["id","params-array-input","name","params","placeholder","params",3,"ngModel","ngModelChange"],["id","form-submit","type","submit","value","submit"],["id","reflect-cmd-form",3,"ngSubmit"],["id","cmd-input","type","text","name","cmd","placeholder","cmd","autofocus","",3,"ngModel","ngModelChange"],["id","cmd-form-submit","type","submit","value","submit"],["id","reflect-info"],["id","reflect-return"],["id","return-results"],["id","reflect-logs"],["id","log-results"],["id","reflect-error"],["id","error-results"]],template:function(t,e){if(1&t){var n=r.dc();r.cc(0,"div",0),r.cc(1,"div",1),r.cc(2,"p",2),r.Kc(3),r.nc(4,"json"),r.bc(),r.cc(5,"h1"),r.Kc(6,"All members available:"),r.bc(),r.cc(7,"tree-root",3),r.kc("activate",(function(t){return e.onEvent(t)})),r.bc(),r.bc(),r.cc(8,"div",4),r.cc(9,"div",5),r.cc(10,"form",6,7),r.kc("ngSubmit",(function(){return e.onClickSubmit()})),r.Kc(12," Class Name: "),r.cc(13,"input",8),r.kc("ngModelChange",(function(t){return e.className=t})),r.bc(),r.Xb(14,"br"),r.Kc(15," Member Name: "),r.cc(16,"input",9),r.kc("ngModelChange",(function(t){return e.memberName=t})),r.bc(),r.Xb(17,"br"),r.Kc(18," Member2 Name: "),r.cc(19,"input",10),r.kc("ngModelChange",(function(t){return e.member2Name=t})),r.bc(),r.Xb(20,"br"),r.Kc(21," Parameters (array): "),r.cc(22,"textarea",11),r.kc("ngModelChange",(function(t){return e.paramsArray=t})),r.bc(),r.Xb(23,"br"),r.Xb(24,"br"),r.Xb(25,"input",12),r.bc(),r.cc(26,"form",13,7),r.kc("ngSubmit",(function(){r.Cc(n);var t=r.Ac(11);return e.onClickCmdSubmit(t.value)})),r.Kc(28," Command: "),r.cc(29,"textarea",14),r.kc("ngModelChange",(function(t){return e.cmd=t})),r.bc(),r.Xb(30,"br"),r.Xb(31,"br"),r.Xb(32,"input",15),r.bc(),r.bc(),r.cc(33,"div",16),r.cc(34,"div",17),r.cc(35,"h1"),r.Kc(36,"return:"),r.bc(),r.cc(37,"pre",18),r.Kc(38),r.nc(39,"json"),r.bc(),r.bc(),r.cc(40,"div",19),r.cc(41,"h1"),r.Kc(42,"logs:"),r.bc(),r.cc(43,"pre",20),r.Kc(44),r.nc(45,"json"),r.bc(),r.bc(),r.cc(46,"div",21),r.cc(47,"h1"),r.Kc(48,"error:"),r.bc(),r.cc(49,"pre",22),r.Kc(50),r.nc(51,"json"),r.bc(),r.bc(),r.bc(),r.bc(),r.bc()}2&t&&(r.Jb(3),r.Lc(r.oc(4,10,e.allMembers)),r.Jb(4),r.sc("nodes",e.allMembers),r.Jb(6),r.sc("ngModel",e.className),r.Jb(3),r.sc("ngModel",e.memberName),r.Jb(3),r.sc("ngModel",e.member2Name),r.Jb(3),r.sc("ngModel",e.paramsArray),r.Jb(7),r.sc("ngModel",e.cmd),r.Jb(9),r.Lc(r.oc(39,12,e.results)),r.Jb(6),r.Lc(r.oc(45,14,e.logs)),r.Jb(6),r.Lc(r.oc(51,16,e.error)))},directives:[c.a,o.h,o.e,o.f,o.b,o.d,o.g],pipes:[h.k],styles:["pre[_ngcontent-%COMP%]{font-size:12px;overflow-x:scroll}div[_ngcontent-%COMP%]{resize:both;overflow:auto;border:1px solid;padding:.7%;margin:.7%}#reflect[_ngcontent-%COMP%]{min-width:1000px;display:flex;flex-direction:row}#reflect-all-members[_ngcontent-%COMP%]{width:17%;height:88vh}#reflect-main[_ngcontent-%COMP%]{width:83%}#reflect-form-container[_ngcontent-%COMP%]{display:flex}#reflect-form[_ngcontent-%COMP%]{margin-right:25px;padding-right:25px;border-right:2px solid}#reflect-info[_ngcontent-%COMP%]{display:flex;flex-direction:row}#reflect-error[_ngcontent-%COMP%], #reflect-logs[_ngcontent-%COMP%], #reflect-return[_ngcontent-%COMP%]{width:32%}input[_ngcontent-%COMP%]{width:250px}textarea[_ngcontent-%COMP%]{width:350px;height:120px}"]}),t}(),mr=function(){function t(t){this.router=t}return t.prototype.canActivate=function(t,e){var n=t.queryParams.page;return this.router.navigate(n&&"popup"!==n?["/"+n]:["/popup"]),!1},t.\u0275fac=function(e){return new(e||t)(r.gc(a.a))},t.\u0275prov=r.Sb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Or=[{path:"background",component:fr},{path:"reflect",component:vr},{path:"popup",component:gr},{path:"settings",component:or},{path:"**",component:gr,canActivate:[mr]}],jr=function(){function t(){}return t.\u0275mod=r.Ub({type:t}),t.\u0275inj=r.Tb({factory:function(e){return new(e||t)},imports:[[a.b.forRoot(Or)],a.b]}),t}(),yr=function(){function t(){}return t.\u0275mod=r.Ub({type:t,bootstrap:[u]}),t.\u0275inj=r.Tb({factory:function(e){return new(e||t)},providers:[Kt,Wt,mr],imports:[[i.a,o.c,jr,s.b,pr,g,Ft,c.b.forRoot()]]}),t}();Object(r.ab)(),i.c().bootstrapModule(yr).catch((function(t){return console.log(t)}))}},[[1,0,5]]]);